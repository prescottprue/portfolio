function UrlMatcher(a,b,c){function d(b,c,d,e){if(o.push(b),m[b])return m[b];if(!/^\w+(-+\w+)*(?:\[\])?$/.test(b))throw new Error("Invalid parameter name '"+b+"' in pattern '"+a+"'");if(n[b])throw new Error("Duplicate parameter name '"+b+"' in pattern '"+a+"'");return n[b]=new $$UMFP.Param(b,c,d,e),n[b]}function e(a,b,c){var d=["",""],e=a.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!b)return e;switch(c){case!1:d=["(",")"];break;case!0:d=["?(",")?"];break;default:d=["("+c+"|",")?"]}return e+d[0]+b+d[1]}function f(c,d){var e,f,g,h,i;return e=c[2]||c[3],i=b.params[e],g=a.substring(k,c.index),f=d?c[4]:c[4]||("*"==c[1]?".*":null),h=$$UMFP.type(f||"string")||inherit($$UMFP.type("string"),{pattern:new RegExp(f)}),{id:e,regexp:f,segment:g,type:h,cfg:i}}b=extend({params:{}},isObject(b)?b:{});var g,h=/([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,i=/([:]?)([\w\[\]-]+)|\{([\w\[\]-]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,j="^",k=0,l=this.segments=[],m=c?c.params:{},n=this.params=c?c.params.$$new():new $$UMFP.ParamSet,o=[];this.source=a;for(var p,q,r;(g=h.exec(a))&&(p=f(g,!1),!(p.segment.indexOf("?")>=0));)q=d(p.id,p.type,p.cfg,"path"),j+=e(p.segment,q.type.pattern.source,q.squash),l.push(p.segment),k=h.lastIndex;r=a.substring(k);var s=r.indexOf("?");if(s>=0){var t=this.sourceSearch=r.substring(s);if(r=r.substring(0,s),this.sourcePath=a.substring(0,k+s),t.length>0)for(k=0;g=i.exec(t);)p=f(g,!0),q=d(p.id,p.type,p.cfg,"search"),k=h.lastIndex}else this.sourcePath=a,this.sourceSearch="";j+=e(r)+(b.strict===!1?"/?":"")+"$",l.push(r),this.regexp=new RegExp(j,b.caseInsensitive?"i":void 0),this.prefix=l[0],this.$$paramNames=o}function Type(a){extend(this,a)}function $UrlMatcherFactory(){function a(a){return null!=a?a.toString().replace(/\//g,"%2F"):a}function b(a){return null!=a?a.toString().replace(/%2F/g,"/"):a}function c(a){return this.pattern.test(a)}function d(){return{strict:j,caseInsensitive:i}}function e(a){return isFunction(a)||isArray(a)&&isFunction(a[a.length-1])}function f(){for(;n.length;){var a=n.shift();if(a.pattern)throw new Error("You cannot override a type's .pattern at runtime.");angular.extend(l[a.name],h.invoke(a.def))}}function g(a){extend(this,a||{})}$$UMFP=this;var h,i=!1,j=!0,k=!1,l={},m=!0,n=[],o={string:{encode:a,decode:b,is:c,pattern:/[^/]*/},"int":{encode:a,decode:function(a){return parseInt(a,10)},is:function(a){return isDefined(a)&&this.decode(a.toString())===a},pattern:/\d+/},bool:{encode:function(a){return a?1:0},decode:function(a){return 0!==parseInt(a,10)},is:function(a){return a===!0||a===!1},pattern:/0|1/},date:{encode:function(a){return this.is(a)?[a.getFullYear(),("0"+(a.getMonth()+1)).slice(-2),("0"+a.getDate()).slice(-2)].join("-"):void 0},decode:function(a){if(this.is(a))return a;var b=this.capture.exec(a);return b?new Date(b[1],b[2]-1,b[3]):void 0},is:function(a){return a instanceof Date&&!isNaN(a.valueOf())},equals:function(a,b){return this.is(a)&&this.is(b)&&a.toISOString()===b.toISOString()},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,capture:/([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/},json:{encode:angular.toJson,decode:angular.fromJson,is:angular.isObject,equals:angular.equals,pattern:/[^/]*/},any:{encode:angular.identity,decode:angular.identity,is:angular.identity,equals:angular.equals,pattern:/.*/}};$UrlMatcherFactory.$$getDefaultValue=function(a){if(!e(a.value))return a.value;if(!h)throw new Error("Injectable functions cannot be called at configuration time");return h.invoke(a.value)},this.caseInsensitive=function(a){return isDefined(a)&&(i=a),i},this.strictMode=function(a){return isDefined(a)&&(j=a),j},this.defaultSquashPolicy=function(a){if(!isDefined(a))return k;if(a!==!0&&a!==!1&&!isString(a))throw new Error("Invalid squash policy: "+a+". Valid policies: false, true, arbitrary-string");return k=a,a},this.compile=function(a,b){return new UrlMatcher(a,extend(d(),b))},this.isMatcher=function(a){if(!isObject(a))return!1;var b=!0;return forEach(UrlMatcher.prototype,function(c,d){isFunction(c)&&(b=b&&isDefined(a[d])&&isFunction(a[d]))}),b},this.type=function(a,b,c){if(!isDefined(b))return l[a];if(l.hasOwnProperty(a))throw new Error("A type named '"+a+"' has already been defined.");return l[a]=new Type(extend({name:a},b)),c&&(n.push({name:a,def:c}),m||f()),this},forEach(o,function(a,b){l[b]=new Type(extend({name:b},a))}),l=inherit(l,{}),this.$get=["$injector",function(a){return h=a,m=!1,f(),forEach(o,function(a,b){l[b]||(l[b]=new Type(a))}),this}],this.Param=function(a,b,c,d){function f(a){var b=isObject(a)?objectKeys(a):[],c=-1===indexOf(b,"value")&&-1===indexOf(b,"type")&&-1===indexOf(b,"squash")&&-1===indexOf(b,"array");return c&&(a={value:a}),a.$$fn=e(a.value)?a.value:function(){return a.value},a}function g(b,c,d){if(b.type&&c)throw new Error("Param '"+a+"' has two type configurations.");return c?c:b.type?b.type instanceof Type?b.type:new Type(b.type):"config"===d?l.any:l.string}function i(){var b={array:"search"===d?"auto":!1},e=a.match(/\[\]$/)?{array:!0}:{};return extend(b,e,c).array}function j(a,b){var c=a.squash;if(!b||c===!1)return!1;if(!isDefined(c)||null==c)return k;if(c===!0||isString(c))return c;throw new Error("Invalid squash policy: '"+c+"'. Valid policies: false, true, or arbitrary string")}function m(a,b,c,d){var e,f,g=[{from:"",to:c||b?void 0:""},{from:null,to:c||b?void 0:""}];return e=isArray(a.replace)?a.replace:[],isString(d)&&e.push({from:d,to:void 0}),f=map(e,function(a){return a.from}),filter(g,function(a){return-1===indexOf(f,a.from)}).concat(e)}function n(){if(!h)throw new Error("Injectable functions cannot be called at configuration time");return h.invoke(c.$$fn)}function o(a){function b(a){return function(b){return b.from===a}}function c(a){var c=map(filter(q.replace,b(a)),function(a){return a.to});return c.length?c[0]:a}return a=c(a),isDefined(a)?q.type.decode(a):n()}function p(){return"{Param:"+a+" "+b+" squash: '"+t+"' optional: "+s+"}"}var q=this;c=f(c),b=g(c,b,d);var r=i();b=r?b.$asArray(r,"search"===d):b,"string"!==b.name||r||"path"!==d||void 0!==c.value||(c.value="");var s=void 0!==c.value,t=j(c,s),u=m(c,r,s,t);extend(this,{id:a,type:b,location:d,array:r,squash:t,replace:u,isOptional:s,value:o,dynamic:void 0,config:c,toString:p})},g.prototype={$$new:function(){return inherit(this,extend(new g,{$$parent:this}))},$$keys:function(){for(var a=[],b=[],c=this,d=objectKeys(g.prototype);c;)b.push(c),c=c.$$parent;return b.reverse(),forEach(b,function(b){forEach(objectKeys(b),function(b){-1===indexOf(a,b)&&-1===indexOf(d,b)&&a.push(b)})}),a},$$values:function(a){var b={},c=this;return forEach(c.$$keys(),function(d){b[d]=c[d].value(a&&a[d])}),b},$$equals:function(a,b){var c=!0,d=this;return forEach(d.$$keys(),function(e){var f=a&&a[e],g=b&&b[e];d[e].type.equals(f,g)||(c=!1)}),c},$$validates:function(a){var b,c,d,e=!0,f=this;return forEach(this.$$keys(),function(g){d=f[g],c=a[g],b=!c&&d.isOptional,e=e&&(b||!!d.type.is(c))}),e},$$parent:void 0},this.ParamSet=g}var $$UMFP;UrlMatcher.prototype.concat=function(a,b){var c={caseInsensitive:$$UMFP.caseInsensitive(),strict:$$UMFP.strictMode(),squash:$$UMFP.defaultSquashPolicy()};return new UrlMatcher(this.sourcePath+a+this.sourceSearch,extend(c,b),this)},UrlMatcher.prototype.toString=function(){return this.source},UrlMatcher.prototype.exec=function(a,b){function c(a){function b(a){return a.split("").reverse().join("")}function c(a){return a.replace(/\\-/,"-")}var d=b(a).split(/-(?!\\)/),e=map(d,b);return map(e,c).reverse()}var d=this.regexp.exec(a);if(!d)return null;b=b||{};var e,f,g,h=this.parameters(),i=h.length,j=this.segments.length-1,k={};if(j!==d.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(e=0;j>e;e++){g=h[e];var l=this.params[g],m=d[e+1];for(f=0;f<l.replace;f++)l.replace[f].from===m&&(m=l.replace[f].to);m&&l.array===!0&&(m=c(m)),k[g]=l.value(m)}for(;i>e;e++)g=h[e],k[g]=this.params[g].value(b[g]);return k},UrlMatcher.prototype.parameters=function(a){return isDefined(a)?this.params[a]||null:this.$$paramNames},UrlMatcher.prototype.validates=function(a){return this.params.$$validates(a)},UrlMatcher.prototype.format=function(a){function b(a){return encodeURIComponent(a).replace(/-/g,function(a){return"%5C%"+a.charCodeAt(0).toString(16).toUpperCase()})}a=a||{};var c=this.segments,d=this.parameters(),e=this.params;if(!this.validates(a))return null;var f,g=!1,h=c.length-1,i=d.length,j=c[0];for(f=0;i>f;f++){var k=h>f,l=d[f],m=e[l],n=m.value(a[l]),o=m.isOptional&&m.type.equals(m.value(),n),p=o?m.squash:!1,q=m.type.encode(n);if(k){var r=c[f+1];if(p===!1)null!=q&&(j+=isArray(q)?map(q,b).join("-"):encodeURIComponent(q)),j+=r;else if(p===!0){var s=j.match(/\/$/)?/\/?(.*)/:/(.*)/;j+=r.match(s)[1]}else isString(p)&&(j+=p+r)}else{if(null==q||o&&p!==!1)continue;isArray(q)||(q=[q]),q=map(q,encodeURIComponent).join("&"+l+"="),j+=(g?"&":"?")+(l+"="+q),g=!0}}return j},Type.prototype.is=function(){return!0},Type.prototype.encode=function(a){return a},Type.prototype.decode=function(a){return a},Type.prototype.equals=function(a,b){return a==b},Type.prototype.$subPattern=function(){var a=this.pattern.toString();return a.substr(1,a.length-2)},Type.prototype.pattern=/.*/,Type.prototype.toString=function(){return"{Type:"+this.name+"}"},Type.prototype.$asArray=function(a,b){function c(a,b){function c(a,b){return function(){return a[b].apply(a,arguments)}}function d(a){return isArray(a)?a:isDefined(a)?[a]:[]}function e(a){switch(a.length){case 0:return void 0;case 1:return"auto"===b?a[0]:a;default:return a}}function f(a){return!a}function g(a,b){return function(c){c=d(c);var g=map(c,a);return b===!0?0===filter(g,f).length:e(g)}}function h(a){return function(b,c){var e=d(b),f=d(c);if(e.length!==f.length)return!1;for(var g=0;g<e.length;g++)if(!a(e[g],f[g]))return!1;return!0}}this.encode=g(c(a,"encode")),this.decode=g(c(a,"decode")),this.is=g(c(a,"is"),!0),this.equals=h(c(a,"equals")),this.pattern=a.pattern,this.$arrayMode=b}if(!a)return this;if("auto"===a&&!b)throw new Error("'auto' array mode is for query parameters only");return new c(this,a)},angular.module("ui.router.util").provider("$urlMatcherFactory",$UrlMatcherFactory),angular.module("ui.router.util").run(["$urlMatcherFactory",function(){}]);