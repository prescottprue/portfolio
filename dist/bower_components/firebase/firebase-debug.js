function FirebaseIFrameScriptHolder(a,b,c,d){if(this.urlFn=d,this.onDisconnect=c,this.outstandingRequests=new fb.core.util.CountedSet,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,NODE_CLIENT)this.commandCB=a,this.onMessageCB=b;else{this.uniqueCallbackIdentifier=fb.core.util.LUIDGenerator(),window[FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=a,window[FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=b,this.myIFrame=this.createIFrame_();var e="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)){var f=document.domain;e='<script>document.domain="'+f+'";</script>'}var g="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(g),this.myIFrame.doc.close()}catch(h){fb.core.util.log("frame writing exception"),h.stack&&fb.core.util.log(h.stack),fb.core.util.log(h)}}}var CLOSURE_NO_DEPS=!0,COMPILED=!1,goog=goog||{};goog.global=this,goog.global.CLOSURE_UNCOMPILED_DEFINES,goog.global.CLOSURE_DEFINES,goog.isDef=function(a){return void 0!==a},goog.exportPath_=function(a,b,c){var d=a.split("."),e=c||goog.global;d[0]in e||!e.execScript||e.execScript("var "+d[0]);for(var f;d.length&&(f=d.shift());)!d.length&&goog.isDef(b)?e[f]=b:e=e[f]?e[f]:e[f]={}},goog.define=function(a,b){var c=b;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,a)?c=goog.global.CLOSURE_UNCOMPILED_DEFINES[a]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,a)&&(c=goog.global.CLOSURE_DEFINES[a])),goog.exportPath_(a,c)},goog.DEBUG=!0,goog.define("goog.LOCALE","en"),goog.define("goog.TRUSTED_SITE",!0),goog.define("goog.STRICT_MODE_COMPATIBLE",!1),goog.provide=function(a){if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a];for(var b=a;(b=b.substring(0,b.lastIndexOf(".")))&&!goog.getObjectByName(b);)goog.implicitNamespaces_[b]=!0}goog.exportPath_(a)},goog.setTestOnly=function(a){if(COMPILED&&!goog.DEBUG)throw a=a||"",Error(": "+a)},goog.forwardDeclare=function(){},COMPILED||(goog.isProvided_=function(a){return!goog.implicitNamespaces_[a]&&goog.isDefAndNotNull(goog.getObjectByName(a))},goog.implicitNamespaces_={}),goog.getObjectByName=function(a,b){for(var c,d=a.split("."),e=b||goog.global;c=d.shift();){if(!goog.isDefAndNotNull(e[c]))return null;e=e[c]}return e},goog.globalize=function(a,b){var c=b||goog.global;for(var d in a)c[d]=a[d]},goog.addDependency=function(a,b,c){if(goog.DEPENDENCIES_ENABLED){for(var d,e,f=a.replace(/\\/g,"/"),g=goog.dependencies_,h=0;d=b[h];h++)g.nameToPath[d]=f,f in g.pathToNames||(g.pathToNames[f]={}),g.pathToNames[f][d]=!0;for(var i=0;e=c[i];i++)f in g.requires||(g.requires[f]={}),g.requires[f][e]=!0}},goog.define("goog.ENABLE_DEBUG_LOADER",!0),goog.require=function(a){if(!COMPILED){if(goog.isProvided_(a))return;if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b)return goog.included_[b]=!0,void goog.writeScripts_()}var c="goog.require could not find: "+a;throw goog.global.console&&goog.global.console.error(c),Error(c)}},goog.basePath="",goog.global.CLOSURE_BASE_PATH,goog.global.CLOSURE_NO_DEPS,goog.global.CLOSURE_IMPORT_SCRIPT,goog.nullFunction=function(){},goog.identityFunction=function(a){return a},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(a){a.getInstance=function(){return a.instance_?a.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a),a.instance_=new a)}},goog.instantiatedSingletons_=[],goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)return void(goog.basePath=goog.global.CLOSURE_BASE_PATH);if(goog.inHtmlDocument_())for(var a=goog.global.document,b=a.getElementsByTagName("script"),c=b.length-1;c>=0;--c){var d=b[c].src,e=d.lastIndexOf("?"),f=-1==e?d.length:e;if("base.js"==d.substr(f-7,7))return void(goog.basePath=d.substr(0,f-7))}},goog.importScript_=function(a){var b=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;!goog.dependencies_.written[a]&&b(a)&&(goog.dependencies_.written[a]=!0)},goog.writeScriptTag_=function(a){if(goog.inHtmlDocument_()){var b=goog.global.document;if("complete"==b.readyState){var c=/\bdeps.js$/.test(a);if(c)return!1;throw Error('Cannot write "'+a+'" after document load')}return b.write('<script type="text/javascript" src="'+a+'"></script>'),!0}return!1},goog.writeScripts_=function(){function a(e){if(!(e in d.written)){if(e in d.visited)return void(e in c||(c[e]=!0,b.push(e)));if(d.visited[e]=!0,e in d.requires)for(var f in d.requires[e])if(!goog.isProvided_(f)){if(!(f in d.nameToPath))throw Error("Undefined nameToPath for "+f);a(d.nameToPath[f])}e in c||(c[e]=!0,b.push(e))}}var b=[],c={},d=goog.dependencies_;for(var e in goog.included_)d.written[e]||a(e);for(var f=0;f<b.length;f++){if(!b[f])throw Error("Undefined script input");goog.importScript_(goog.basePath+b[f])}},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js")),goog.typeOf=function(a){var b=typeof a;if("object"==b){if(!a)return"null";if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else if("function"==b&&"undefined"==typeof a.call)return"object";return b},goog.isNull=function(a){return null===a},goog.isDefAndNotNull=function(a){return null!=a},goog.isArray=function(a){return"array"==goog.typeOf(a)},goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length},goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear},goog.isString=function(a){return"string"==typeof a},goog.isBoolean=function(a){return"boolean"==typeof a},goog.isNumber=function(a){return"number"==typeof a},goog.isFunction=function(a){return"function"==goog.typeOf(a)},goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b},goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(a){return!!a[goog.UID_PROPERTY_]},goog.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var c="array"==b?[]:{};for(var d in a)c[d]=goog.cloneObject(a[d]);return c}return a},goog.bindNative_=function(a){return a.call.apply(a.bind,arguments)},goog.bindJs_=function(a,b){if(!a)throw new Error;if(arguments.length>2){var c=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(d,c),a.apply(b,d)}}return function(){return a.apply(b,arguments)}},goog.bind=function(){return goog.bind=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bindNative_:goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){var c=b.slice();return c.push.apply(c,arguments),a.apply(this,c)}},goog.mixin=function(a,b){for(var c in b)a[c]=b[c]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("script");c.type="text/javascript",c.defer=!1,c.appendChild(b.createTextNode(a)),b.body.appendChild(c),b.body.removeChild(c)}}},goog.evalWorksForGlobals_=null,goog.cssNameMapping_,goog.cssNameMappingStyle_,goog.getCssName=function(a,b){var c,d=function(a){return goog.cssNameMapping_[a]||a},e=function(a){for(var b=a.split("-"),c=[],e=0;e<b.length;e++)c.push(d(b[e]));return c.join("-")};return c=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?d:e:function(a){return a},b?a+"-"+c(b):c(a)},goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a,goog.cssNameMappingStyle_=b},goog.global.CLOSURE_CSS_NAME_MAPPING,!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(a,b){var c=b||{};for(var d in c){var e=(""+c[d]).replace(/\$/g,"$$$$");a=a.replace(new RegExp("\\{\\$"+d+"\\}","gi"),e)}return a},goog.getMsgWithFallback=function(a){return a},goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)},goog.exportProperty=function(a,b,c){a[b]=c},goog.inherits=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.base=function(a,c){var d=Array.prototype.slice.call(arguments,2);return b.prototype[c].apply(a,d)}},goog.base=function(a,b){var c=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!c)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(c.superClass_)return c.superClass_.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var d=Array.prototype.slice.call(arguments,2),e=!1,f=a.constructor;f;f=f.superClass_&&f.superClass_.constructor)if(f.prototype[b]===c)e=!0;else if(e)return f.prototype[b].apply(a,d);if(a[b]===c)return a.constructor.prototype[b].apply(a,d);throw Error("goog.base called from a method of one name to a method of a different name")},goog.scope=function(a){a.call(goog.global)},COMPILED||(goog.global.COMPILED=COMPILED),goog.provide("goog.json"),goog.provide("goog.json.Replacer"),goog.provide("goog.json.Reviver"),goog.provide("goog.json.Serializer"),goog.define("goog.json.USE_NATIVE_JSON",!1),goog.json.isValid_=function(a){if(/^\s*$/.test(a))return!1;var b=/\\["\\\/bfnrtu]/g,c=/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,d=/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,e=/^[\],:{}\s\u2028\u2029]*$/;return e.test(a.replace(b,"@").replace(c,"]").replace(d,""))},goog.json.parse=goog.json.USE_NATIVE_JSON?goog.global.JSON.parse:function(s){var o=String(s);if(goog.json.isValid_(o))try{return eval("("+o+")")}catch(ex){}throw Error("Invalid JSON string: "+o)},goog.json.unsafeParse=goog.json.USE_NATIVE_JSON?goog.global.JSON.parse:function(s){return eval("("+s+")")},goog.json.Replacer,goog.json.Reviver,goog.json.serialize=goog.json.USE_NATIVE_JSON?goog.global.JSON.stringify:function(a,b){return new goog.json.Serializer(b).serialize(a)},goog.json.Serializer=function(a){this.replacer_=a},goog.json.Serializer.prototype.serialize=function(a){var b=[];return this.serializeInternal(a,b),b.join("")},goog.json.Serializer.prototype.serializeInternal=function(a,b){switch(typeof a){case"string":this.serializeString_(a,b);break;case"number":this.serializeNumber_(a,b);break;case"boolean":b.push(a);break;case"undefined":b.push("null");break;case"object":if(null==a){b.push("null");break}if(goog.isArray(a)){this.serializeArray(a,b);break}this.serializeObject_(a,b);break;case"function":break;default:throw Error("Unknown type: "+typeof a)}},goog.json.Serializer.charToJsonCharCache_={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\u000b"},goog.json.Serializer.charsToReplace_=/\uffff/.test("￿")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,goog.json.Serializer.prototype.serializeString_=function(a,b){b.push('"',a.replace(goog.json.Serializer.charsToReplace_,function(a){if(a in goog.json.Serializer.charToJsonCharCache_)return goog.json.Serializer.charToJsonCharCache_[a];var b=a.charCodeAt(0),c="\\u";return 16>b?c+="000":256>b?c+="00":4096>b&&(c+="0"),goog.json.Serializer.charToJsonCharCache_[a]=c+b.toString(16)}),'"')},goog.json.Serializer.prototype.serializeNumber_=function(a,b){b.push(isFinite(a)&&!isNaN(a)?a:"null")},goog.json.Serializer.prototype.serializeArray=function(a,b){var c=a.length;b.push("[");for(var d="",e=0;c>e;e++){b.push(d);var f=a[e];this.serializeInternal(this.replacer_?this.replacer_.call(a,String(e),f):f,b),d=","}b.push("]")},goog.json.Serializer.prototype.serializeObject_=function(a,b){b.push("{");var c="";for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)){var e=a[d];"function"!=typeof e&&(b.push(c),this.serializeString_(d,b),b.push(":"),this.serializeInternal(this.replacer_?this.replacer_.call(a,d,e):e,b),c=",")}b.push("}")},goog.provide("fb.util.json"),goog.require("goog.json"),fb.util.json.eval=function(a){return"undefined"!=typeof JSON&&goog.isDef(JSON.parse)?JSON.parse(a):goog.json.parse(a)},fb.util.json.stringify=function(a){return"undefined"!=typeof JSON&&goog.isDef(JSON.stringify)?JSON.stringify(a):goog.json.serialize(a)},goog.provide("fb.util.obj"),fb.util.obj.contains=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},fb.util.obj.get=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:void 0},fb.util.obj.foreach=function(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])},fb.util.obj.clone=function(a){var b={};return fb.util.obj.foreach(a,function(a,c){b[a]=c}),b},goog.provide("fb.core.storage.DOMStorageWrapper"),goog.require("fb.util.obj"),goog.scope(function(){fb.core.storage.DOMStorageWrapper=function(a){this.domStorage_=a,this.prefix_="firebase:"};var a=fb.core.storage.DOMStorageWrapper;a.prototype.set=function(a,b){null==b?this.domStorage_.removeItem(this.prefixedName_(a)):this.domStorage_.setItem(this.prefixedName_(a),fb.util.json.stringify(b))},a.prototype.get=function(a){var b=this.domStorage_.getItem(this.prefixedName_(a));return null==b?null:fb.util.json.eval(b)},a.prototype.remove=function(a){this.domStorage_.removeItem(this.prefixedName_(a))},a.prototype.isInMemoryStorage=!1,a.prototype.prefixedName_=function(a){return this.prefix_+a},a.prototype.toString=function(){return this.domStorage_.toString()}}),goog.provide("fb.core.storage.MemoryStorage"),goog.require("fb.util.obj"),goog.scope(function(){var a=fb.util.obj;fb.core.storage.MemoryStorage=function(){this.cache_={}};var b=fb.core.storage.MemoryStorage;b.prototype.set=function(a,b){null==b?delete this.cache_[a]:this.cache_[a]=b},b.prototype.get=function(b){return a.contains(this.cache_,b)?this.cache_[b]:null},b.prototype.remove=function(a){delete this.cache_[a]},b.prototype.isInMemoryStorage=!0}),goog.provide("fb.core.storage"),goog.require("fb.core.storage.DOMStorageWrapper"),goog.require("fb.core.storage.MemoryStorage"),fb.core.storage.createStoragefor=function(a){try{if("undefined"!=typeof window&&"undefined"!=typeof window[a]){var b=window[a];return b.setItem("firebase:sentinel","cache"),b.removeItem("firebase:sentinel"),new fb.core.storage.DOMStorageWrapper(b)}}catch(c){}return new fb.core.storage.MemoryStorage},fb.core.storage.PersistentStorage=fb.core.storage.createStoragefor("localStorage"),fb.core.storage.SessionStorage=fb.core.storage.createStoragefor("sessionStorage"),goog.provide("fb.core.RepoInfo"),goog.require("fb.core.storage"),fb.core.RepoInfo=function(a,b,c,d,e){this.host=a.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.secure=b,this.namespace=c,this.webSocketOnly=d,this.persistenceKey=e||"",this.internalHost=fb.core.storage.PersistentStorage.get("host:"+a)||this.host},fb.core.RepoInfo.prototype.needsQueryParam=function(){return this.host!==this.internalHost},fb.core.RepoInfo.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},fb.core.RepoInfo.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},fb.core.RepoInfo.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},fb.core.RepoInfo.prototype.updateHost=function(a){a!==this.internalHost&&(this.internalHost=a,this.isCacheableHost()&&fb.core.storage.PersistentStorage.set("host:"+this.host,this.internalHost))},fb.core.RepoInfo.prototype.toString=function(){var a=(this.secure?"https://":"http://")+this.host;return this.persistenceKey&&(a+="<"+this.persistenceKey+">"),a},goog.provide("fb.constants");var NODE_CLIENT=!1,CLIENT_VERSION="0.0.0";goog.provide("goog.crypt.Hash"),goog.crypt.Hash=function(){this.blockSize=-1},goog.crypt.Hash.prototype.reset=goog.abstractMethod,goog.crypt.Hash.prototype.update=goog.abstractMethod,goog.crypt.Hash.prototype.digest=goog.abstractMethod,goog.provide("goog.crypt.Sha1"),goog.require("goog.crypt.Hash"),goog.crypt.Sha1=function(){goog.crypt.Sha1.base(this,"constructor"),this.blockSize=64,this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.pad_[0]=128;for(var a=1;a<this.blockSize;++a)this.pad_[a]=0;this.inbuf_=0,this.total_=0,this.reset()},goog.inherits(goog.crypt.Sha1,goog.crypt.Hash),goog.crypt.Sha1.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},goog.crypt.Sha1.prototype.compress_=function(a,b){b||(b=0);var c=this.W_;if(goog.isString(a))for(var d=0;16>d;d++)c[d]=a.charCodeAt(b)<<24|a.charCodeAt(b+1)<<16|a.charCodeAt(b+2)<<8|a.charCodeAt(b+3),b+=4;else for(var d=0;16>d;d++)c[d]=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3],b+=4;for(var d=16;80>d;d++){var e=c[d-3]^c[d-8]^c[d-14]^c[d-16];c[d]=4294967295&(e<<1|e>>>31)}for(var f,g,h=this.chain_[0],i=this.chain_[1],j=this.chain_[2],k=this.chain_[3],l=this.chain_[4],d=0;80>d;d++){40>d?20>d?(f=k^i&(j^k),g=1518500249):(f=i^j^k,g=1859775393):60>d?(f=i&j|k&(i|j),g=2400959708):(f=i^j^k,g=3395469782);var e=(h<<5|h>>>27)+f+l+g+c[d]&4294967295;l=k,k=j,j=4294967295&(i<<30|i>>>2),i=h,h=e}this.chain_[0]=this.chain_[0]+h&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+j&4294967295,this.chain_[3]=this.chain_[3]+k&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},goog.crypt.Sha1.prototype.update=function(a,b){goog.isDef(b)||(b=a.length);for(var c=b-this.blockSize,d=0,e=this.buf_,f=this.inbuf_;b>d;){if(0==f)for(;c>=d;)this.compress_(a,d),d+=this.blockSize;if(goog.isString(a)){for(;b>d;)if(e[f]=a.charCodeAt(d),++f,++d,f==this.blockSize){this.compress_(e),f=0;break}}else for(;b>d;)if(e[f]=a[d],++f,++d,f==this.blockSize){this.compress_(e),f=0;break}}this.inbuf_=f,this.total_+=b},goog.crypt.Sha1.prototype.digest=function(){var a=[],b=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var c=this.blockSize-1;c>=56;c--)this.buf_[c]=255&b,b/=256;this.compress_(this.buf_);for(var d=0,c=0;5>c;c++)for(var e=24;e>=0;e-=8)a[d]=this.chain_[c]>>e&255,++d;return a},goog.provide("goog.dom.NodeType"),goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},goog.provide("goog.debug.Error"),goog.debug.Error=function(a){if(Error.captureStackTrace)Error.captureStackTrace(this,goog.debug.Error);else{var b=(new Error).stack;b&&(this.stack=b)}a&&(this.message=String(a))},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.provide("goog.string"),goog.provide("goog.string.Unicode"),goog.define("goog.string.DETECT_DOUBLE_ESCAPING",!1),goog.string.Unicode={NBSP:" "},goog.string.startsWith=function(a,b){return 0==a.lastIndexOf(b,0)},goog.string.endsWith=function(a,b){var c=a.length-b.length;return c>=0&&a.indexOf(b,c)==c},goog.string.caseInsensitiveStartsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(0,b.length))},goog.string.caseInsensitiveEndsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(a.length-b.length,b.length))},goog.string.caseInsensitiveEquals=function(a,b){return a.toLowerCase()==b.toLowerCase()},goog.string.subs=function(a){for(var b=a.split("%s"),c="",d=Array.prototype.slice.call(arguments,1);d.length&&b.length>1;)c+=b.shift()+d.shift();return c+b.join("%s")},goog.string.collapseWhitespace=function(a){return a.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmpty=function(a){return/^[\s\xa0]*$/.test(a)},goog.string.isEmptySafe=function(a){return goog.string.isEmpty(goog.string.makeSafe(a))},goog.string.isBreakingWhitespace=function(a){return!/[^\t\n\r ]/.test(a)},goog.string.isAlpha=function(a){return!/[^a-zA-Z]/.test(a)},goog.string.isNumeric=function(a){return!/[^0-9]/.test(a)},goog.string.isAlphaNumeric=function(a){return!/[^a-zA-Z0-9]/.test(a)},goog.string.isSpace=function(a){return" "==a},goog.string.isUnicodeChar=function(a){return 1==a.length&&a>=" "&&"~">=a||a>=""&&"�">=a},goog.string.stripNewlines=function(a){return a.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(a){return a.replace(/(\r\n|\r|\n)/g,"\n")},goog.string.normalizeWhitespace=function(a){return a.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(a){return a.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(a){return a.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},goog.string.trimLeft=function(a){return a.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(a){return a.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=function(a,b){var c=String(a).toLowerCase(),d=String(b).toLowerCase();return d>c?-1:c==d?0:1},goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,goog.string.numerateCompare=function(a,b){if(a==b)return 0;if(!a)return-1;if(!b)return 1;for(var c=a.toLowerCase().match(goog.string.numerateCompareRegExp_),d=b.toLowerCase().match(goog.string.numerateCompareRegExp_),e=Math.min(c.length,d.length),f=0;e>f;f++){var g=c[f],h=d[f];if(g!=h){var i=parseInt(g,10);if(!isNaN(i)){var j=parseInt(h,10);if(!isNaN(j)&&i-j)return i-j}return h>g?-1:1}}return c.length!=d.length?c.length-d.length:b>a?-1:1},goog.string.urlEncode=function(a){return encodeURIComponent(String(a))},goog.string.urlDecode=function(a){return decodeURIComponent(a.replace(/\+/g," "))},goog.string.newLineToBr=function(a,b){return a.replace(/(\r\n|\r|\n)/g,b?"<br />":"<br>")},goog.string.htmlEscape=function(a,b){return b?(a=a.replace(goog.string.AMP_RE_,"&amp;").replace(goog.string.LT_RE_,"&lt;").replace(goog.string.GT_RE_,"&gt;").replace(goog.string.QUOT_RE_,"&quot;").replace(goog.string.SINGLE_QUOTE_RE_,"&#39;").replace(goog.string.NULL_RE_,"&#0;"),goog.string.DETECT_DOUBLE_ESCAPING&&(a=a.replace(goog.string.E_RE_,"&#101;")),a):goog.string.ALL_RE_.test(a)?(-1!=a.indexOf("&")&&(a=a.replace(goog.string.AMP_RE_,"&amp;")),-1!=a.indexOf("<")&&(a=a.replace(goog.string.LT_RE_,"&lt;")),-1!=a.indexOf(">")&&(a=a.replace(goog.string.GT_RE_,"&gt;")),-1!=a.indexOf('"')&&(a=a.replace(goog.string.QUOT_RE_,"&quot;")),-1!=a.indexOf("'")&&(a=a.replace(goog.string.SINGLE_QUOTE_RE_,"&#39;")),-1!=a.indexOf("\x00")&&(a=a.replace(goog.string.NULL_RE_,"&#0;")),goog.string.DETECT_DOUBLE_ESCAPING&&-1!=a.indexOf("e")&&(a=a.replace(goog.string.E_RE_,"&#101;")),a):a},goog.string.AMP_RE_=/&/g,goog.string.LT_RE_=/</g,goog.string.GT_RE_=/>/g,goog.string.QUOT_RE_=/"/g,goog.string.SINGLE_QUOTE_RE_=/'/g,goog.string.NULL_RE_=/\x00/g,goog.string.E_RE_=/e/g,goog.string.ALL_RE_=goog.string.DETECT_DOUBLE_ESCAPING?/[\x00&<>"'e]/:/[\x00&<>"']/,goog.string.unescapeEntities=function(a){return goog.string.contains(a,"&")?"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(a):goog.string.unescapePureXmlEntities_(a):a},goog.string.unescapeEntitiesWithDocument=function(a,b){return goog.string.contains(a,"&")?goog.string.unescapeEntitiesUsingDom_(a,b):a},goog.string.unescapeEntitiesUsingDom_=function(a,b){var c,d={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'};return c=b?b.createElement("div"):goog.global.document.createElement("div"),a.replace(goog.string.HTML_ENTITY_PATTERN_,function(a,b){var e=d[a];if(e)return e;if("#"==b.charAt(0)){var f=Number("0"+b.substr(1));isNaN(f)||(e=String.fromCharCode(f))}return e||(c.innerHTML=a+" ",e=c.firstChild.nodeValue.slice(0,-1)),d[a]=e})},goog.string.unescapePureXmlEntities_=function(a){return a.replace(/&([^;]+);/g,function(a,b){switch(b){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==b.charAt(0)){var c=Number("0"+b.substr(1));if(!isNaN(c))return String.fromCharCode(c)}return a}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(a,b){return goog.string.newLineToBr(a.replace(/  /g," &#160;"),b)},goog.string.preserveSpaces=function(a){return a.replace(/(^|[\n ]) /g,"$1"+goog.string.Unicode.NBSP)},goog.string.stripQuotes=function(a,b){for(var c=b.length,d=0;c>d;d++){var e=1==c?b:b.charAt(d);if(a.charAt(0)==e&&a.charAt(a.length-1)==e)return a.substring(1,a.length-1)}return a},goog.string.truncate=function(a,b,c){return c&&(a=goog.string.unescapeEntities(a)),a.length>b&&(a=a.substring(0,b-3)+"..."),c&&(a=goog.string.htmlEscape(a)),a},goog.string.truncateMiddle=function(a,b,c,d){if(c&&(a=goog.string.unescapeEntities(a)),d&&a.length>b){d>b&&(d=b);var e=a.length-d,f=b-d;a=a.substring(0,f)+"..."+a.substring(e)}else if(a.length>b){var g=Math.floor(b/2),h=a.length-g;g+=b%2,a=a.substring(0,g)+"..."+a.substring(h)}return c&&(a=goog.string.htmlEscape(a)),a},goog.string.specialEscapeChars_={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\x0B",'"':'\\"',"\\":"\\\\"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(a){if(a=String(a),a.quote)return a.quote();for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0);b[c+1]=goog.string.specialEscapeChars_[d]||(e>31&&127>e?d:goog.string.escapeChar(d))}return b.push('"'),b.join("")},goog.string.escapeString=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=goog.string.escapeChar(a.charAt(c));return b.join("")},goog.string.escapeChar=function(a){if(a in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[a];if(a in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[a]=goog.string.specialEscapeChars_[a];var b=a,c=a.charCodeAt(0);return c>31&&127>c?b=a:(256>c?(b="\\x",(16>c||c>256)&&(b+="0")):(b="\\u",4096>c&&(b+="0")),b+=c.toString(16).toUpperCase()),goog.string.jsEscapeCache_[a]=b},goog.string.toMap=function(a){for(var b={},c=0;c<a.length;c++)b[a.charAt(c)]=!0;return b},goog.string.contains=function(a,b){return-1!=a.indexOf(b)},goog.string.caseInsensitiveContains=function(a,b){return goog.string.contains(a.toLowerCase(),b.toLowerCase())},goog.string.countOf=function(a,b){return a&&b?a.split(b).length-1:0},goog.string.removeAt=function(a,b,c){var d=a;return b>=0&&b<a.length&&c>0&&(d=a.substr(0,b)+a.substr(b+c,a.length-b-c)),d},goog.string.remove=function(a,b){var c=new RegExp(goog.string.regExpEscape(b),"");return a.replace(c,"")},goog.string.removeAll=function(a,b){var c=new RegExp(goog.string.regExpEscape(b),"g");return a.replace(c,"")},goog.string.regExpEscape=function(a){return String(a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=function(a,b){return new Array(b+1).join(a)},goog.string.padNumber=function(a,b,c){var d=goog.isDef(c)?a.toFixed(c):String(a),e=d.indexOf(".");return-1==e&&(e=d.length),goog.string.repeat("0",Math.max(0,b-e))+d},goog.string.makeSafe=function(a){return null==a?"":String(a)},goog.string.buildString=function(){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){var a=2147483648;return Math.floor(Math.random()*a).toString(36)+Math.abs(Math.floor(Math.random()*a)^goog.now()).toString(36)},goog.string.compareVersions=function(a,b){for(var c=0,d=goog.string.trim(String(a)).split("."),e=goog.string.trim(String(b)).split("."),f=Math.max(d.length,e.length),g=0;0==c&&f>g;g++){var h=d[g]||"",i=e[g]||"",j=new RegExp("(\\d*)(\\D*)","g"),k=new RegExp("(\\d*)(\\D*)","g");do{var l=j.exec(h)||["","",""],m=k.exec(i)||["","",""];if(0==l[0].length&&0==m[0].length)break;var n=0==l[1].length?0:parseInt(l[1],10),o=0==m[1].length?0:parseInt(m[1],10);c=goog.string.compareElements_(n,o)||goog.string.compareElements_(0==l[2].length,0==m[2].length)||goog.string.compareElements_(l[2],m[2])}while(0==c)}return c},goog.string.compareElements_=function(a,b){return b>a?-1:a>b?1:0},goog.string.HASHCODE_MAX_=4294967296,goog.string.hashCode=function(a){for(var b=0,c=0;c<a.length;++c)b=31*b+a.charCodeAt(c),b%=goog.string.HASHCODE_MAX_;return b},goog.string.uniqueStringCounter_=2147483648*Math.random()|0,goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(a){var b=Number(a);return 0==b&&goog.string.isEmpty(a)?0/0:b},goog.string.isLowerCamelCase=function(a){return/^[a-z]+([A-Z][a-z]*)*$/.test(a)},goog.string.isUpperCamelCase=function(a){return/^([A-Z][a-z]*)+$/.test(a)},goog.string.toCamelCase=function(a){return String(a).replace(/\-([a-z])/g,function(a,b){return b.toUpperCase()})},goog.string.toSelectorCase=function(a){return String(a).replace(/([A-Z])/g,"-$1").toLowerCase()},goog.string.toTitleCase=function(a,b){var c=goog.isString(b)?goog.string.regExpEscape(b):"\\s";c=c?"|["+c+"]+":"";var d=new RegExp("(^"+c+")([a-z])","g");return a.replace(d,function(a,b,c){return b+c.toUpperCase()})},goog.string.parseInt=function(a){return isFinite(a)&&(a=String(a)),goog.isString(a)?/^\s*-?0x/i.test(a)?parseInt(a,16):parseInt(a,10):0/0},goog.string.splitLimit=function(a,b,c){for(var d=a.split(b),e=[];c>0&&d.length;)e.push(d.shift()),c--;return d.length&&e.push(d.join(b)),e},goog.provide("goog.asserts"),goog.provide("goog.asserts.AssertionError"),goog.require("goog.debug.Error"),goog.require("goog.dom.NodeType"),goog.require("goog.string"),goog.define("goog.asserts.ENABLE_ASSERTS",goog.DEBUG),goog.asserts.AssertionError=function(a,b){b.unshift(a),goog.debug.Error.call(this,goog.string.subs.apply(null,b)),b.shift(),this.messagePattern=a},goog.inherits(goog.asserts.AssertionError,goog.debug.Error),goog.asserts.AssertionError.prototype.name="AssertionError",goog.asserts.doAssertFailure_=function(a,b,c,d){var e="Assertion failed";if(c){e+=": "+c;var f=d}else a&&(e+=": "+a,f=b);throw new goog.asserts.AssertionError(""+e,f||[])},goog.asserts.assert=function(a,b){return goog.asserts.ENABLE_ASSERTS&&!a&&goog.asserts.doAssertFailure_("",null,b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.fail=function(a){if(goog.asserts.ENABLE_ASSERTS)throw new goog.asserts.AssertionError("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1))},goog.asserts.assertNumber=function(a,b){return goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(a)&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertString=function(a,b){return goog.asserts.ENABLE_ASSERTS&&!goog.isString(a)&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a
},goog.asserts.assertFunction=function(a,b){return goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(a)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertObject=function(a,b){return goog.asserts.ENABLE_ASSERTS&&!goog.isObject(a)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertArray=function(a,b){return goog.asserts.ENABLE_ASSERTS&&!goog.isArray(a)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertBoolean=function(a,b){return goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(a)&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertElement=function(a,b){return!goog.asserts.ENABLE_ASSERTS||goog.isObject(a)&&a.nodeType==goog.dom.NodeType.ELEMENT||goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2)),a},goog.asserts.assertInstanceof=function(a,b,c){return!goog.asserts.ENABLE_ASSERTS||a instanceof b||goog.asserts.doAssertFailure_("instanceof check failed.",null,c,Array.prototype.slice.call(arguments,3)),a},goog.asserts.assertObjectPrototypeIsIntact=function(){for(var a in Object.prototype)goog.asserts.fail(a+" should not be enumerable in Object.prototype.")},goog.provide("goog.array"),goog.provide("goog.array.ArrayLike"),goog.require("goog.asserts"),goog.define("goog.NATIVE_ARRAY_PROTOTYPES",goog.TRUSTED_SITE),goog.define("goog.array.ASSUME_NATIVE_FUNCTIONS",!1),goog.array.ArrayLike,goog.array.peek=function(a){return a[a.length-1]},goog.array.last=goog.array.peek,goog.array.ARRAY_PROTOTYPE_=Array.prototype,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.indexOf)?function(a,b,c){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.indexOf.call(a,b,c)}:function(a,b,c){var d=null==c?0:0>c?Math.max(0,a.length+c):c;if(goog.isString(a))return goog.isString(b)&&1==b.length?a.indexOf(b,d):-1;for(var e=d;e<a.length;e++)if(e in a&&a[e]===b)return e;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.lastIndexOf)?function(a,b,c){goog.asserts.assert(null!=a.length);var d=null==c?a.length-1:c;return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(a,b,d)}:function(a,b,c){var d=null==c?a.length-1:c;if(0>d&&(d=Math.max(0,a.length+d)),goog.isString(a))return goog.isString(b)&&1==b.length?a.lastIndexOf(b,d):-1;for(var e=d;e>=0;e--)if(e in a&&a[e]===b)return e;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.forEach)?function(a,b,c){goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)f in e&&b.call(c,e[f],f,a)},goog.array.forEachRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=d-1;f>=0;--f)f in e&&b.call(c,e[f],f,a)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.filter)?function(a,b,c){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=goog.isString(a)?a.split(""):a,h=0;d>h;h++)if(h in g){var i=g[h];b.call(c,i,h,a)&&(e[f++]=i)}return e},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.map)?function(a,b,c){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=new Array(d),f=goog.isString(a)?a.split(""):a,g=0;d>g;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e},goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduce)?function(a,b,c,d){return goog.asserts.assert(null!=a.length),d&&(b=goog.bind(b,d)),goog.array.ARRAY_PROTOTYPE_.reduce.call(a,b,c)}:function(a,b,c,d){var e=c;return goog.array.forEach(a,function(c,f){e=b.call(d,e,c,f,a)}),e},goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduceRight)?function(a,b,c,d){return goog.asserts.assert(null!=a.length),d&&(b=goog.bind(b,d)),goog.array.ARRAY_PROTOTYPE_.reduceRight.call(a,b,c)}:function(a,b,c,d){var e=c;return goog.array.forEachRight(a,function(c,f){e=b.call(d,e,c,f,a)}),e},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.some)?function(a,b,c){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.every)?function(a,b,c){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0},goog.array.count=function(a,b,c){var d=0;return goog.array.forEach(a,function(a,e,f){b.call(c,a,e,f)&&++d},c),d},goog.array.find=function(a,b,c){var d=goog.array.findIndex(a,b,c);return 0>d?null:goog.isString(a)?a.charAt(d):a[d]},goog.array.findIndex=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1},goog.array.findRight=function(a,b,c){var d=goog.array.findIndexRight(a,b,c);return 0>d?null:goog.isString(a)?a.charAt(d):a[d]},goog.array.findIndexRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=d-1;f>=0;f--)if(f in e&&b.call(c,e[f],f,a))return f;return-1},goog.array.contains=function(a,b){return goog.array.indexOf(a,b)>=0},goog.array.isEmpty=function(a){return 0==a.length},goog.array.clear=function(a){if(!goog.isArray(a))for(var b=a.length-1;b>=0;b--)delete a[b];a.length=0},goog.array.insert=function(a,b){goog.array.contains(a,b)||a.push(b)},goog.array.insertAt=function(a,b,c){goog.array.splice(a,c,0,b)},goog.array.insertArrayAt=function(a,b,c){goog.partial(goog.array.splice,a,c,0).apply(null,b)},goog.array.insertBefore=function(a,b,c){var d;2==arguments.length||(d=goog.array.indexOf(a,c))<0?a.push(b):goog.array.insertAt(a,b,d)},goog.array.remove=function(a,b){var c,d=goog.array.indexOf(a,b);return(c=d>=0)&&goog.array.removeAt(a,d),c},goog.array.removeAt=function(a,b){return goog.asserts.assert(null!=a.length),1==goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1).length},goog.array.removeIf=function(a,b,c){var d=goog.array.findIndex(a,b,c);return d>=0?(goog.array.removeAt(a,d),!0):!1},goog.array.concat=function(){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.join=function(){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.toArray=function(a){var b=a.length;if(b>0){for(var c=new Array(b),d=0;b>d;d++)c[d]=a[d];return c}return[]},goog.array.clone=goog.array.toArray,goog.array.extend=function(a){for(var b=1;b<arguments.length;b++){var c,d=arguments[b];if(goog.isArray(d)||(c=goog.isArrayLike(d))&&Object.prototype.hasOwnProperty.call(d,"callee"))a.push.apply(a,d);else if(c)for(var e=a.length,f=d.length,g=0;f>g;g++)a[e+g]=d[g];else a.push(d)}},goog.array.splice=function(a){return goog.asserts.assert(null!=a.length),goog.array.ARRAY_PROTOTYPE_.splice.apply(a,goog.array.slice(arguments,1))},goog.array.slice=function(a,b,c){return goog.asserts.assert(null!=a.length),arguments.length<=2?goog.array.ARRAY_PROTOTYPE_.slice.call(a,b):goog.array.ARRAY_PROTOTYPE_.slice.call(a,b,c)},goog.array.removeDuplicates=function(a,b,c){for(var d=b||a,e=function(){return goog.isObject(j)?"o"+goog.getUid(j):(typeof j).charAt(0)+j},f=c||e,g={},h=0,i=0;i<a.length;){var j=a[i++],k=f(j);Object.prototype.hasOwnProperty.call(g,k)||(g[k]=!0,d[h++]=j)}d.length=h},goog.array.binarySearch=function(a,b,c){return goog.array.binarySearch_(a,c||goog.array.defaultCompare,!1,b)},goog.array.binarySelect=function(a,b,c){return goog.array.binarySearch_(a,b,!0,void 0,c)},goog.array.binarySearch_=function(a,b,c,d,e){for(var f,g=0,h=a.length;h>g;){var i,j=g+h>>1;i=c?b.call(e,a[j],j,a):b(d,a[j]),i>0?g=j+1:(h=j,f=!i)}return f?g:~g},goog.array.sort=function(a,b){a.sort(b||goog.array.defaultCompare)},goog.array.stableSort=function(a,b){function c(a,b){return e(a.value,b.value)||a.index-b.index}for(var d=0;d<a.length;d++)a[d]={index:d,value:a[d]};var e=b||goog.array.defaultCompare;goog.array.sort(a,c);for(var d=0;d<a.length;d++)a[d]=a[d].value},goog.array.sortObjectsByKey=function(a,b,c){var d=c||goog.array.defaultCompare;goog.array.sort(a,function(a,c){return d(a[b],c[b])})},goog.array.isSorted=function(a,b,c){for(var d=b||goog.array.defaultCompare,e=1;e<a.length;e++){var f=d(a[e-1],a[e]);if(f>0||0==f&&c)return!1}return!0},goog.array.equals=function(a,b,c){if(!goog.isArrayLike(a)||!goog.isArrayLike(b)||a.length!=b.length)return!1;for(var d=a.length,e=c||goog.array.defaultCompareEquality,f=0;d>f;f++)if(!e(a[f],b[f]))return!1;return!0},goog.array.compare3=function(a,b,c){for(var d=c||goog.array.defaultCompare,e=Math.min(a.length,b.length),f=0;e>f;f++){var g=d(a[f],b[f]);if(0!=g)return g}return goog.array.defaultCompare(a.length,b.length)},goog.array.defaultCompare=function(a,b){return a>b?1:b>a?-1:0},goog.array.defaultCompareEquality=function(a,b){return a===b},goog.array.binaryInsert=function(a,b,c){var d=goog.array.binarySearch(a,b,c);return 0>d?(goog.array.insertAt(a,b,-(d+1)),!0):!1},goog.array.binaryRemove=function(a,b,c){var d=goog.array.binarySearch(a,b,c);return d>=0?goog.array.removeAt(a,d):!1},goog.array.bucket=function(a,b,c){for(var d={},e=0;e<a.length;e++){var f=a[e],g=b.call(c,f,e,a);if(goog.isDef(g)){var h=d[g]||(d[g]=[]);h.push(f)}}return d},goog.array.toObject=function(a,b,c){var d={};return goog.array.forEach(a,function(e,f){d[b.call(c,e,f,a)]=e}),d},goog.array.range=function(a,b,c){var d=[],e=0,f=a,g=c||1;if(void 0!==b&&(e=a,f=b),0>g*(f-e))return[];if(g>0)for(var h=e;f>h;h+=g)d.push(h);else for(var h=e;h>f;h+=g)d.push(h);return d},goog.array.repeat=function(a,b){for(var c=[],d=0;b>d;d++)c[d]=a;return c},goog.array.flatten=function(){for(var a=[],b=0;b<arguments.length;b++){var c=arguments[b];goog.isArray(c)?a.push.apply(a,goog.array.flatten.apply(null,c)):a.push(c)}return a},goog.array.rotate=function(a,b){return goog.asserts.assert(null!=a.length),a.length&&(b%=a.length,b>0?goog.array.ARRAY_PROTOTYPE_.unshift.apply(a,a.splice(-b,b)):0>b&&goog.array.ARRAY_PROTOTYPE_.push.apply(a,a.splice(0,-b))),a},goog.array.moveItem=function(a,b,c){goog.asserts.assert(b>=0&&b<a.length),goog.asserts.assert(c>=0&&c<a.length);var d=goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1);goog.array.ARRAY_PROTOTYPE_.splice.call(a,c,0,d[0])},goog.array.zip=function(){if(!arguments.length)return[];for(var a=[],b=0;!0;b++){for(var c=[],d=0;d<arguments.length;d++){var e=arguments[d];if(b>=e.length)return a;c.push(e[b])}a.push(c)}},goog.array.shuffle=function(a,b){for(var c=b||Math.random,d=a.length-1;d>0;d--){var e=Math.floor(c()*(d+1)),f=a[d];a[d]=a[e],a[e]=f}},goog.provide("goog.crypt"),goog.require("goog.array"),goog.require("goog.asserts"),goog.crypt.stringToByteArray=function(a){for(var b=[],c=0,d=0;d<a.length;d++){for(var e=a.charCodeAt(d);e>255;)b[c++]=255&e,e>>=8;b[c++]=e}return b},goog.crypt.byteArrayToString=function(a){var b=8192;if(a.length<b)return String.fromCharCode.apply(null,a);for(var c="",d=0;d<a.length;d+=b){var e=goog.array.slice(a,d,d+b);c+=String.fromCharCode.apply(null,e)}return c},goog.crypt.byteArrayToHex=function(a){return goog.array.map(a,function(a){var b=a.toString(16);return b.length>1?b:"0"+b}).join("")},goog.crypt.hexToByteArray=function(a){goog.asserts.assert(a.length%2==0,"Key string length must be multiple of 2");for(var b=[],c=0;c<a.length;c+=2)b.push(parseInt(a.substring(c,c+2),16));return b},goog.crypt.stringToUtf8ByteArray=function(a){a=a.replace(/\r\n/g,"\n");for(var b=[],c=0,d=0;d<a.length;d++){var e=a.charCodeAt(d);128>e?b[c++]=e:2048>e?(b[c++]=e>>6|192,b[c++]=63&e|128):(b[c++]=e>>12|224,b[c++]=e>>6&63|128,b[c++]=63&e|128)}return b},goog.crypt.utf8ByteArrayToString=function(a){for(var b=[],c=0,d=0;c<a.length;){var e=a[c++];if(128>e)b[d++]=String.fromCharCode(e);else if(e>191&&224>e){var f=a[c++];b[d++]=String.fromCharCode((31&e)<<6|63&f)}else{var f=a[c++],g=a[c++];b[d++]=String.fromCharCode((15&e)<<12|(63&f)<<6|63&g)}}return b.join("")},goog.crypt.xorByteArray=function(a,b){goog.asserts.assert(a.length==b.length,"XOR array lengths must match");for(var c=[],d=0;d<a.length;d++)c.push(a[d]^b[d]);return c},goog.provide("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.util.getNativeUserAgentString_=function(){var a=goog.labs.userAgent.util.getNavigator_();if(a){var b=a.userAgent;if(b)return b}return""},goog.labs.userAgent.util.getNavigator_=function(){return goog.global.navigator},goog.labs.userAgent.util.userAgent_=goog.labs.userAgent.util.getNativeUserAgentString_(),goog.labs.userAgent.util.setUserAgent=function(a){goog.labs.userAgent.util.userAgent_=a||goog.labs.userAgent.util.getNativeUserAgentString_()},goog.labs.userAgent.util.getUserAgent=function(){return goog.labs.userAgent.util.userAgent_},goog.labs.userAgent.util.matchUserAgent=function(a){var b=goog.labs.userAgent.util.getUserAgent();return goog.string.contains(b,a)},goog.labs.userAgent.util.matchUserAgentIgnoreCase=function(a){var b=goog.labs.userAgent.util.getUserAgent();return goog.string.caseInsensitiveContains(b,a)},goog.labs.userAgent.util.extractVersionTuples=function(a){for(var b,c=new RegExp("(\\w[\\w ]+)/([^\\s]+)\\s*(?:\\((.*?)\\))?","g"),d=[];b=c.exec(a);)d.push([b[1],b[2],b[3]||void 0]);return d},goog.provide("goog.labs.userAgent.browser"),goog.require("goog.array"),goog.require("goog.asserts"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.browser.matchOpera_=function(){return goog.labs.userAgent.util.matchUserAgent("Opera")||goog.labs.userAgent.util.matchUserAgent("OPR")},goog.labs.userAgent.browser.matchIE_=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.browser.matchFirefox_=function(){return goog.labs.userAgent.util.matchUserAgent("Firefox")},goog.labs.userAgent.browser.matchSafari_=function(){return goog.labs.userAgent.util.matchUserAgent("Safari")&&!goog.labs.userAgent.util.matchUserAgent("Chrome")&&!goog.labs.userAgent.util.matchUserAgent("CriOS")&&!goog.labs.userAgent.util.matchUserAgent("Android")},goog.labs.userAgent.browser.matchChrome_=function(){return goog.labs.userAgent.util.matchUserAgent("Chrome")||goog.labs.userAgent.util.matchUserAgent("CriOS")},goog.labs.userAgent.browser.matchAndroidBrowser_=function(){return goog.labs.userAgent.util.matchUserAgent("Android")&&!goog.labs.userAgent.util.matchUserAgent("Chrome")&&!goog.labs.userAgent.util.matchUserAgent("CriOS")},goog.labs.userAgent.browser.isOpera=goog.labs.userAgent.browser.matchOpera_,goog.labs.userAgent.browser.isIE=goog.labs.userAgent.browser.matchIE_,goog.labs.userAgent.browser.isFirefox=goog.labs.userAgent.browser.matchFirefox_,goog.labs.userAgent.browser.isSafari=goog.labs.userAgent.browser.matchSafari_,goog.labs.userAgent.browser.isChrome=goog.labs.userAgent.browser.matchChrome_,goog.labs.userAgent.browser.isAndroidBrowser=goog.labs.userAgent.browser.matchAndroidBrowser_,goog.labs.userAgent.browser.isSilk=function(){return goog.labs.userAgent.util.matchUserAgent("Silk")},goog.labs.userAgent.browser.getVersion=function(){var a=goog.labs.userAgent.util.getUserAgent();if(goog.labs.userAgent.browser.isIE())return goog.labs.userAgent.browser.getIEVersion_(a);if(goog.labs.userAgent.browser.isOpera())return goog.labs.userAgent.browser.getOperaVersion_(a);var b=goog.labs.userAgent.util.extractVersionTuples(a);return goog.labs.userAgent.browser.getVersionFromTuples_(b)},goog.labs.userAgent.browser.isVersionOrHigher=function(a){return goog.string.compareVersions(goog.labs.userAgent.browser.getVersion(),a)>=0},goog.labs.userAgent.browser.getIEVersion_=function(a){var b=/rv: *([\d\.]*)/.exec(a);if(b&&b[1])return b[1];var c="",d=/MSIE +([\d\.]+)/.exec(a);if(d&&d[1]){var e=/Trident\/(\d.\d)/.exec(a);if("7.0"==d[1])if(e&&e[1])switch(e[1]){case"4.0":c="8.0";break;case"5.0":c="9.0";break;case"6.0":c="10.0";break;case"7.0":c="11.0"}else c="7.0";else c=d[1]}return c},goog.labs.userAgent.browser.getOperaVersion_=function(a){var b=goog.labs.userAgent.util.extractVersionTuples(a),c=goog.array.peek(b);return"OPR"==c[0]&&c[1]?c[1]:goog.labs.userAgent.browser.getVersionFromTuples_(b)},goog.labs.userAgent.browser.getVersionFromTuples_=function(a){return goog.asserts.assert(a.length>2,"Couldn't extract version tuple from user agent string"),a[2]&&a[2][1]?a[2][1]:""},goog.provide("goog.labs.userAgent.engine"),goog.require("goog.array"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.engine.isPresto=function(){return goog.labs.userAgent.util.matchUserAgent("Presto")},goog.labs.userAgent.engine.isTrident=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.engine.isWebKit=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("WebKit")},goog.labs.userAgent.engine.isGecko=function(){return goog.labs.userAgent.util.matchUserAgent("Gecko")&&!goog.labs.userAgent.engine.isWebKit()&&!goog.labs.userAgent.engine.isTrident()},goog.labs.userAgent.engine.getVersion=function(){var a=goog.labs.userAgent.util.getUserAgent();if(a){var b=goog.labs.userAgent.util.extractVersionTuples(a),c=b[1];if(c)return"Gecko"==c[0]?goog.labs.userAgent.engine.getVersionForKey_(b,"Firefox"):c[1];var d,e=b[0];if(e&&(d=e[2])){var f=/Trident\/([^\s;]+)/.exec(d);if(f)return f[1]}}return""},goog.labs.userAgent.engine.isVersionOrHigher=function(a){return goog.string.compareVersions(goog.labs.userAgent.engine.getVersion(),a)>=0},goog.labs.userAgent.engine.getVersionForKey_=function(a,b){var c=goog.array.find(a,function(a){return b==a[0]});return c&&c[1]||""},goog.provide("goog.userAgent"),goog.require("goog.labs.userAgent.browser"),goog.require("goog.labs.userAgent.engine"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.define("goog.userAgent.ASSUME_IE",!1),goog.define("goog.userAgent.ASSUME_GECKO",!1),goog.define("goog.userAgent.ASSUME_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_MOBILE_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_OPERA",!1),goog.define("goog.userAgent.ASSUME_ANY_VERSION",!1),goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA,goog.userAgent.getUserAgentString=function(){return goog.labs.userAgent.util.getUserAgent()},goog.userAgent.getNavigator=function(){return goog.global.navigator||null},goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.labs.userAgent.browser.isOpera(),goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.labs.userAgent.browser.isIE(),goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.labs.userAgent.engine.isGecko(),goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.labs.userAgent.engine.isWebKit(),goog.userAgent.isMobile_=function(){return goog.userAgent.WEBKIT&&goog.labs.userAgent.util.matchUserAgent("Mobile")},goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.isMobile_(),goog.userAgent.SAFARI=goog.userAgent.WEBKIT,goog.userAgent.determinePlatform_=function(){var a=goog.userAgent.getNavigator();return a&&a.platform||""},goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_(),goog.define("goog.userAgent.ASSUME_MAC",!1),goog.define("goog.userAgent.ASSUME_WINDOWS",!1),goog.define("goog.userAgent.ASSUME_LINUX",!1),goog.define("goog.userAgent.ASSUME_X11",!1),goog.define("goog.userAgent.ASSUME_ANDROID",!1),goog.define("goog.userAgent.ASSUME_IPHONE",!1),goog.define("goog.userAgent.ASSUME_IPAD",!1),goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD,goog.userAgent.initPlatform_=function(){goog.userAgent.detectedMac_=goog.string.contains(goog.userAgent.PLATFORM,"Mac"),goog.userAgent.detectedWindows_=goog.string.contains(goog.userAgent.PLATFORM,"Win"),goog.userAgent.detectedLinux_=goog.string.contains(goog.userAgent.PLATFORM,"Linux"),goog.userAgent.detectedX11_=!!goog.userAgent.getNavigator()&&goog.string.contains(goog.userAgent.getNavigator().appVersion||"","X11");var a=goog.userAgent.getUserAgentString();goog.userAgent.detectedAndroid_=!!a&&goog.string.contains(a,"Android"),goog.userAgent.detectedIPhone_=!!a&&goog.string.contains(a,"iPhone"),goog.userAgent.detectedIPad_=!!a&&goog.string.contains(a,"iPad")},goog.userAgent.PLATFORM_KNOWN_||goog.userAgent.initPlatform_(),goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.userAgent.detectedMac_,goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.userAgent.detectedWindows_,goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.detectedLinux_,goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.detectedX11_,goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.userAgent.detectedAndroid_,goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.userAgent.detectedIPhone_,goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.userAgent.detectedIPad_,goog.userAgent.determineVersion_=function(){var a,b="";if(goog.userAgent.OPERA&&goog.global.opera){var c=goog.global.opera.version;return goog.isFunction(c)?c():c}if(goog.userAgent.GECKO?a=/rv\:([^\);]+)(\)|;)/:goog.userAgent.IE?a=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:goog.userAgent.WEBKIT&&(a=/WebKit\/(\S+)/),a){var d=a.exec(goog.userAgent.getUserAgentString());b=d?d[1]:""}if(goog.userAgent.IE){var e=goog.userAgent.getDocumentMode_();if(e>parseFloat(b))return String(e)}return b},goog.userAgent.getDocumentMode_=function(){var a=goog.global.document;return a?a.documentMode:void 0},goog.userAgent.VERSION=goog.userAgent.determineVersion_(),goog.userAgent.compare=function(a,b){return goog.string.compareVersions(a,b)},goog.userAgent.isVersionOrHigherCache_={},goog.userAgent.isVersionOrHigher=function(a){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionOrHigherCache_[a]||(goog.userAgent.isVersionOrHigherCache_[a]=goog.string.compareVersions(goog.userAgent.VERSION,a)>=0)},goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher,goog.userAgent.isDocumentModeOrHigher=function(a){return goog.userAgent.IE&&goog.userAgent.DOCUMENT_MODE>=a},goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher,goog.userAgent.DOCUMENT_MODE=function(){var a=goog.global.document;if(!a||!goog.userAgent.IE)return void 0;var b=goog.userAgent.getDocumentMode_();return b||("CSS1Compat"==a.compatMode?parseInt(goog.userAgent.VERSION,10):5)}(),goog.provide("goog.crypt.base64"),goog.require("goog.crypt"),goog.require("goog.userAgent"),goog.crypt.base64.byteToCharMap_=null,goog.crypt.base64.charToByteMap_=null,goog.crypt.base64.byteToCharMapWebSafe_=null,goog.crypt.base64.charToByteMapWebSafe_=null,goog.crypt.base64.ENCODED_VALS_BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",goog.crypt.base64.ENCODED_VALS=goog.crypt.base64.ENCODED_VALS_BASE+"+/=",goog.crypt.base64.ENCODED_VALS_WEBSAFE=goog.crypt.base64.ENCODED_VALS_BASE+"-_.",goog.crypt.base64.HAS_NATIVE_SUPPORT=goog.userAgent.GECKO||goog.userAgent.WEBKIT||goog.userAgent.OPERA||"function"==typeof goog.global.atob,goog.crypt.base64.encodeByteArray=function(a,b){if(!goog.isArrayLike(a))throw Error("encodeByteArray takes an array as a parameter");goog.crypt.base64.init_();for(var c=b?goog.crypt.base64.byteToCharMapWebSafe_:goog.crypt.base64.byteToCharMap_,d=[],e=0;e<a.length;e+=3){var f=a[e],g=e+1<a.length,h=g?a[e+1]:0,i=e+2<a.length,j=i?a[e+2]:0,k=f>>2,l=(3&f)<<4|h>>4,m=(15&h)<<2|j>>6,n=63&j;i||(n=64,g||(m=64)),d.push(c[k],c[l],c[m],c[n])}return d.join("")},goog.crypt.base64.encodeString=function(a,b){return goog.crypt.base64.HAS_NATIVE_SUPPORT&&!b?goog.global.btoa(a):goog.crypt.base64.encodeByteArray(goog.crypt.stringToByteArray(a),b)},goog.crypt.base64.decodeString=function(a,b){return goog.crypt.base64.HAS_NATIVE_SUPPORT&&!b?goog.global.atob(a):goog.crypt.byteArrayToString(goog.crypt.base64.decodeStringToByteArray(a,b))},goog.crypt.base64.decodeStringToByteArray=function(a,b){goog.crypt.base64.init_();for(var c=b?goog.crypt.base64.charToByteMapWebSafe_:goog.crypt.base64.charToByteMap_,d=[],e=0;e<a.length;){var f=c[a.charAt(e++)],g=e<a.length,h=g?c[a.charAt(e)]:0;++e;var i=e<a.length,j=i?c[a.charAt(e)]:64;++e;var k=e<a.length,l=k?c[a.charAt(e)]:64;if(++e,null==f||null==h||null==j||null==l)throw Error();var m=f<<2|h>>4;if(d.push(m),64!=j){var n=h<<4&240|j>>2;if(d.push(n),64!=l){var o=j<<6&192|l;d.push(o)}}}return d},goog.crypt.base64.init_=function(){if(!goog.crypt.base64.byteToCharMap_){goog.crypt.base64.byteToCharMap_={},goog.crypt.base64.charToByteMap_={},goog.crypt.base64.byteToCharMapWebSafe_={},goog.crypt.base64.charToByteMapWebSafe_={};for(var a=0;a<goog.crypt.base64.ENCODED_VALS.length;a++)goog.crypt.base64.byteToCharMap_[a]=goog.crypt.base64.ENCODED_VALS.charAt(a),goog.crypt.base64.charToByteMap_[goog.crypt.base64.byteToCharMap_[a]]=a,goog.crypt.base64.byteToCharMapWebSafe_[a]=goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt(a),goog.crypt.base64.charToByteMapWebSafe_[goog.crypt.base64.byteToCharMapWebSafe_[a]]=a}},goog.provide("fb.core.util"),goog.require("fb.constants"),goog.require("fb.core.RepoInfo"),goog.require("fb.core.storage"),goog.require("fb.util.json"),goog.require("goog.crypt.base64"),goog.require("goog.crypt.Sha1"),fb.core.util.LUIDGenerator=function(){var a=1;return function(){return a++}}(),fb.core.util.assert=function(a,b){if(!a)throw fb.core.util.assertionError(b)},fb.core.util.assertionError=function(a){return new Error("Firebase INTERNAL ASSERT FAILED:"+a)},fb.core.util.assertWeak=function(a,b){a||fb.core.util.error(b)},fb.core.util.base64Encode=function(a){var b=fb.util.utf8.stringToByteArray(a);return goog.crypt.base64.encodeByteArray(b,!0)},fb.core.util.base64Decode=function(a){try{return NODE_CLIENT?new Buffer(a,"base64").toString("utf8"):"undefined"!=typeof atob?atob(a):goog.crypt.base64.decodeString(a,!0)}catch(b){fb.core.util.log("base64Decode failed: ",b)}return null},fb.core.util.sha1=function(a){var b=fb.util.utf8.stringToByteArray(a),c=new goog.crypt.Sha1;c.update(b);var d=c.digest();return goog.crypt.base64.encodeByteArray(d)},fb.core.util.buildLogMessage_=function(){for(var a="",b=0;b<arguments.length;b++)a+=goog.isArrayLike(arguments[b])?fb.core.util.buildLogMessage_.apply(null,arguments[b]):"object"==typeof arguments[b]?fb.util.json.stringify(arguments[b]):arguments[b],a+=" ";return a},fb.core.util.logger=null,fb.core.util.firstLog_=!0,fb.core.util.log=function(){if(fb.core.util.firstLog_===!0&&(fb.core.util.firstLog_=!1,null===fb.core.util.logger&&fb.core.storage.SessionStorage.get("logging_enabled")===!0&&Firebase.enableLogging(!0)),fb.core.util.logger){var a=fb.core.util.buildLogMessage_.apply(null,arguments);fb.core.util.logger(a)}},fb.core.util.logWrapper=function(a){return function(){fb.core.util.log(a,arguments)}},fb.core.util.error=function(){if("undefined"!=typeof console){var a="FIREBASE INTERNAL ERROR: "+fb.core.util.buildLogMessage_.apply(null,arguments);"undefined"!=typeof console.error?console.error(a):console.log(a)}},fb.core.util.fatal=function(){var a=fb.core.util.buildLogMessage_.apply(null,arguments);throw new Error("FIREBASE FATAL ERROR: "+a)},fb.core.util.warn=function(){if("undefined"!=typeof console){var a="FIREBASE WARNING: "+fb.core.util.buildLogMessage_.apply(null,arguments);"undefined"!=typeof console.warn?console.warn(a):console.log(a)}},fb.core.util.warnIfPageIsSecure=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&fb.core.util.warn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},fb.core.util.warnAboutUnsupportedMethod=function(a){fb.core.util.warn(a+" is unsupported and will likely change soon.  Please do not use.")},fb.core.util.parseRepoInfo=function(a){var b=fb.core.util.parseURL(a),c=b.subdomain;"firebase"===b.domain&&fb.core.util.fatal(b.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),c||fb.core.util.fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),b.secure||fb.core.util.warnIfPageIsSecure();var d="ws"===b.scheme||"wss"===b.scheme;return{repoInfo:new fb.core.RepoInfo(b.host,b.secure,c,d),path:new fb.core.util.Path(b.pathString)}},fb.core.util.parseURL=function(a){var b="",c="",d="",e="",f=!0,g="https",h=443;if(goog.isString(a)){var i=a.indexOf("//");i>=0&&(g=a.substring(0,i-1),a=a.substring(i+2));var j=a.indexOf("/");-1===j&&(j=a.length),b=a.substring(0,j),e=fb.core.util.decodePath(a.substring(j));var k=b.split(".");3===k.length?(c=k[1],d=k[0].toLowerCase()):2===k.length&&(c=k[0]),i=b.indexOf(":"),i>=0&&(f="https"===g||"wss"===g,h=goog.string.parseInt(b.substring(i+1)))}return{host:b,port:h,domain:c,subdomain:d,secure:f,scheme:g,pathString:e}},fb.core.util.decodePath=function(a){for(var b="",c=a.split("/"),d=0;d<c.length;d++)if(c[d].length>0){var e=c[d];try{e=goog.string.urlDecode(e)}catch(f){}b+="/"+e}return b},fb.core.util.isInvalidJSONNumber=function(a){return goog.isNumber(a)&&(a!=a||a==Number.POSITIVE_INFINITY||a==Number.NEGATIVE_INFINITY)},fb.core.util.executeWhenDOMReady=function(a){if(NODE_CLIENT||"complete"===document.readyState)a();else{var b=!1,c=function(){return document.body?void(b||(b=!0,a())):void setTimeout(c,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&c()}),window.attachEvent("onload",c))}},fb.core.util.MIN_NAME="[MIN_NAME]",fb.core.util.MAX_NAME="[MAX_NAME]",fb.core.util.nameCompare=function(a,b){if(a===b)return 0;if(a===fb.core.util.MIN_NAME||b===fb.core.util.MAX_NAME)return-1;if(b===fb.core.util.MIN_NAME||a===fb.core.util.MAX_NAME)return 1;var c=fb.core.util.tryParseInt(a),d=fb.core.util.tryParseInt(b);return null!==c?null!==d?c-d==0?a.length-b.length:c-d:-1:null!==d?1:b>a?-1:1},fb.core.util.stringCompare=function(a,b){return a===b?0:b>a?-1:1},fb.core.util.requireKey=function(a,b){if(b&&a in b)return b[a];throw new Error("Missing required key ("+a+") in object: "+fb.util.json.stringify(b))},fb.core.util.ObjectToUniqueKey=function(a){if("object"!=typeof a||null===a)return fb.util.json.stringify(a);var b=[];for(var c in a)b.push(c);b.sort();for(var d="{",e=0;e<b.length;e++)0!==e&&(d+=","),d+=fb.util.json.stringify(b[e]),d+=":",d+=fb.core.util.ObjectToUniqueKey(a[b[e]]);return d+="}"},fb.core.util.splitStringBySize=function(a,b){if(a.length<=b)return[a];for(var c=[],d=0;d<a.length;d+=b)c.push(d+b>a?a.substring(d,a.length):a.substring(d,d+b));
return c},fb.core.util.each=function(a,b){if(goog.isArray(a))for(var c=0;c<a.length;++c)b(c,a[c]);else goog.object.forEach(a,b)},fb.core.util.bindCallback=function(a,b){return b?goog.bind(a,b):a},fb.core.util.doubleToIEEE754String=function(a){fb.core.util.assert(!fb.core.util.isInvalidJSONNumber(a),"Invalid JSON number");var b,c,d,e,f,g,h,i=11,j=52,k=(1<<i-1)-1;for(0===a?(c=0,d=0,b=1/a===-1/0?1:0):(b=0>a,a=Math.abs(a),a>=Math.pow(2,1-k)?(e=Math.min(Math.floor(Math.log(a)/Math.LN2),k),c=e+k,d=Math.round(a*Math.pow(2,j-e)-Math.pow(2,j))):(c=0,d=Math.round(a/Math.pow(2,1-k-j)))),g=[],f=j;f;f-=1)g.push(d%2?1:0),d=Math.floor(d/2);for(f=i;f;f-=1)g.push(c%2?1:0),c=Math.floor(c/2);g.push(b?1:0),g.reverse(),h=g.join("");var l="";for(f=0;64>f;f+=8){var m=parseInt(h.substr(f,8),2).toString(16);1===m.length&&(m="0"+m),l+=m}return l.toLowerCase()},fb.core.util.isChromeExtensionContentScript=function(){return!("object"!=typeof window||!window.chrome||!window.chrome.extension||/^chrome/.test(window.location.href))},fb.core.util.isWindowsStoreApp=function(){return"object"==typeof Windows&&"object"==typeof Windows.UI},fb.core.util.errorForServerCode=function(a){var b="Unknown Error";"too_big"===a?b="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==a?b="Client doesn't have permission to access the desired data.":"unavailable"==a&&(b="The service is unavailable");var c=new Error(a+": "+b);return c.code=a.toUpperCase(),c},fb.core.util.INTEGER_REGEXP_=new RegExp("^-?\\d{1,10}$"),fb.core.util.tryParseInt=function(a){if(fb.core.util.INTEGER_REGEXP_.test(a)){var b=Number(a);if(b>=-2147483648&&2147483647>=b)return b}return null},fb.core.util.exceptionGuard=function(a){try{a()}catch(b){setTimeout(function(){var a=b.stack||"";throw fb.core.util.warn("Exception was thrown by user callback.",a),b},Math.floor(0))}},fb.core.util.callUserCallback=function(a){if(goog.isFunction(a)){var b=Array.prototype.slice.call(arguments,1),c=b.slice();fb.core.util.exceptionGuard(function(){a.apply(null,c)})}},goog.provide("fb.core.view.Event"),fb.core.view.Event=function(){},fb.core.view.Event.prototype.getPath,fb.core.view.Event.prototype.getEventType,fb.core.view.Event.prototype.getEventRunner,fb.core.view.Event.prototype.toString,fb.core.view.DataEvent=function(a,b,c,d){this.eventRegistration=b,this.snapshot=c,this.prevName=d,this.eventType=a},fb.core.view.DataEvent.prototype.getPath=function(){var a=this.snapshot.ref();return"value"===this.eventType?a.path:a.parent().path},fb.core.view.DataEvent.prototype.getEventType=function(){return this.eventType},fb.core.view.DataEvent.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},fb.core.view.DataEvent.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+fb.util.json.stringify(this.snapshot.exportVal())},fb.core.view.CancelEvent=function(a,b,c){this.eventRegistration=a,this.error=b,this.path=c},fb.core.view.CancelEvent.prototype.getPath=function(){return this.path},fb.core.view.CancelEvent.prototype.getEventType=function(){return"cancel"},fb.core.view.CancelEvent.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},fb.core.view.CancelEvent.prototype.toString=function(){return this.path.toString()+":cancel"},goog.provide("fb.core.view.Change"),fb.core.view.Change=function(a,b,c,d,e){this.type=a,this.snapshotNode=b,this.childName=c,this.oldSnap=d,this.prevName=e},fb.core.view.Change.valueChange=function(a){return new fb.core.view.Change(fb.core.view.Change.VALUE,a)},fb.core.view.Change.childAddedChange=function(a,b){return new fb.core.view.Change(fb.core.view.Change.CHILD_ADDED,b,a)},fb.core.view.Change.childRemovedChange=function(a,b){return new fb.core.view.Change(fb.core.view.Change.CHILD_REMOVED,b,a)},fb.core.view.Change.childChangedChange=function(a,b,c){return new fb.core.view.Change(fb.core.view.Change.CHILD_CHANGED,b,a,c)},fb.core.view.Change.childMovedChange=function(a,b){return new fb.core.view.Change(fb.core.view.Change.CHILD_MOVED,b,a)},fb.core.view.Change.prototype.changeWithPrevName=function(a){return new fb.core.view.Change(this.type,this.snapshotNode,this.childName,this.oldSnap,a)},fb.core.view.Change.CHILD_ADDED="child_added",fb.core.view.Change.CHILD_REMOVED="child_removed",fb.core.view.Change.CHILD_CHANGED="child_changed",fb.core.view.Change.CHILD_MOVED="child_moved",fb.core.view.Change.VALUE="value",goog.provide("fb.core.view.EventRegistration"),goog.require("fb.core.view.Change"),goog.require("fb.core.view.Event"),fb.core.view.EventRegistration=function(){},fb.core.view.EventRegistration.prototype.respondsTo,fb.core.view.EventRegistration.prototype.createEvent,fb.core.view.EventRegistration.prototype.getEventRunner,fb.core.view.EventRegistration.prototype.createCancelEvent,fb.core.view.EventRegistration.prototype.matches,fb.core.view.EventRegistration.prototype.hasAnyCallback,fb.core.view.ValueEventRegistration=function(a,b,c){this.callback_=a,this.cancelCallback_=b,this.context_=c||null},fb.core.view.ValueEventRegistration.prototype.respondsTo=function(a){return"value"===a},fb.core.view.ValueEventRegistration.prototype.createEvent=function(a,b){var c=b.getQueryParams().getIndex();return new fb.core.view.DataEvent("value",this,new fb.api.DataSnapshot(a.snapshotNode,b.ref(),c))},fb.core.view.ValueEventRegistration.prototype.getEventRunner=function(a){var b=this.context_;if("cancel"===a.getEventType()){fb.core.util.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var c=this.cancelCallback_;return function(){c.call(b,a.error)}}var d=this.callback_;return function(){d.call(b,a.snapshot)}},fb.core.view.ValueEventRegistration.prototype.createCancelEvent=function(a,b){return this.cancelCallback_?new fb.core.view.CancelEvent(this,a,b):null},fb.core.view.ValueEventRegistration.prototype.matches=function(a){return a instanceof fb.core.view.ValueEventRegistration?a.callback_&&this.callback_?a.callback_===this.callback_&&a.context_===this.context_:!0:!1},fb.core.view.ValueEventRegistration.prototype.hasAnyCallback=function(){return null!==this.callback_},fb.core.view.ChildEventRegistration=function(a,b,c){this.callbacks_=a,this.cancelCallback_=b,this.context_=c},fb.core.view.ChildEventRegistration.prototype.respondsTo=function(a){var b="children_added"===a?"child_added":a;return b="children_removed"===b?"child_removed":b,goog.object.containsKey(this.callbacks_,b)},fb.core.view.ChildEventRegistration.prototype.createCancelEvent=function(a,b){return this.cancelCallback_?new fb.core.view.CancelEvent(this,a,b):null},fb.core.view.ChildEventRegistration.prototype.createEvent=function(a,b){fb.core.util.assert(null!=a.childName,"Child events should have a childName.");var c=b.ref().child(a.childName),d=b.getQueryParams().getIndex();return new fb.core.view.DataEvent(a.type,this,new fb.api.DataSnapshot(a.snapshotNode,c,d),a.prevName)},fb.core.view.ChildEventRegistration.prototype.getEventRunner=function(a){var b=this.context_;if("cancel"===a.getEventType()){fb.core.util.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var c=this.cancelCallback_;return function(){c.call(b,a.error)}}var d=this.callbacks_[a.eventType];return function(){d.call(b,a.snapshot,a.prevName)}},fb.core.view.ChildEventRegistration.prototype.matches=function(a){if(a instanceof fb.core.view.ChildEventRegistration){if(!this.callbacks_||!a.callbacks_)return!0;if(this.context_===a.context_){var b=goog.object.getCount(a.callbacks_),c=goog.object.getCount(this.callbacks_);if(b===c){if(1===b){var d=goog.object.getAnyKey(a.callbacks_),e=goog.object.getAnyKey(this.callbacks_);return!(e!==d||a.callbacks_[d]&&this.callbacks_[e]&&a.callbacks_[d]!==this.callbacks_[e])}return goog.object.every(this.callbacks_,function(b,c){return a.callbacks_[c]===b})}}}return!1},fb.core.view.ChildEventRegistration.prototype.hasAnyCallback=function(){return null!==this.callbacks_},goog.provide("fb.util.utf8"),fb.util.utf8.stringToByteArray=function(a){for(var b=[],c=0,d=0;d<a.length;d++){var e=a.charCodeAt(d);if(e>=55296&&56319>=e){var f=e-55296;d++,fb.core.util.assert(d<a.length,"Surrogate pair missing trail surrogate.");var g=a.charCodeAt(d)-56320;e=65536+(f<<10)+g}128>e?b[c++]=e:2048>e?(b[c++]=e>>6|192,b[c++]=63&e|128):65536>e?(b[c++]=e>>12|224,b[c++]=e>>6&63|128,b[c++]=63&e|128):(b[c++]=e>>18|240,b[c++]=e>>12&63|128,b[c++]=e>>6&63|128,b[c++]=63&e|128)}return b},fb.util.utf8.stringLength=function(a){for(var b=0,c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b++:2048>d?b+=2:d>=55296&&56319>=d?(b+=4,c++):b+=3}return b},goog.provide("fb.util.validation"),fb.util.validation.validateArgCount=function(a,b,c,d){var e;if(b>d?e="at least "+b:d>c&&(e=0===c?"none":"no more than "+c),e){var f=a+" failed: Was called with "+d+(1===d?" argument.":" arguments.")+" Expects "+e+".";throw new Error(f)}},fb.util.validation.errorPrefix=function(a,b,c){var d="";switch(b){case 1:d=c?"first":"First";break;case 2:d=c?"second":"Second";break;case 3:d=c?"third":"Third";break;case 4:d=c?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var e=a+" failed: ";return e+=d+" argument "},fb.util.validation.validateNamespace=function(a,b,c,d){if((!d||goog.isDef(c))&&!goog.isString(c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+"must be a valid firebase namespace.")},fb.util.validation.validateCallback=function(a,b,c,d){if((!d||goog.isDef(c))&&!goog.isFunction(c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+"must be a valid function.")},fb.util.validation.validateContextObject=function(a,b,c,d){if(!(d&&!goog.isDef(c)||goog.isObject(c)&&null!==c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+"must be a valid context object.")},goog.provide("fb.core.util.validation"),goog.require("fb.util.obj"),goog.require("fb.util.utf8"),goog.require("fb.util.validation"),fb.core.util.validation.INVALID_KEY_REGEX_=/[\[\].#$\/\u0000-\u001F\u007F]/,fb.core.util.validation.INVALID_PATH_REGEX_=/[\[\].#$\u0000-\u001F\u007F]/,fb.core.util.validation.MAX_LEAF_SIZE_=10485760,fb.core.util.validation.MAX_DEPTH_SIZE_=1e3,fb.core.util.validation.isValidKey=function(a){return goog.isString(a)&&0!==a.length&&!fb.core.util.validation.INVALID_KEY_REGEX_.test(a)},fb.core.util.validation.isValidPathString=function(a){return goog.isString(a)&&0!==a.length&&!fb.core.util.validation.INVALID_PATH_REGEX_.test(a)},fb.core.util.validation.isValidRootPathString=function(a){return a&&(a=a.replace(/^\/*\.info(\/|$)/,"/")),fb.core.util.validation.isValidPathString(a)},fb.core.util.validation.isValidPriority=function(a){return null===a||goog.isString(a)||goog.isNumber(a)&&!fb.core.util.isInvalidJSONNumber(a)||goog.isObject(a)&&fb.util.obj.contains(a,".sv")},fb.core.util.validation.validateFirebaseDataArg=function(a,b,c,d){(!d||goog.isDef(c))&&fb.core.util.validation.validateFirebaseData(fb.util.validation.errorPrefix(a,b,d),c)},fb.core.util.validation.validateFirebaseData=function(a,b,c,d){c||(c=0);var e=d||[];if(!goog.isDef(b))throw new Error(a+"contains undefined"+fb.core.util.validation.pathLocation_(e));if(goog.isFunction(b))throw new Error(a+"contains a function"+fb.core.util.validation.pathLocation_(e)+" with contents: "+b.toString());if(fb.core.util.isInvalidJSONNumber(b))throw new Error(a+"contains "+b.toString()+fb.core.util.validation.pathLocation_(e));if(c>fb.core.util.validation.MAX_DEPTH_SIZE_)throw new TypeError(a+"contains a cyclic object value ("+e.slice(0,100).join(".")+"...)");if(goog.isString(b)&&b.length>fb.core.util.validation.MAX_LEAF_SIZE_/3&&fb.util.utf8.stringToByteArray(b).length>fb.core.util.validation.MAX_LEAF_SIZE_)throw new Error(a+"contains a string greater than "+fb.core.util.validation.MAX_LEAF_SIZE_+" utf8 bytes"+fb.core.util.validation.pathLocation_(e)+" ('"+b.substring(0,50)+"...')");if(goog.isObject(b)){var f=!1,g=!1;if(fb.util.obj.foreach(b,function(b,d){if(".value"===b)f=!0;else if(".priority"!==b&&".sv"!==b&&(g=!0,!fb.core.util.validation.isValidKey(b)))throw new Error(a+" contains an invalid key ("+b+")"+fb.core.util.validation.pathLocation_(e)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.push(b),fb.core.util.validation.validateFirebaseData(a,d,c+1,e),e.pop()}),f&&g)throw new Error(a+' contains ".value" child'+fb.core.util.validation.pathLocation_(e)+" in addition to actual children.")}},fb.core.util.validation.pathLocation_=function(a){return 0==a.length?"":" in property '"+a.join(".")+"'"},fb.core.util.validation.validateFirebaseMergeDataArg=function(a,b,c,d){if(!d||goog.isDef(c)){if(!goog.isObject(c)||goog.isArray(c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+" must be an Object containing the children to replace.");if(fb.util.obj.contains(c,".value"))throw new Error(fb.util.validation.errorPrefix(a,b,d)+' must not contain ".value".  To overwrite with a leaf value, just use .set() instead.');fb.core.util.validation.validateFirebaseDataArg(a,b,c,d)}},fb.core.util.validation.validatePriority=function(a,b,c,d){if(!d||goog.isDef(c)){if(fb.core.util.isInvalidJSONNumber(c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+"is "+c.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!fb.core.util.validation.isValidPriority(c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},fb.core.util.validation.validateEventType=function(a,b,c,d){if(!d||goog.isDef(c))switch(c){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(fb.util.validation.errorPrefix(a,b,d)+'must be a valid event type: "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},fb.core.util.validation.validateKey=function(a,b,c,d){if((!d||goog.isDef(c))&&!fb.core.util.validation.isValidKey(c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+'was an invalid key: "'+c+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},fb.core.util.validation.validatePathString=function(a,b,c,d){if((!d||goog.isDef(c))&&!fb.core.util.validation.isValidPathString(c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+'was an invalid path: "'+c+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},fb.core.util.validation.validateRootPathString=function(a,b,c,d){c&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),fb.core.util.validation.validatePathString(a,b,c,d)},fb.core.util.validation.validateWritablePath=function(a,b){if(".info"===b.getFront())throw new Error(a+" failed: Can't modify data under /.info/")},fb.core.util.validation.validateUrl=function(a,b,c){var d=c.path.toString();if(!goog.isString(c.repoInfo.host)||0===c.repoInfo.host.length||!fb.core.util.validation.isValidKey(c.repoInfo.namespace)||0!==d.length&&!fb.core.util.validation.isValidRootPathString(d))throw new Error(fb.util.validation.errorPrefix(a,b,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},fb.core.util.validation.validateCredential=function(a,b,c,d){if((!d||goog.isDef(c))&&!goog.isString(c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+"must be a valid credential (a string).")},fb.core.util.validation.validateBoolean=function(a,b,c,d){if((!d||goog.isDef(c))&&!goog.isBoolean(c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+"must be a boolean.")},fb.core.util.validation.validateString=function(a,b,c,d){if((!d||goog.isDef(c))&&!goog.isString(c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+"must be a valid string.")},fb.core.util.validation.validateObject=function(a,b,c,d){if(!(d&&!goog.isDef(c)||goog.isObject(c)&&null!==c))throw new Error(fb.util.validation.errorPrefix(a,b,d)+"must be a valid object.")},fb.core.util.validation.validateObjectContainsKey=function(a,b,c,d,e,f){if(!e||goog.isDef(c)){if(!goog.isObject(c)||null===c||!fb.util.obj.contains(c,d))throw new Error(fb.util.validation.errorPrefix(a,b,e)+'must contain the key "'+d+'"');if(f){var g=fb.util.obj.get(c,d);if("string"===f&&!goog.isString(g)||"boolean"===f&&!goog.isBoolean(g)||"function"===f&&!goog.isFunction(g)||"object"===f&&!goog.isObject(g))throw new Error(fb.util.validation.errorPrefix(a,b,e)+'must contain the key "'+d+'" with type "'+f+'"')}}},goog.provide("fb.core.view.filter.IndexedFilter"),fb.core.view.filter.IndexedFilter=function(a){this.index_=a},fb.core.view.filter.IndexedFilter.prototype.updateChild=function(a,b,c,d,e){var f=fb.core.view.Change;fb.core.util.assert(a.isIndexed(this.index_),"A node must be indexed if only a child is updated");var g=a.getImmediateChild(b);return g.equals(c)?a:(null!=e&&(c.isEmpty()?a.hasChild(b)?e.trackChildChange(f.childRemovedChange(b,g)):fb.core.util.assert(a.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):e.trackChildChange(g.isEmpty()?f.childAddedChange(b,c):f.childChangedChange(b,c,g))),a.isLeafNode()&&c.isEmpty()?a:a.updateImmediateChild(b,c))},fb.core.view.filter.IndexedFilter.prototype.updateFullNode=function(a,b,c){var d=fb.core.view.Change;return null!=c&&(a.isLeafNode()||a.forEachChild(fb.core.snap.PriorityIndex,function(a,e){b.hasChild(a)||c.trackChildChange(d.childRemovedChange(a,e))}),b.isLeafNode()||b.forEachChild(fb.core.snap.PriorityIndex,function(b,e){if(a.hasChild(b)){var f=a.getImmediateChild(b);f.equals(e)||c.trackChildChange(d.childChangedChange(b,e,f))}else c.trackChildChange(d.childAddedChange(b,e))})),b.withIndex(this.index_)},fb.core.view.filter.IndexedFilter.prototype.updatePriority=function(a,b){return a.isEmpty()?fb.core.snap.EMPTY_NODE:a.updatePriority(b)},fb.core.view.filter.IndexedFilter.prototype.filtersNodes=function(){return!1},fb.core.view.filter.IndexedFilter.prototype.getIndexedFilter=function(){return this},fb.core.view.filter.IndexedFilter.prototype.getIndex=function(){return this.index_},goog.provide("fb.core.view.filter.RangedFilter"),goog.require("fb.core.view.filter.IndexedFilter"),fb.core.view.filter.RangedFilter=function(a){this.indexedFilter_=new fb.core.view.filter.IndexedFilter(a.getIndex()),this.index_=a.getIndex(),this.startPost_=this.getStartPost_(a),this.endPost_=this.getEndPost_(a)},fb.core.view.filter.RangedFilter.prototype.getStartPost=function(){return this.startPost_},fb.core.view.filter.RangedFilter.prototype.getEndPost=function(){return this.endPost_},fb.core.view.filter.RangedFilter.prototype.matches=function(a){return this.index_.compare(this.getStartPost(),a)<=0&&this.index_.compare(a,this.getEndPost())<=0},fb.core.view.filter.RangedFilter.prototype.updateChild=function(a,b,c,d,e){return this.matches(new fb.core.snap.NamedNode(b,c))||(c=fb.core.snap.EMPTY_NODE),this.indexedFilter_.updateChild(a,b,c,d,e)},fb.core.view.filter.RangedFilter.prototype.updateFullNode=function(a,b,c){b.isLeafNode()&&(b=fb.core.snap.EMPTY_NODE);var d=b.withIndex(this.index_);d=d.updatePriority(fb.core.snap.EMPTY_NODE);var e=this;return b.forEachChild(fb.core.snap.PriorityIndex,function(a,b){e.matches(new fb.core.snap.NamedNode(a,b))||(d=d.updateImmediateChild(a,fb.core.snap.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(a,d,c)},fb.core.view.filter.RangedFilter.prototype.updatePriority=function(a){return a},fb.core.view.filter.RangedFilter.prototype.filtersNodes=function(){return!0},fb.core.view.filter.RangedFilter.prototype.getIndexedFilter=function(){return this.indexedFilter_},fb.core.view.filter.RangedFilter.prototype.getIndex=function(){return this.index_},fb.core.view.filter.RangedFilter.prototype.getStartPost_=function(a){if(a.hasStart()){var b=a.getIndexStartName();return a.getIndex().makePost(a.getIndexStartValue(),b)}return a.getIndex().minPost()},fb.core.view.filter.RangedFilter.prototype.getEndPost_=function(a){if(a.hasEnd()){var b=a.getIndexEndName();return a.getIndex().makePost(a.getIndexEndValue(),b)}return a.getIndex().maxPost()},goog.provide("fb.core.snap.comparators"),fb.core.snap.NAME_ONLY_COMPARATOR=function(a,b){return fb.core.util.nameCompare(a.name,b.name)},fb.core.snap.NAME_COMPARATOR=function(a,b){return fb.core.util.nameCompare(a,b)},goog.provide("fb.core.snap.Index"),goog.provide("fb.core.snap.PriorityIndex"),goog.provide("fb.core.snap.SubKeyIndex"),goog.require("fb.core.snap.comparators"),fb.core.snap.Index=function(){},fb.core.snap.Index.FallbackType,fb.core.snap.Index.Fallback={},fb.core.snap.Index.prototype.compare=goog.abstractMethod,fb.core.snap.Index.prototype.isDefinedOn=goog.abstractMethod,fb.core.snap.Index.prototype.getCompare=function(){return goog.bind(this.compare,this)},fb.core.snap.Index.prototype.indexedValueChanged=function(a,b){var c=new fb.core.snap.NamedNode(fb.core.util.MIN_NAME,a),d=new fb.core.snap.NamedNode(fb.core.util.MIN_NAME,b);return 0!==this.compare(c,d)},fb.core.snap.Index.prototype.minPost=function(){return fb.core.snap.NamedNode.MIN},fb.core.snap.Index.prototype.maxPost=goog.abstractMethod,fb.core.snap.Index.prototype.makePost=goog.abstractMethod,fb.core.snap.Index.prototype.toString=goog.abstractMethod,fb.core.snap.SubKeyIndex=function(a){fb.core.snap.Index.call(this),this.indexKey_=a},goog.inherits(fb.core.snap.SubKeyIndex,fb.core.snap.Index),fb.core.snap.SubKeyIndex.prototype.extractChild=function(a){return a.getImmediateChild(this.indexKey_)},fb.core.snap.SubKeyIndex.prototype.isDefinedOn=function(a){return!a.getImmediateChild(this.indexKey_).isEmpty()},fb.core.snap.SubKeyIndex.prototype.compare=function(a,b){var c=this.extractChild(a.node),d=this.extractChild(b.node),e=c.compareTo(d);return 0===e?fb.core.util.nameCompare(a.name,b.name):e},fb.core.snap.SubKeyIndex.prototype.makePost=function(a,b){var c=fb.core.snap.NodeFromJSON(a),d=fb.core.snap.EMPTY_NODE.updateImmediateChild(this.indexKey_,c);return new fb.core.snap.NamedNode(b,d)},fb.core.snap.SubKeyIndex.prototype.maxPost=function(){var a=fb.core.snap.EMPTY_NODE.updateImmediateChild(this.indexKey_,fb.core.snap.MAX_NODE);return new fb.core.snap.NamedNode(fb.core.util.MAX_NAME,a)},fb.core.snap.SubKeyIndex.prototype.toString=function(){return this.indexKey_},fb.core.snap.PriorityIndex=new fb.core.snap.SubKeyIndex(".priority"),fb.core.snap.KeyIndex_=function(){fb.core.snap.Index.call(this)},goog.inherits(fb.core.snap.KeyIndex_,fb.core.snap.Index),fb.core.snap.KeyIndex_.prototype.compare=function(a,b){return fb.core.util.nameCompare(a.name,b.name)},fb.core.snap.KeyIndex_.prototype.isDefinedOn=function(){throw fb.core.util.assertionError("KeyIndex.isDefinedOn not expected to be called.")},fb.core.snap.KeyIndex_.prototype.indexedValueChanged=function(){return!1},fb.core.snap.KeyIndex_.prototype.minPost=function(){return fb.core.snap.NamedNode.MIN},fb.core.snap.KeyIndex_.prototype.maxPost=function(){return new fb.core.snap.NamedNode(fb.core.util.MAX_NAME,fb.core.snap.EMPTY_NODE)},fb.core.snap.KeyIndex_.prototype.makePost=function(a){return fb.core.util.assert(goog.isString(a),"KeyIndex indexValue must always be a string."),new fb.core.snap.NamedNode(a,fb.core.snap.EMPTY_NODE)},fb.core.snap.KeyIndex_.prototype.toString=function(){return".key"},fb.core.snap.KeyIndex=new fb.core.snap.KeyIndex_,goog.provide("fb.core.view.CompleteChildSource"),fb.core.view.CompleteChildSource=function(){},fb.core.view.CompleteChildSource.prototype.getCompleteChild=function(){},fb.core.view.CompleteChildSource.prototype.getChildAfterChild=function(){},fb.core.view.NoCompleteChildSource_=function(){},fb.core.view.NoCompleteChildSource_.prototype.getCompleteChild=function(){return null},fb.core.view.NoCompleteChildSource_.prototype.getChildAfterChild=function(){return null},fb.core.view.NO_COMPLETE_CHILD_SOURCE=new fb.core.view.NoCompleteChildSource_,fb.core.view.WriteTreeCompleteChildSource=function(a,b,c){this.writes_=a,this.viewCache_=b,this.optCompleteServerCache_=c},fb.core.view.WriteTreeCompleteChildSource.prototype.getCompleteChild=function(a){var b=this.viewCache_.getEventCache();if(b.isCompleteForChild(a))return b.getNode().getImmediateChild(a);var c=null!=this.optCompleteServerCache_?new fb.core.view.CacheNode(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(a,c)},fb.core.view.WriteTreeCompleteChildSource.prototype.getChildAfterChild=function(a,b,c){var d=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),e=this.writes_.calcIndexedSlice(d,b,1,c,a);return 0===e.length?null:e[0]},goog.provide("fb.core.view.ChildChangeAccumulator"),fb.core.view.ChildChangeAccumulator=function(){this.changeMap_={}},fb.core.view.ChildChangeAccumulator.prototype.trackChildChange=function(a){var b=fb.core.view.Change,c=a.type,d=a.childName;fb.core.util.assert(c==fb.core.view.Change.CHILD_ADDED||c==fb.core.view.Change.CHILD_CHANGED||c==fb.core.view.Change.CHILD_REMOVED,"Only child changes supported for tracking"),fb.core.util.assert(".priority"!==d,"Only non-priority child changes can be tracked.");var e=fb.util.obj.get(this.changeMap_,d);if(e){var f=e.type;if(c==b.CHILD_ADDED&&f==b.CHILD_REMOVED)this.changeMap_[d]=b.childChangedChange(d,a.snapshotNode,e.snapshotNode);else if(c==b.CHILD_REMOVED&&f==b.CHILD_ADDED)delete this.changeMap_[d];else if(c==b.CHILD_REMOVED&&f==b.CHILD_CHANGED)this.changeMap_[d]=b.childRemovedChange(d,e.oldSnap);else if(c==b.CHILD_CHANGED&&f==b.CHILD_ADDED)this.changeMap_[d]=b.childAddedChange(d,a.snapshotNode);else{if(c!=b.CHILD_CHANGED||f!=b.CHILD_CHANGED)throw fb.core.util.assertionError("Illegal combination of changes: "+a+" occurred after "+e);this.changeMap_[d]=b.childChangedChange(d,a.snapshotNode,e.oldSnap)}}else this.changeMap_[d]=a},fb.core.view.ChildChangeAccumulator.prototype.getChanges=function(){return goog.object.getValues(this.changeMap_)},goog.provide("fb.core.view.filter.NodeFilter"),goog.require("fb.core.view.ChildChangeAccumulator"),goog.require("fb.core.view.CompleteChildSource"),fb.core.view.filter.NodeFilter=function(){},fb.core.view.filter.NodeFilter.prototype.updateChild=function(){},fb.core.view.filter.NodeFilter.prototype.updateFullNode=function(){},fb.core.view.filter.NodeFilter.prototype.updatePriority=function(){},fb.core.view.filter.NodeFilter.prototype.filtersNodes=function(){},fb.core.view.filter.NodeFilter.prototype.getIndexedFilter=function(){},fb.core.view.filter.NodeFilter.prototype.getIndex=function(){},goog.provide("fb.core.snap.Node"),goog.provide("fb.core.snap.NamedNode"),fb.core.snap.Node=function(){},fb.core.snap.Node.prototype.isLeafNode,fb.core.snap.Node.prototype.getPriority,fb.core.snap.Node.prototype.updatePriority,fb.core.snap.Node.prototype.getImmediateChild,fb.core.snap.Node.prototype.getChild,fb.core.snap.Node.prototype.getPredecessorChildName,fb.core.snap.Node.prototype.updateImmediateChild,fb.core.snap.Node.prototype.updateChild,fb.core.snap.Node.prototype.hasChild,fb.core.snap.Node.prototype.isEmpty,fb.core.snap.Node.prototype.numChildren,fb.core.snap.Node.prototype.val,fb.core.snap.Node.prototype.hash,fb.core.snap.Node.prototype.compareTo,fb.core.snap.Node.prototype.equals,fb.core.snap.Node.prototype.withIndex,fb.core.snap.Node.prototype.isIndexed,fb.core.snap.NamedNode=function(a,b){this.name=a,this.node=b},fb.core.snap.NamedNode.Wrap=function(a,b){return new fb.core.snap.NamedNode(a,b)},goog.provide("fb.core.view.filter.LimitedFilter"),goog.require("fb.core.snap.NamedNode"),goog.require("fb.core.view.filter.RangedFilter"),fb.core.view.filter.LimitedFilter=function(a){this.rangedFilter_=new fb.core.view.filter.RangedFilter(a),this.index_=a.getIndex(),this.limit_=a.getLimit(),this.reverse_=!a.isViewFromLeft()},fb.core.view.filter.LimitedFilter.prototype.updateChild=function(a,b,c,d,e){return this.rangedFilter_.matches(new fb.core.snap.NamedNode(b,c))||(c=fb.core.snap.EMPTY_NODE),a.getImmediateChild(b).equals(c)?a:a.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(a,b,c,d,e):this.fullLimitUpdateChild_(a,b,c,d,e)},fb.core.view.filter.LimitedFilter.prototype.updateFullNode=function(a,b,c){var d;if(b.isLeafNode()||b.isEmpty())d=fb.core.snap.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<b.numChildren()&&b.isIndexed(this.index_)){d=fb.core.snap.EMPTY_NODE.withIndex(this.index_);var e;b=b,e=this.reverse_?b.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):b.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var f=0;e.hasNext()&&f<this.limit_;){var g,h=e.getNext();if(g=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),h)<=0:this.index_.compare(h,this.rangedFilter_.getEndPost())<=0,!g)break;d=d.updateImmediateChild(h.name,h.node),f++}}else{d=b.withIndex(this.index_),d=d.updatePriority(fb.core.snap.EMPTY_NODE);var i,j,k;if(this.reverse_){e=d.getReverseIterator(this.index_),i=this.rangedFilter_.getEndPost(),j=this.rangedFilter_.getStartPost();var l=this.index_.getCompare();k=function(a,b){return l(b,a)}}else e=d.getIterator(this.index_),i=this.rangedFilter_.getStartPost(),j=this.rangedFilter_.getEndPost(),k=this.index_.getCompare();f=0;for(var m=!1;e.hasNext();)h=e.getNext(),!m&&k(i,h)<=0&&(m=!0),g=m&&f<this.limit_&&k(h,j)<=0,g?f++:d=d.updateImmediateChild(h.name,fb.core.snap.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(a,d,c)},fb.core.view.filter.LimitedFilter.prototype.updatePriority=function(a){return a},fb.core.view.filter.LimitedFilter.prototype.filtersNodes=function(){return!0},fb.core.view.filter.LimitedFilter.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},fb.core.view.filter.LimitedFilter.prototype.getIndex=function(){return this.index_},fb.core.view.filter.LimitedFilter.prototype.fullLimitUpdateChild_=function(a,b,c,d,e){var f,g=fb.core.view.Change;if(this.reverse_){var h=this.index_.getCompare();f=function(a,b){return h(b,a)}}else f=this.index_.getCompare();var i=a;fb.core.util.assert(i.numChildren()==this.limit_,"");var j=new fb.core.snap.NamedNode(b,c),k=this.reverse_?i.getFirstChild(this.index_):i.getLastChild(this.index_),l=this.rangedFilter_.matches(j);if(i.hasChild(b)){var m=i.getImmediateChild(b),n=d.getChildAfterChild(this.index_,k,this.reverse_);null!=n&&n.name==b&&(n=d.getChildAfterChild(this.index_,n,this.reverse_));var o=null==n?1:f(n,j),p=l&&!c.isEmpty()&&o>=0;if(p)return null!=e&&e.trackChildChange(g.childChangedChange(b,c,m)),i.updateImmediateChild(b,c);null!=e&&e.trackChildChange(g.childRemovedChange(b,m));var q=i.updateImmediateChild(b,fb.core.snap.EMPTY_NODE),r=null!=n&&this.rangedFilter_.matches(n);return r?(null!=e&&e.trackChildChange(g.childAddedChange(n.name,n.node)),q.updateImmediateChild(n.name,n.node)):q}return c.isEmpty()?a:l&&f(k,j)>=0?(null!=e&&(e.trackChildChange(g.childRemovedChange(k.name,k.node)),e.trackChildChange(g.childAddedChange(b,c))),i.updateImmediateChild(b,c).updateImmediateChild(k.name,fb.core.snap.EMPTY_NODE)):a},goog.provide("fb.core.view.QueryParams"),goog.require("fb.core.snap.Index"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.util"),goog.require("fb.core.view.filter.IndexedFilter"),goog.require("fb.core.view.filter.LimitedFilter"),goog.require("fb.core.view.filter.NodeFilter"),goog.require("fb.core.view.filter.RangedFilter"),fb.core.view.QueryParams=function(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=fb.core.snap.PriorityIndex},fb.core.view.QueryParams.INDEX_START_VALUE="sp",fb.core.view.QueryParams.INDEX_START_NAME="sn",fb.core.view.QueryParams.INDEX_END_VALUE="ep",fb.core.view.QueryParams.INDEX_END_NAME="en",fb.core.view.QueryParams.LIMIT="l",fb.core.view.QueryParams.VIEW_FROM="vf",fb.core.view.QueryParams.VIEW_FROM_LEFT="l",fb.core.view.QueryParams.VIEW_FROM_RIGHT="r",fb.core.view.QueryParams.INDEX="i",fb.core.view.QueryParams.DEFAULT=new fb.core.view.QueryParams,fb.core.view.QueryParams.prototype.hasStart=function(){return this.startSet_
},fb.core.view.QueryParams.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},fb.core.view.QueryParams.prototype.getIndexStartValue=function(){return fb.core.util.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},fb.core.view.QueryParams.prototype.getIndexStartName=function(){return fb.core.util.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:fb.core.util.MIN_NAME},fb.core.view.QueryParams.prototype.hasEnd=function(){return this.endSet_},fb.core.view.QueryParams.prototype.getIndexEndValue=function(){return fb.core.util.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},fb.core.view.QueryParams.prototype.getIndexEndName=function(){return fb.core.util.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:fb.core.util.MAX_NAME},fb.core.view.QueryParams.prototype.hasLimit=function(){return this.limitSet_},fb.core.view.QueryParams.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},fb.core.view.QueryParams.prototype.getLimit=function(){return fb.core.util.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},fb.core.view.QueryParams.prototype.getIndex=function(){return this.index_},fb.core.view.QueryParams.prototype.copy_=function(){var a=new fb.core.view.QueryParams;return a.limitSet_=this.limitSet_,a.limit_=this.limit_,a.startSet_=this.startSet_,a.indexStartValue_=this.indexStartValue_,a.startNameSet_=this.startNameSet_,a.indexStartName_=this.indexStartName_,a.endSet_=this.endSet_,a.indexEndValue_=this.indexEndValue_,a.endNameSet_=this.endNameSet_,a.indexEndName_=this.indexEndName_,a.index_=this.index_,a},fb.core.view.QueryParams.prototype.limit=function(a){var b=this.copy_();return b.limitSet_=!0,b.limit_=a,b.viewFrom_="",b},fb.core.view.QueryParams.prototype.limitToFirst=function(a){var b=this.copy_();return b.limitSet_=!0,b.limit_=a,b.viewFrom_=fb.core.view.QueryParams.VIEW_FROM_LEFT,b},fb.core.view.QueryParams.prototype.limitToLast=function(a){var b=this.copy_();return b.limitSet_=!0,b.limit_=a,b.viewFrom_=fb.core.view.QueryParams.VIEW_FROM_RIGHT,b},fb.core.view.QueryParams.prototype.startAt=function(a,b){var c=this.copy_();return c.startSet_=!0,goog.isDef(a)||(a=null),c.indexStartValue_=a,null!=b?(c.startNameSet_=!0,c.indexStartName_=b):(c.startNameSet_=!1,c.indexStartName_=""),c},fb.core.view.QueryParams.prototype.endAt=function(a,b){var c=this.copy_();return c.endSet_=!0,goog.isDef(a)||(a=null),c.indexEndValue_=a,goog.isDef(b)?(c.endNameSet_=!0,c.indexEndName_=b):(c.startEndSet_=!1,c.indexEndName_=""),c},fb.core.view.QueryParams.prototype.orderBy=function(a){var b=this.copy_();return b.index_=a,b},fb.core.view.QueryParams.prototype.getQueryObject=function(){var a={};if(this.startSet_&&(a[fb.core.view.QueryParams.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(a[fb.core.view.QueryParams.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(a[fb.core.view.QueryParams.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(a[fb.core.view.QueryParams.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){a[fb.core.view.QueryParams.LIMIT]=this.limit_;var b=this.viewFrom_;""===b&&(b=this.startSet_?"l":"r"),a[fb.core.view.QueryParams.VIEW_FROM]=b}return this.index_!==fb.core.snap.PriorityIndex&&(a[fb.core.view.QueryParams.INDEX]=this.index_.toString()),a},fb.core.view.QueryParams.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},fb.core.view.QueryParams.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==fb.core.snap.PriorityIndex},fb.core.view.QueryParams.prototype.getNodeFilter=function(){return this.loadsAllData()?new fb.core.view.filter.IndexedFilter(this.getIndex()):this.hasLimit()?new fb.core.view.filter.LimitedFilter(this):new fb.core.view.filter.RangedFilter(this)},goog.DEBUG&&(fb.core.view.QueryParams.prototype.toString=function(){return fb.util.json.stringify(this.getQueryObject())}),goog.provide("fb.api.Query"),goog.require("fb.core.snap.Index"),goog.require("fb.core.util"),goog.require("fb.core.util.validation"),goog.require("fb.core.view.EventRegistration"),goog.require("fb.core.view.QueryParams"),goog.require("fb.util.json"),fb.api.Query=function(a,b,c,d){this.repo=a,this.path=b,this.queryParams_=c,this.orderByCalled_=d},fb.api.Query.prototype.validateQueryEndpoints_=function(a){var b=null,c=null;if(a.hasStart()&&(b=a.getIndexStartValue()),a.hasEnd()&&(c=a.getIndexEndValue()),a.getIndex()===fb.core.snap.KeyIndex){var d="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",e="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(a.hasStart()){var f=a.getIndexStartName();if(f!=fb.core.util.MIN_NAME)throw new Error(d);if(null!=b&&"string"!=typeof b)throw new Error(e)}if(a.hasEnd()){var g=a.getIndexEndName();if(g!=fb.core.util.MAX_NAME)throw new Error(d);if(null!=c&&"string"!=typeof c)throw new Error(e)}}else if(a.getIndex()===fb.core.snap.PriorityIndex){if(null!=b&&!fb.core.util.validation.isValidPriority(b)||null!=c&&!fb.core.util.validation.isValidPriority(c))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(fb.core.util.assert(a.getIndex()instanceof fb.core.snap.SubKeyIndex,"unknown index type."),null!=b&&"object"==typeof b||null!=c&&"object"==typeof c)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},fb.api.Query.prototype.validateLimit_=function(a){if(a.hasStart()&&a.hasEnd()&&a.hasLimit()&&!a.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},fb.api.Query.prototype.validateNoPreviousOrderByCall_=function(a){if(this.orderByCalled_===!0)throw new Error(a+": You can't combine multiple orderBy calls.")},fb.api.Query.prototype.getQueryParams=function(){return this.queryParams_},fb.api.Query.prototype.ref=function(){return fb.util.validation.validateArgCount("Query.ref",0,0,arguments.length),new Firebase(this.repo,this.path)},goog.exportProperty(fb.api.Query.prototype,"ref",fb.api.Query.prototype.ref),fb.api.Query.prototype.on=function(a,b,c,d){fb.util.validation.validateArgCount("Query.on",2,4,arguments.length),fb.core.util.validation.validateEventType("Query.on",1,a,!1),fb.util.validation.validateCallback("Query.on",2,b,!1);var e=this.getCancelAndContextArgs_("Query.on",c,d);if("value"===a)this.onValueEvent(b,e.cancel,e.context);else{var f={};f[a]=b,this.onChildEvent(f,e.cancel,e.context)}return b},goog.exportProperty(fb.api.Query.prototype,"on",fb.api.Query.prototype.on),fb.api.Query.prototype.onValueEvent=function(a,b,c){var d=new fb.core.view.ValueEventRegistration(a,b||null,c||null);this.repo.addEventCallbackForQuery(this,d)},fb.api.Query.prototype.onChildEvent=function(a,b,c){var d=new fb.core.view.ChildEventRegistration(a,b,c);this.repo.addEventCallbackForQuery(this,d)},fb.api.Query.prototype.off=function(a,b,c){fb.util.validation.validateArgCount("Query.off",0,3,arguments.length),fb.core.util.validation.validateEventType("Query.off",1,a,!0),fb.util.validation.validateCallback("Query.off",2,b,!0),fb.util.validation.validateContextObject("Query.off",3,c,!0);var d=null,e=null;if("value"===a){var f=b||null;d=new fb.core.view.ValueEventRegistration(f,null,c||null)}else a&&(b&&(e={},e[a]=b),d=new fb.core.view.ChildEventRegistration(e,null,c||null));this.repo.removeEventCallbackForQuery(this,d)},goog.exportProperty(fb.api.Query.prototype,"off",fb.api.Query.prototype.off),fb.api.Query.prototype.once=function(a,b){fb.util.validation.validateArgCount("Query.once",2,4,arguments.length),fb.core.util.validation.validateEventType("Query.once",1,a,!1),fb.util.validation.validateCallback("Query.once",2,b,!1);var c=this.getCancelAndContextArgs_("Query.once",arguments[2],arguments[3]),d=this,e=!0,f=function(g){e&&(e=!1,d.off(a,f),goog.bind(b,c.context)(g))};this.on(a,f,function(b){d.off(a,f),c.cancel&&goog.bind(c.cancel,c.context)(b)})},goog.exportProperty(fb.api.Query.prototype,"once",fb.api.Query.prototype.once),fb.api.Query.prototype.limit=function(a){if(fb.core.util.warn("Query.limit() being deprecated. Please use Query.limitToFirst() or Query.limitToLast() instead."),fb.util.validation.validateArgCount("Query.limit",1,1,arguments.length),!goog.isNumber(a)||Math.floor(a)!==a||0>=a)throw new Error("Query.limit: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limit: Limit was already set (by another call to limit, limitToFirst, orlimitToLast.");var b=this.queryParams_.limit(a);return this.validateLimit_(b),new fb.api.Query(this.repo,this.path,b,this.orderByCalled_)},goog.exportProperty(fb.api.Query.prototype,"limit",fb.api.Query.prototype.limit),fb.api.Query.prototype.limitToFirst=function(a){if(fb.util.validation.validateArgCount("Query.limitToFirst",1,1,arguments.length),!goog.isNumber(a)||Math.floor(a)!==a||0>=a)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new fb.api.Query(this.repo,this.path,this.queryParams_.limitToFirst(a),this.orderByCalled_)},goog.exportProperty(fb.api.Query.prototype,"limitToFirst",fb.api.Query.prototype.limitToFirst),fb.api.Query.prototype.limitToLast=function(a){if(fb.util.validation.validateArgCount("Query.limitToLast",1,1,arguments.length),!goog.isNumber(a)||Math.floor(a)!==a||0>=a)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new fb.api.Query(this.repo,this.path,this.queryParams_.limitToLast(a),this.orderByCalled_)},goog.exportProperty(fb.api.Query.prototype,"limitToLast",fb.api.Query.prototype.limitToLast),fb.api.Query.prototype.orderByChild=function(a){if(fb.util.validation.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===a)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===a)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');fb.core.util.validation.validateKey("Query.orderByChild",1,a,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var b=new fb.core.snap.SubKeyIndex(a),c=this.queryParams_.orderBy(b);return this.validateQueryEndpoints_(c),new fb.api.Query(this.repo,this.path,c,!0)},goog.exportProperty(fb.api.Query.prototype,"orderByChild",fb.api.Query.prototype.orderByChild),fb.api.Query.prototype.orderByKey=function(){fb.util.validation.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var a=this.queryParams_.orderBy(fb.core.snap.KeyIndex);return this.validateQueryEndpoints_(a),new fb.api.Query(this.repo,this.path,a,!0)},goog.exportProperty(fb.api.Query.prototype,"orderByKey",fb.api.Query.prototype.orderByKey),fb.api.Query.prototype.orderByPriority=function(){fb.util.validation.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var a=this.queryParams_.orderBy(fb.core.snap.PriorityIndex);return this.validateQueryEndpoints_(a),new fb.api.Query(this.repo,this.path,a,!0)},goog.exportProperty(fb.api.Query.prototype,"orderByPriority",fb.api.Query.prototype.orderByPriority),fb.api.Query.prototype.startAt=function(a,b){fb.util.validation.validateArgCount("Query.startAt",0,2,arguments.length),fb.core.util.validation.validateFirebaseDataArg("Query.startAt",1,a,!0),fb.core.util.validation.validateKey("Query.startAt",2,b,!0);var c=this.queryParams_.startAt(a,b);if(this.validateLimit_(c),this.validateQueryEndpoints_(c),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return goog.isDef(a)||(a=null,b=null),new fb.api.Query(this.repo,this.path,c,this.orderByCalled_)},goog.exportProperty(fb.api.Query.prototype,"startAt",fb.api.Query.prototype.startAt),fb.api.Query.prototype.endAt=function(a,b){fb.util.validation.validateArgCount("Query.endAt",0,2,arguments.length),fb.core.util.validation.validateFirebaseDataArg("Query.endAt",1,a,!0),fb.core.util.validation.validateKey("Query.endAt",2,b,!0);var c=this.queryParams_.endAt(a,b);if(this.validateLimit_(c),this.validateQueryEndpoints_(c),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new fb.api.Query(this.repo,this.path,c,this.orderByCalled_)},goog.exportProperty(fb.api.Query.prototype,"endAt",fb.api.Query.prototype.endAt),fb.api.Query.prototype.equalTo=function(a,b){if(fb.util.validation.validateArgCount("Query.equalTo",1,2,arguments.length),fb.core.util.validation.validateFirebaseDataArg("Query.equalTo",1,a,!1),fb.core.util.validation.validateKey("Query.equalTo",2,b,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to endAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(a,b).endAt(a,b)},goog.exportProperty(fb.api.Query.prototype,"equalTo",fb.api.Query.prototype.equalTo),fb.api.Query.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},fb.api.Query.prototype.queryIdentifier=function(){var a=this.queryObject(),b=fb.core.util.ObjectToUniqueKey(a);return"{}"===b?"default":b},fb.api.Query.prototype.getCancelAndContextArgs_=function(a,b,c){var d={cancel:null,context:null};if(b&&c)d.cancel=b,fb.util.validation.validateCallback(a,3,d.cancel,!0),d.context=c,fb.util.validation.validateContextObject(a,4,d.context,!0);else if(b)if("object"==typeof b&&null!==b)d.context=b;else{if("function"!=typeof b)throw new Error(fb.util.validation.errorPrefix(a,3,!0)+" must either be a cancel callback or a context object.");d.cancel=b}return d},goog.provide("fb.core.util.Path"),fb.core.util.Path=function(a,b){if(1==arguments.length){this.pieces_=a.split("/");for(var c=0,d=0;d<this.pieces_.length;d++)this.pieces_[d].length>0&&(this.pieces_[c]=this.pieces_[d],c++);this.pieces_.length=c,this.pieceNum_=0}else this.pieces_=a,this.pieceNum_=b},fb.core.util.Path.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},fb.core.util.Path.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},fb.core.util.Path.prototype.popFront=function(){var a=this.pieceNum_;return a<this.pieces_.length&&a++,new fb.core.util.Path(this.pieces_,a)},fb.core.util.Path.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},fb.core.util.Path.prototype.toString=function(){for(var a="",b=this.pieceNum_;b<this.pieces_.length;b++)""!==this.pieces_[b]&&(a+="/"+this.pieces_[b]);return a||"/"},fb.core.util.Path.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var a=[],b=this.pieceNum_;b<this.pieces_.length-1;b++)a.push(this.pieces_[b]);return new fb.core.util.Path(a,0)},fb.core.util.Path.prototype.child=function(a){for(var b=[],c=this.pieceNum_;c<this.pieces_.length;c++)b.push(this.pieces_[c]);if(a instanceof fb.core.util.Path)for(c=a.pieceNum_;c<a.pieces_.length;c++)b.push(a.pieces_[c]);else{var d=a.split("/");for(c=0;c<d.length;c++)d[c].length>0&&b.push(d[c])}return new fb.core.util.Path(b,0)},fb.core.util.Path.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},fb.core.util.Path.Empty=new fb.core.util.Path(""),fb.core.util.Path.RelativePath=function(a,b){var c=a.getFront(),d=b.getFront();if(null===c)return b;if(c===d)return fb.core.util.Path.RelativePath(a.popFront(),b.popFront());throw new Error("INTERNAL ERROR: innerPath ("+b+") is not within outerPath ("+a+")")},fb.core.util.Path.prototype.equals=function(a){if(this.getLength()!==a.getLength())return!1;for(var b=this.pieceNum_,c=a.pieceNum_;b<=this.pieces_.length;b++,c++)if(this.pieces_[b]!==a.pieces_[c])return!1;return!0},fb.core.util.Path.prototype.contains=function(a){var b=this.pieceNum_,c=a.pieceNum_;if(this.getLength()>a.getLength())return!1;for(;b<this.pieces_.length;){if(this.pieces_[b]!==a.pieces_[c])return!1;++b,++c}return!0},goog.provide("fb.core.util.Tree"),goog.require("fb.core.util.Path"),goog.require("fb.util.obj"),fb.core.util.TreeNode=function(){this.children={},this.childCount=0,this.value=null},fb.core.util.Tree=function(a,b,c){this.name_=a?a:"",this.parent_=b?b:null,this.node_=c?c:new fb.core.util.TreeNode},fb.core.util.Tree.prototype.subTree=function(a){for(var b,c=a instanceof fb.core.util.Path?a:new fb.core.util.Path(a),d=this;null!==(b=c.getFront());){var e=fb.util.obj.get(d.node_.children,b)||new fb.core.util.TreeNode;d=new fb.core.util.Tree(b,d,e),c=c.popFront()}return d},fb.core.util.Tree.prototype.getValue=function(){return this.node_.value},fb.core.util.Tree.prototype.setValue=function(a){fb.core.util.assert("undefined"!=typeof a,"Cannot set value to undefined"),this.node_.value=a,this.updateParents_()},fb.core.util.Tree.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},fb.core.util.Tree.prototype.hasChildren=function(){return this.node_.childCount>0},fb.core.util.Tree.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},fb.core.util.Tree.prototype.forEachChild=function(a){var b=this;goog.object.forEach(this.node_.children,function(c,d){a(new fb.core.util.Tree(d,b,c))})},fb.core.util.Tree.prototype.forEachDescendant=function(a,b,c){b&&!c&&a(this),this.forEachChild(function(b){b.forEachDescendant(a,!0,c)}),b&&c&&a(this)},fb.core.util.Tree.prototype.forEachAncestor=function(a,b){for(var c=b?this:this.parent();null!==c;){if(a(c))return!0;c=c.parent()}return!1},fb.core.util.Tree.prototype.forEachImmediateDescendantWithValue=function(a){this.forEachChild(function(b){null!==b.getValue()?a(b):b.forEachImmediateDescendantWithValue(a)})},fb.core.util.Tree.prototype.path=function(){return new fb.core.util.Path(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},fb.core.util.Tree.prototype.name=function(){return this.name_},fb.core.util.Tree.prototype.parent=function(){return this.parent_},fb.core.util.Tree.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},fb.core.util.Tree.prototype.updateChild_=function(a,b){var c=b.isEmpty(),d=fb.util.obj.contains(this.node_.children,a);c&&d?(delete this.node_.children[a],this.node_.childCount--,this.updateParents_()):c||d||(this.node_.children[a]=b.node_,this.node_.childCount++,this.updateParents_())},goog.provide("fb.core.util.SortedMap"),fb.Comparator,fb.core.util.SortedMap=function(a,b){this.comparator_=a,this.root_=b?b:fb.core.util.SortedMap.EMPTY_NODE_},fb.core.util.SortedMap.prototype.insert=function(a,b){return new fb.core.util.SortedMap(this.comparator_,this.root_.insert(a,b,this.comparator_).copy(null,null,fb.LLRBNode.BLACK,null,null))},fb.core.util.SortedMap.prototype.remove=function(a){return new fb.core.util.SortedMap(this.comparator_,this.root_.remove(a,this.comparator_).copy(null,null,fb.LLRBNode.BLACK,null,null))},fb.core.util.SortedMap.prototype.get=function(a){for(var b,c=this.root_;!c.isEmpty();){if(b=this.comparator_(a,c.key),0===b)return c.value;0>b?c=c.left:b>0&&(c=c.right)}return null},fb.core.util.SortedMap.prototype.getPredecessorKey=function(a){for(var b,c=this.root_,d=null;!c.isEmpty();){if(b=this.comparator_(a,c.key),0===b){if(c.left.isEmpty())return d?d.key:null;for(c=c.left;!c.right.isEmpty();)c=c.right;return c.key}0>b?c=c.left:b>0&&(d=c,c=c.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},fb.core.util.SortedMap.prototype.isEmpty=function(){return this.root_.isEmpty()},fb.core.util.SortedMap.prototype.count=function(){return this.root_.count()},fb.core.util.SortedMap.prototype.minKey=function(){return this.root_.minKey()},fb.core.util.SortedMap.prototype.maxKey=function(){return this.root_.maxKey()},fb.core.util.SortedMap.prototype.inorderTraversal=function(a){return this.root_.inorderTraversal(a)},fb.core.util.SortedMap.prototype.reverseTraversal=function(a){return this.root_.reverseTraversal(a)},fb.core.util.SortedMap.prototype.getIterator=function(a){return new fb.core.util.SortedMapIterator(this.root_,null,this.comparator_,!1,a)},fb.core.util.SortedMap.prototype.getIteratorFrom=function(a,b){return new fb.core.util.SortedMapIterator(this.root_,a,this.comparator_,!1,b)},fb.core.util.SortedMap.prototype.getReverseIteratorFrom=function(a,b){return new fb.core.util.SortedMapIterator(this.root_,a,this.comparator_,!0,b)},fb.core.util.SortedMap.prototype.getReverseIterator=function(a){return new fb.core.util.SortedMapIterator(this.root_,null,this.comparator_,!0,a)},fb.core.util.SortedMapIterator=function(a,b,c,d,e){this.resultGenerator_=e||null,this.isReverse_=d,this.nodeStack_=[];for(var f=1;!a.isEmpty();)if(f=b?c(a.key,b):1,d&&(f*=-1),0>f)a=this.isReverse_?a.left:a.right;else{if(0===f){this.nodeStack_.push(a);break}this.nodeStack_.push(a),a=this.isReverse_?a.right:a.left}},fb.core.util.SortedMapIterator.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var a,b=this.nodeStack_.pop();if(a=this.resultGenerator_?this.resultGenerator_(b.key,b.value):{key:b.key,value:b.value},this.isReverse_)for(b=b.left;!b.isEmpty();)this.nodeStack_.push(b),b=b.right;else for(b=b.right;!b.isEmpty();)this.nodeStack_.push(b),b=b.left;return a},fb.core.util.SortedMapIterator.prototype.hasNext=function(){return this.nodeStack_.length>0},fb.core.util.SortedMapIterator.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var a=goog.array.peek(this.nodeStack_);return this.resultGenerator_?this.resultGenerator_(a.key,a.value):{key:a.key,value:a.value}},fb.LLRBNode=function(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:fb.LLRBNode.RED,this.left=null!=d?d:fb.core.util.SortedMap.EMPTY_NODE_,this.right=null!=e?e:fb.core.util.SortedMap.EMPTY_NODE_},fb.LLRBNode.RED=!0,fb.LLRBNode.BLACK=!1,fb.LLRBNode.prototype.copy=function(a,b,c,d,e){return new fb.LLRBNode(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)},fb.LLRBNode.prototype.count=function(){return this.left.count()+1+this.right.count()},fb.LLRBNode.prototype.isEmpty=function(){return!1},fb.LLRBNode.prototype.inorderTraversal=function(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)},fb.LLRBNode.prototype.reverseTraversal=function(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)},fb.LLRBNode.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},fb.LLRBNode.prototype.minKey=function(){return this.min_().key},fb.LLRBNode.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},fb.LLRBNode.prototype.insert=function(a,b,c){var d,e;return e=this,d=c(a,e.key),e=0>d?e.copy(null,null,null,e.left.insert(a,b,c),null):0===d?e.copy(null,b,null,null,null):e.copy(null,null,null,null,e.right.insert(a,b,c)),e.fixUp_()},fb.LLRBNode.prototype.removeMin_=function(){var a;return this.left.isEmpty()?fb.core.util.SortedMap.EMPTY_NODE_:(a=this,a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),a=a.copy(null,null,null,a.left.removeMin_(),null),a.fixUp_())},fb.LLRBNode.prototype.remove=function(a,b){var c,d;if(c=this,b(a,c.key)<0)c.left.isEmpty()||c.left.isRed_()||c.left.left.isRed_()||(c=c.moveRedLeft_()),c=c.copy(null,null,null,c.left.remove(a,b),null);else{if(c.left.isRed_()&&(c=c.rotateRight_()),c.right.isEmpty()||c.right.isRed_()||c.right.left.isRed_()||(c=c.moveRedRight_()),0===b(a,c.key)){if(c.right.isEmpty())return fb.core.util.SortedMap.EMPTY_NODE_;d=c.right.min_(),c=c.copy(d.key,d.value,null,null,c.right.removeMin_())}c=c.copy(null,null,null,null,c.right.remove(a,b))}return c.fixUp_()},fb.LLRBNode.prototype.isRed_=function(){return this.color},fb.LLRBNode.prototype.fixUp_=function(){var a=this;return a.right.isRed_()&&!a.left.isRed_()&&(a=a.rotateLeft_()),a.left.isRed_()&&a.left.left.isRed_()&&(a=a.rotateRight_()),a.left.isRed_()&&a.right.isRed_()&&(a=a.colorFlip_()),a},fb.LLRBNode.prototype.moveRedLeft_=function(){var a=this.colorFlip_();return a.right.left.isRed_()&&(a=a.copy(null,null,null,null,a.right.rotateRight_()),a=a.rotateLeft_(),a=a.colorFlip_()),a},fb.LLRBNode.prototype.moveRedRight_=function(){var a=this.colorFlip_();return a.left.left.isRed_()&&(a=a.rotateRight_(),a=a.colorFlip_()),a},fb.LLRBNode.prototype.rotateLeft_=function(){var a;return a=this.copy(null,null,fb.LLRBNode.RED,null,this.right.left),this.right.copy(null,null,this.color,a,null)},fb.LLRBNode.prototype.rotateRight_=function(){var a;return a=this.copy(null,null,fb.LLRBNode.RED,this.left.right,null),this.left.copy(null,null,this.color,null,a)},fb.LLRBNode.prototype.colorFlip_=function(){var a,b;return a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null),this.copy(null,null,!this.color,a,b)},fb.LLRBNode.prototype.checkMaxDepth_=function(){var a;return a=this.check_(),Math.pow(2,a)<=this.count()+1?!0:!1},fb.LLRBNode.prototype.check_=function(){var a;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if(a=this.left.check_(),a!==this.right.check_())throw new Error("Black depths differ");return a+(this.isRed_()?0:1)},fb.LLRBEmptyNode=function(){},fb.LLRBEmptyNode.prototype.copy=function(){return this},fb.LLRBEmptyNode.prototype.insert=function(a,b){return new fb.LLRBNode(a,b,null)},fb.LLRBEmptyNode.prototype.remove=function(){return this},fb.LLRBEmptyNode.prototype.count=function(){return 0},fb.LLRBEmptyNode.prototype.isEmpty=function(){return!0},fb.LLRBEmptyNode.prototype.inorderTraversal=function(){return!1},fb.LLRBEmptyNode.prototype.reverseTraversal=function(){return!1},fb.LLRBEmptyNode.prototype.minKey=function(){return null},fb.LLRBEmptyNode.prototype.maxKey=function(){return null},fb.LLRBEmptyNode.prototype.check_=function(){return 0},fb.LLRBEmptyNode.prototype.isRed_=function(){return!1},fb.core.util.SortedMap.EMPTY_NODE_=new fb.LLRBEmptyNode,goog.provide("fb.core.snap.LeafNode"),goog.require("fb.core.snap.Node"),goog.require("fb.core.util"),fb.core.snap.LeafNode=function(a,b){this.value_=a,fb.core.util.assert(goog.isDef(this.value_)&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),this.priorityNode_=b||fb.core.snap.EMPTY_NODE,fb.core.snap.validatePriorityNode(this.priorityNode_),this.lazyHash_=null},fb.core.snap.LeafNode.prototype.isLeafNode=function(){return!0},fb.core.snap.LeafNode.prototype.getPriority=function(){return this.priorityNode_},fb.core.snap.LeafNode.prototype.updatePriority=function(a){return new fb.core.snap.LeafNode(this.value_,a)},fb.core.snap.LeafNode.prototype.getImmediateChild=function(a){return".priority"===a?this.priorityNode_:fb.core.snap.EMPTY_NODE},fb.core.snap.LeafNode.prototype.getChild=function(a){return a.isEmpty()?this:".priority"===a.getFront()?this.priorityNode_:fb.core.snap.EMPTY_NODE},fb.core.snap.LeafNode.prototype.hasChild=function(){return!1},fb.core.snap.LeafNode.prototype.getPredecessorChildName=function(){return null},fb.core.snap.LeafNode.prototype.updateImmediateChild=function(a,b){return".priority"===a?this.updatePriority(b):b.isEmpty()&&".priority"!==a?this:fb.core.snap.EMPTY_NODE.updateImmediateChild(a,b).updatePriority(this.priorityNode_)},fb.core.snap.LeafNode.prototype.updateChild=function(a,b){var c=a.getFront();return null===c?b:b.isEmpty()&&".priority"!==c?this:(fb.core.util.assert(".priority"!==c||1===a.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(c,fb.core.snap.EMPTY_NODE.updateChild(a.popFront(),b)))},fb.core.snap.LeafNode.prototype.isEmpty=function(){return!1},fb.core.snap.LeafNode.prototype.numChildren=function(){return 0},fb.core.snap.LeafNode.prototype.val=function(a){return a&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},fb.core.snap.LeafNode.prototype.hash=function(){if(null===this.lazyHash_){var a="";this.priorityNode_.isEmpty()||(a+="priority:"+fb.core.snap.priorityHashText(this.priorityNode_.val())+":");var b=typeof this.value_;a+=b+":",a+="number"===b?fb.core.util.doubleToIEEE754String(this.value_):this.value_,this.lazyHash_=fb.core.util.sha1(a)}return this.lazyHash_},fb.core.snap.LeafNode.prototype.getValue=function(){return this.value_},fb.core.snap.LeafNode.prototype.compareTo=function(a){return a===fb.core.snap.EMPTY_NODE?1:a instanceof fb.core.snap.ChildrenNode?-1:(fb.core.util.assert(a.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(a))},fb.core.snap.LeafNode.VALUE_TYPE_ORDER=["object","boolean","number","string"],fb.core.snap.LeafNode.prototype.compareToLeafNode_=function(a){var b=typeof a.value_,c=typeof this.value_,d=goog.array.indexOf(fb.core.snap.LeafNode.VALUE_TYPE_ORDER,b),e=goog.array.indexOf(fb.core.snap.LeafNode.VALUE_TYPE_ORDER,c);return fb.core.util.assert(d>=0,"Unknown leaf type: "+b),fb.core.util.assert(e>=0,"Unknown leaf type: "+c),d===e?"object"===c?0:this.value_<a.value_?-1:this.value_===a.value_?0:1:e-d},fb.core.snap.LeafNode.prototype.withIndex=function(){return this},fb.core.snap.LeafNode.prototype.isIndexed=function(){return!0},fb.core.snap.LeafNode.prototype.equals=function(a){if(a===this)return!0;if(a.isLeafNode()){var b=a;return this.value_===b.value_&&this.priorityNode_.equals(b.priorityNode_)}return!1},goog.DEBUG&&(fb.core.snap.LeafNode.prototype.toString=function(){return fb.util.json.stringify(this.val(!0))}),goog.provide("fb.core.snap.IndexMap"),goog.require("fb.core.snap.Index"),fb.core.snap.IndexMap=function(a,b){this.indexes_=a,this.indexSet_=b},fb.core.snap.IndexMap.prototype.get=function(a){var b=fb.util.obj.get(this.indexes_,a);if(!b)throw new Error("No index defined for "+a);return b===fb.core.snap.Index.Fallback?null:b},fb.core.snap.IndexMap.prototype.hasIndex=function(a){return goog.object.contains(this.indexSet_,a.toString())},fb.core.snap.IndexMap.prototype.addIndex=function(a,b){fb.core.util.assert(a!==fb.core.snap.KeyIndex,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var c=[],d=!1,e=b.getIterator(fb.core.snap.NamedNode.Wrap),f=e.getNext();f;)d=d||a.isDefinedOn(f.node),c.push(f),f=e.getNext();var g;g=d?fb.core.snap.buildChildSet(c,a.getCompare()):fb.core.snap.Index.Fallback;var h=a.toString(),i=goog.object.clone(this.indexSet_);i[h]=a;var j=goog.object.clone(this.indexes_);return j[h]=g,new fb.core.snap.IndexMap(j,i)},fb.core.snap.IndexMap.prototype.addToIndexes=function(a,b){var c=this,d=goog.object.map(this.indexes_,function(d,e){var f=fb.util.obj.get(c.indexSet_,e);if(fb.core.util.assert(f,"Missing index implementation for "+e),d===fb.core.snap.Index.Fallback){if(f.isDefinedOn(a.node)){for(var g=[],h=b.getIterator(fb.core.snap.NamedNode.Wrap),i=h.getNext();i;)i.name!=a.name&&g.push(i),i=h.getNext();return g.push(a),fb.core.snap.buildChildSet(g,f.getCompare())}return fb.core.snap.Index.Fallback}var j=b.get(a.name),k=d;return j&&(k=k.remove(new fb.core.snap.NamedNode(a.name,j))),k.insert(a,a.node)});return new fb.core.snap.IndexMap(d,this.indexSet_)},fb.core.snap.IndexMap.prototype.removeFromIndexes=function(a,b){var c=goog.object.map(this.indexes_,function(c){if(c===fb.core.snap.Index.Fallback)return c;
var d=b.get(a.name);return d?c.remove(new fb.core.snap.NamedNode(a.name,d)):c});return new fb.core.snap.IndexMap(c,this.indexSet_)},fb.core.snap.IndexMap.Default=new fb.core.snap.IndexMap({".priority":fb.core.snap.Index.Fallback},{".priority":fb.core.snap.PriorityIndex}),goog.provide("fb.core.snap.ChildrenNode"),goog.require("fb.core.snap.IndexMap"),goog.require("fb.core.snap.LeafNode"),goog.require("fb.core.snap.NamedNode"),goog.require("fb.core.snap.Node"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.snap.comparators"),goog.require("fb.core.util"),goog.require("fb.core.util.SortedMap"),fb.core.snap.ChildrenNode=function(a,b,c){this.children_=a,this.priorityNode_=b,this.priorityNode_&&fb.core.snap.validatePriorityNode(this.priorityNode_),this.indexMap_=c,this.lazyHash_=null},fb.core.snap.ChildrenNode.prototype.isLeafNode=function(){return!1},fb.core.snap.ChildrenNode.prototype.getPriority=function(){return this.priorityNode_||fb.core.snap.EMPTY_NODE},fb.core.snap.ChildrenNode.prototype.updatePriority=function(a){return new fb.core.snap.ChildrenNode(this.children_,a,this.indexMap_)},fb.core.snap.ChildrenNode.prototype.getImmediateChild=function(a){if(".priority"===a)return this.getPriority();var b=this.children_.get(a);return null===b?fb.core.snap.EMPTY_NODE:b},fb.core.snap.ChildrenNode.prototype.getChild=function(a){var b=a.getFront();return null===b?this:this.getImmediateChild(b).getChild(a.popFront())},fb.core.snap.ChildrenNode.prototype.hasChild=function(a){return null!==this.children_.get(a)},fb.core.snap.ChildrenNode.prototype.updateImmediateChild=function(a,b){if(fb.core.util.assert(b,"We should always be passing snapshot nodes"),".priority"===a)return this.updatePriority(b);var c,d,e=new fb.core.snap.NamedNode(a,b);return b.isEmpty()?(c=this.children_.remove(a),d=this.indexMap_.removeFromIndexes(e,this.children_)):(c=this.children_.insert(a,b),d=this.indexMap_.addToIndexes(e,this.children_)),new fb.core.snap.ChildrenNode(c,this.priorityNode_,d)},fb.core.snap.ChildrenNode.prototype.updateChild=function(a,b){var c=a.getFront();if(null===c)return b;fb.core.util.assert(".priority"!==a.getFront()||1===a.getLength(),".priority must be the last token in a path");var d=this.getImmediateChild(c).updateChild(a.popFront(),b);return this.updateImmediateChild(c,d)},fb.core.snap.ChildrenNode.prototype.isEmpty=function(){return this.children_.isEmpty()},fb.core.snap.ChildrenNode.prototype.numChildren=function(){return this.children_.count()},fb.core.snap.ChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,fb.core.snap.ChildrenNode.prototype.val=function(a){if(this.isEmpty())return null;var b={},c=0,d=0,e=!0;if(this.forEachChild(fb.core.snap.PriorityIndex,function(f,g){b[f]=g.val(a),c++,e&&fb.core.snap.ChildrenNode.INTEGER_REGEXP_.test(f)?d=Math.max(d,Number(f)):e=!1}),!a&&e&&2*c>d){var f=[];for(var g in b)f[g]=b[g];return f}return a&&!this.getPriority().isEmpty()&&(b[".priority"]=this.getPriority().val()),b},fb.core.snap.ChildrenNode.prototype.hash=function(){if(null===this.lazyHash_){var a="";this.getPriority().isEmpty()||(a+="priority:"+fb.core.snap.priorityHashText(this.getPriority().val())+":"),this.forEachChild(fb.core.snap.PriorityIndex,function(b,c){var d=c.hash();""!==d&&(a+=":"+b+":"+d)}),this.lazyHash_=""===a?"":fb.core.util.sha1(a)}return this.lazyHash_},fb.core.snap.ChildrenNode.prototype.getPredecessorChildName=function(a,b,c){var d=this.resolveIndex_(c);if(d){var e=d.getPredecessorKey(new fb.core.snap.NamedNode(a,b));return e?e.name:null}return this.children_.getPredecessorKey(a)},fb.core.snap.ChildrenNode.prototype.getFirstChildName=function(a){var b=this.resolveIndex_(a);if(b){var c=b.minKey();return c&&c.name}return this.children_.minKey()},fb.core.snap.ChildrenNode.prototype.getFirstChild=function(a){var b=this.getFirstChildName(a);return b?new fb.core.snap.NamedNode(b,this.children_.get(b)):null},fb.core.snap.ChildrenNode.prototype.getLastChildName=function(a){var b=this.resolveIndex_(a);if(b){var c=b.maxKey();return c&&c.name}return this.children_.maxKey()},fb.core.snap.ChildrenNode.prototype.getLastChild=function(a){var b=this.getLastChildName(a);return b?new fb.core.snap.NamedNode(b,this.children_.get(b)):null},fb.core.snap.ChildrenNode.prototype.forEachChild=function(a,b){var c=this.resolveIndex_(a);return c?c.inorderTraversal(function(a){return b(a.name,a.node)}):this.children_.inorderTraversal(b)},fb.core.snap.ChildrenNode.prototype.getIterator=function(a){return this.getIteratorFrom(a.minPost(),a)},fb.core.snap.ChildrenNode.prototype.getIteratorFrom=function(a,b){var c=this.resolveIndex_(b);if(c)return c.getIteratorFrom(a,function(a){return a});for(var d=this.children_.getIteratorFrom(a.name,fb.core.snap.NamedNode.Wrap),e=d.peek();null!=e&&b.compare(e,a)<0;)d.getNext(),e=d.peek();return d},fb.core.snap.ChildrenNode.prototype.getReverseIterator=function(a){return this.getReverseIteratorFrom(a.maxPost(),a)},fb.core.snap.ChildrenNode.prototype.getReverseIteratorFrom=function(a,b){var c=this.resolveIndex_(b);if(c)return c.getReverseIteratorFrom(a,function(a){return a});for(var d=this.children_.getReverseIteratorFrom(a.name,fb.core.snap.NamedNode.Wrap),e=d.peek();null!=e&&b.compare(e,a)>0;)d.getNext(),e=d.peek();return d},fb.core.snap.ChildrenNode.prototype.compareTo=function(a){return this.isEmpty()?a.isEmpty()?0:-1:a.isLeafNode()||a.isEmpty()?1:a===fb.core.snap.MAX_NODE?-1:0},fb.core.snap.ChildrenNode.prototype.withIndex=function(a){if(a===fb.core.snap.KeyIndex||this.indexMap_.hasIndex(a))return this;var b=this.indexMap_.addIndex(a,this.children_);return new fb.core.snap.ChildrenNode(this.children_,this.priorityNode_,b)},fb.core.snap.ChildrenNode.prototype.isIndexed=function(a){return a===fb.core.snap.KeyIndex||this.indexMap_.hasIndex(a)},fb.core.snap.ChildrenNode.prototype.equals=function(a){if(a===this)return!0;if(a.isLeafNode())return!1;var b=a;if(this.getPriority().equals(b.getPriority())){if(this.children_.count()===b.children_.count()){for(var c=this.getIterator(fb.core.snap.PriorityIndex),d=b.getIterator(fb.core.snap.PriorityIndex),e=c.getNext(),f=d.getNext();e&&f;){if(e.name!==f.name||!e.node.equals(f.node))return!1;e=c.getNext(),f=d.getNext()}return null===e&&null===f}return!1}return!1},fb.core.snap.ChildrenNode.prototype.resolveIndex_=function(a){return a===fb.core.snap.KeyIndex?null:this.indexMap_.get(a.toString())},goog.DEBUG&&(fb.core.snap.ChildrenNode.prototype.toString=function(){return fb.util.json.stringify(this.val(!0))}),goog.provide("fb.core.snap"),goog.require("fb.core.snap.ChildrenNode"),goog.require("fb.core.snap.IndexMap"),goog.require("fb.core.snap.LeafNode");var USE_HINZE=!0;fb.core.snap.NodeFromJSON=function(a,b){if(null===a)return fb.core.snap.EMPTY_NODE;var c=null;if("object"==typeof a&&".priority"in a?c=a[".priority"]:"undefined"!=typeof b&&(c=b),fb.core.util.assert(null===c||"string"==typeof c||"number"==typeof c||"object"==typeof c&&".sv"in c,"Invalid priority type found: "+typeof c),"object"==typeof a&&".value"in a&&null!==a[".value"]&&(a=a[".value"]),"object"!=typeof a||".sv"in a){var d=a;return new fb.core.snap.LeafNode(d,fb.core.snap.NodeFromJSON(c))}if(a instanceof Array||!USE_HINZE){var e=fb.core.snap.EMPTY_NODE,f=a;return goog.object.forEach(f,function(a,b){if(fb.util.obj.contains(f,b)&&"."!==b.substring(0,1)){var c=fb.core.snap.NodeFromJSON(a);(c.isLeafNode()||!c.isEmpty())&&(e=e.updateImmediateChild(b,c))}}),e.updatePriority(fb.core.snap.NodeFromJSON(c))}var g=[],h=!1,i=a;fb.util.obj.foreach(i,function(a){if("string"!=typeof a||"."!==a.substring(0,1)){var b=fb.core.snap.NodeFromJSON(i[a]);b.isEmpty()||(h=h||!b.getPriority().isEmpty(),g.push(new fb.core.snap.NamedNode(a,b)))}});var j=fb.core.snap.buildChildSet(g,fb.core.snap.NAME_ONLY_COMPARATOR,function(a){return a.name},fb.core.snap.NAME_COMPARATOR);if(h){var k=fb.core.snap.buildChildSet(g,fb.core.snap.PriorityIndex.getCompare());return new fb.core.snap.ChildrenNode(j,fb.core.snap.NodeFromJSON(c),new fb.core.snap.IndexMap({".priority":k},{".priority":fb.core.snap.PriorityIndex}))}return new fb.core.snap.ChildrenNode(j,fb.core.snap.NodeFromJSON(c),fb.core.snap.IndexMap.Default)};var LOG_2=Math.log(2);fb.core.snap.Base12Num=function(a){var b=function(a){return parseInt(Math.log(a)/LOG_2,10)},c=function(a){return parseInt(Array(a+1).join("1"),2)};this.count=b(a+1),this.current_=this.count-1;var d=c(this.count);this.bits_=a+1&d},fb.core.snap.Base12Num.prototype.nextBitIsOne=function(){var a=!(this.bits_&1<<this.current_);return this.current_--,a},fb.core.snap.buildChildSet=function(a,b,c,d){a.sort(b);var e=function(b,d){var f=d-b;if(0==f)return null;if(1==f){var g=a[b],h=c?c(g):g;return new fb.LLRBNode(h,g.node,fb.LLRBNode.BLACK,null,null)}var i=parseInt(f/2,10)+b,j=e(b,i),k=e(i+1,d);return g=a[i],h=c?c(g):g,new fb.LLRBNode(h,g.node,fb.LLRBNode.BLACK,j,k)},f=function(b){for(var d=null,f=null,g=a.length,h=function(b,d){var f=g-b,h=g;g-=b;var j=e(f+1,h),k=a[f],l=c?c(k):k;i(new fb.LLRBNode(l,k.node,d,null,j))},i=function(a){d?(d.left=a,d=a):(f=a,d=a)},j=0;j<b.count;++j){var k=b.nextBitIsOne(),l=Math.pow(2,b.count-(j+1));k?h(l,fb.LLRBNode.BLACK):(h(l,fb.LLRBNode.BLACK),h(l,fb.LLRBNode.RED))}return f},g=new fb.core.snap.Base12Num(a.length),h=f(g);return null!==h?new fb.core.util.SortedMap(d||b,h):new fb.core.util.SortedMap(d||b)},fb.core.snap.priorityHashText=function(a){return"number"==typeof a?"number:"+fb.core.util.doubleToIEEE754String(a):"string:"+a},fb.core.snap.validatePriorityNode=function(a){if(a.isLeafNode()){var b=a.val();fb.core.util.assert("string"==typeof b||"number"==typeof b||"object"==typeof b&&fb.util.obj.contains(b,".sv"),"Priority must be a string or number.")}else fb.core.util.assert(a===fb.core.snap.MAX_NODE||a.isEmpty(),"priority of unexpected type.");fb.core.util.assert(a===fb.core.snap.MAX_NODE||a.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},fb.core.snap.EMPTY_NODE=new fb.core.snap.ChildrenNode(new fb.core.util.SortedMap(fb.core.snap.NAME_COMPARATOR),null,fb.core.snap.IndexMap.Default),fb.core.snap.MAX_NODE_=function(){fb.core.snap.ChildrenNode.call(this,new fb.core.util.SortedMap(fb.core.snap.NAME_COMPARATOR),fb.core.snap.EMPTY_NODE,fb.core.snap.IndexMap.Default)},goog.inherits(fb.core.snap.MAX_NODE_,fb.core.snap.ChildrenNode),fb.core.snap.MAX_NODE_.prototype.compareTo=function(a){return a===this?0:1},fb.core.snap.MAX_NODE_.prototype.equals=function(a){return a===this},fb.core.snap.MAX_NODE_.prototype.getPriority=function(){throw fb.core.util.assertionError("Why is this called?")},fb.core.snap.MAX_NODE_.prototype.getImmediateChild=function(){return fb.core.snap.EMPTY_NODE},fb.core.snap.MAX_NODE_.prototype.isEmpty=function(){return!1},fb.core.snap.MAX_NODE=new fb.core.snap.MAX_NODE_,fb.core.snap.NamedNode.MIN=new fb.core.snap.NamedNode(fb.core.util.MIN_NAME,fb.core.snap.EMPTY_NODE),goog.provide("fb.api.DataSnapshot"),goog.require("fb.core.snap"),goog.require("fb.core.util.SortedMap"),goog.require("fb.core.util.validation"),fb.api.DataSnapshot=function(a,b,c){this.node_=a,this.query_=b,this.index_=c},fb.api.DataSnapshot.prototype.val=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.val",0,0,arguments.length),this.node_.val()},goog.exportProperty(fb.api.DataSnapshot.prototype,"val",fb.api.DataSnapshot.prototype.val),fb.api.DataSnapshot.prototype.exportVal=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},goog.exportProperty(fb.api.DataSnapshot.prototype,"exportVal",fb.api.DataSnapshot.prototype.exportVal),fb.api.DataSnapshot.prototype.exists=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},goog.exportProperty(fb.api.DataSnapshot.prototype,"exists",fb.api.DataSnapshot.prototype.exists),fb.api.DataSnapshot.prototype.child=function(a){fb.util.validation.validateArgCount("Firebase.DataSnapshot.child",0,1,arguments.length),goog.isNumber(a)&&(a=String(a)),fb.core.util.validation.validatePathString("Firebase.DataSnapshot.child",1,a,!1);var b=new fb.core.util.Path(a),c=this.query_.child(b);return new fb.api.DataSnapshot(this.node_.getChild(b),c,fb.core.snap.PriorityIndex)},goog.exportProperty(fb.api.DataSnapshot.prototype,"child",fb.api.DataSnapshot.prototype.child),fb.api.DataSnapshot.prototype.hasChild=function(a){fb.util.validation.validateArgCount("Firebase.DataSnapshot.hasChild",1,1,arguments.length),fb.core.util.validation.validatePathString("Firebase.DataSnapshot.hasChild",1,a,!1);var b=new fb.core.util.Path(a);return!this.node_.getChild(b).isEmpty()},goog.exportProperty(fb.api.DataSnapshot.prototype,"hasChild",fb.api.DataSnapshot.prototype.hasChild),fb.api.DataSnapshot.prototype.getPriority=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},goog.exportProperty(fb.api.DataSnapshot.prototype,"getPriority",fb.api.DataSnapshot.prototype.getPriority),fb.api.DataSnapshot.prototype.forEach=function(a){if(fb.util.validation.validateArgCount("Firebase.DataSnapshot.forEach",1,1,arguments.length),fb.util.validation.validateCallback("Firebase.DataSnapshot.forEach",1,a,!1),this.node_.isLeafNode())return!1;var b=this.node_,c=this;return!!b.forEachChild(this.index_,function(b,d){return a(new fb.api.DataSnapshot(d,c.query_.child(b),fb.core.snap.PriorityIndex))})},goog.exportProperty(fb.api.DataSnapshot.prototype,"forEach",fb.api.DataSnapshot.prototype.forEach),fb.api.DataSnapshot.prototype.hasChildren=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.hasChildren",0,0,arguments.length),this.node_.isLeafNode()?!1:!this.node_.isEmpty()},goog.exportProperty(fb.api.DataSnapshot.prototype,"hasChildren",fb.api.DataSnapshot.prototype.hasChildren),fb.api.DataSnapshot.prototype.name=function(){return fb.core.util.warn("Firebase.DataSnapshot.name() being deprecated. Please use Firebase.DataSnapshot.key() instead."),fb.util.validation.validateArgCount("Firebase.DataSnapshot.name",0,0,arguments.length),this.key()},goog.exportProperty(fb.api.DataSnapshot.prototype,"name",fb.api.DataSnapshot.prototype.name),fb.api.DataSnapshot.prototype.key=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.key",0,0,arguments.length),this.query_.key()},goog.exportProperty(fb.api.DataSnapshot.prototype,"key",fb.api.DataSnapshot.prototype.key),fb.api.DataSnapshot.prototype.numChildren=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},goog.exportProperty(fb.api.DataSnapshot.prototype,"numChildren",fb.api.DataSnapshot.prototype.numChildren),fb.api.DataSnapshot.prototype.ref=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.ref",0,0,arguments.length),this.query_},goog.exportProperty(fb.api.DataSnapshot.prototype,"ref",fb.api.DataSnapshot.prototype.ref),goog.provide("fb.core.util.EventEmitter"),goog.require("fb.core.util"),fb.core.util.EventEmitter=function(a){fb.core.util.assert(goog.isArray(a)&&a.length>0,"Requires a non-empty array"),this.allowedEvents_=a,this.listeners_={}},fb.core.util.EventEmitter.prototype.getInitialEvent=goog.abstractMethod,fb.core.util.EventEmitter.prototype.trigger=function(a){for(var b=this.listeners_[a]||[],c=0;c<b.length;c++)b[c].callback.apply(b[c].context,Array.prototype.slice.call(arguments,1))},fb.core.util.EventEmitter.prototype.on=function(a,b,c){this.validateEventType_(a),this.listeners_[a]=this.listeners_[a]||[],this.listeners_[a].push({callback:b,context:c});var d=this.getInitialEvent(a);d&&b.apply(c,d)},fb.core.util.EventEmitter.prototype.off=function(a,b,c){this.validateEventType_(a);for(var d=this.listeners_[a]||[],e=0;e<d.length;e++)if(d[e].callback===b&&(!c||c===d[e].context))return void d.splice(e,1)},fb.core.util.EventEmitter.prototype.validateEventType_=function(a){fb.core.util.assert(goog.array.find(this.allowedEvents_,function(b){return b===a}),"Unknown event: "+a)},goog.provide("fb.core.util.VisibilityMonitor"),goog.require("fb.core.util.EventEmitter"),fb.core.util.VisibilityMonitor=function(){fb.core.util.EventEmitter.call(this,["visible"]);var a,b;if("undefined"!=typeof document&&"undefined"!=typeof document.addEventListener&&("undefined"!=typeof document.hidden?(b="visibilitychange",a="hidden"):"undefined"!=typeof document.mozHidden?(b="mozvisibilitychange",a="mozHidden"):"undefined"!=typeof document.msHidden?(b="msvisibilitychange",a="msHidden"):"undefined"!=typeof document.webkitHidden&&(b="webkitvisibilitychange",a="webkitHidden")),this.visible_=!0,b){var c=this;document.addEventListener(b,function(){var b=!document[a];b!==c.visible_&&(c.visible_=b,c.trigger("visible",b))},!1)}},goog.inherits(fb.core.util.VisibilityMonitor,fb.core.util.EventEmitter),goog.addSingletonGetter(fb.core.util.VisibilityMonitor),fb.core.util.VisibilityMonitor.prototype.getInitialEvent=function(a){return fb.core.util.assert("visible"===a,"Unknown event type: "+a),[this.visible_]},goog.provide("fb.core.util.OnlineMonitor"),goog.require("fb.core.util.EventEmitter"),fb.core.util.OnlineMonitor=function(){if(fb.core.util.EventEmitter.call(this,["online"]),this.online_=!0,"undefined"!=typeof window&&"undefined"!=typeof window.addEventListener){var a=this;window.addEventListener("online",function(){a.online_||a.trigger("online",!0),a.online_=!0},!1),window.addEventListener("offline",function(){a.online_&&a.trigger("online",!1),a.online_=!1},!1)}},goog.inherits(fb.core.util.OnlineMonitor,fb.core.util.EventEmitter),goog.addSingletonGetter(fb.core.util.OnlineMonitor),fb.core.util.OnlineMonitor.prototype.getInitialEvent=function(a){return fb.core.util.assert("online"===a,"Unknown event type: "+a),[this.online_]},goog.provide("fb.realtime.Constants"),fb.realtime.Constants={PROTOCOL_VERSION:"5",VERSION_PARAM:"v",SESSION_PARAM:"s",REFERER_PARAM:"r",FORGE_REF:"f",FORGE_DOMAIN:"firebaseio.com"},goog.provide("fb.realtime.Transport"),goog.require("fb.core.RepoInfo"),fb.realtime.Transport=function(){},fb.realtime.Transport.prototype.open=function(){},fb.realtime.Transport.prototype.start=function(){},fb.realtime.Transport.prototype.close=function(){},fb.realtime.Transport.prototype.send=function(){},fb.realtime.Transport.prototype.bytesReceived,fb.realtime.Transport.prototype.bytesSent,goog.provide("fb.core.util.NodePatches"),function(){function a(a,b,c){var d=new Error("write after end");a.emit("error",d),process.nextTick(function(){c(d)})}function b(a,b,c,d){var e=!0;if(!Buffer.isBuffer(c)&&"string"!=typeof c&&null!==c&&void 0!==c&&!b.objectMode){var f=new TypeError("Invalid non-string/buffer chunk");a.emit("error",f),process.nextTick(function(){d(f)}),e=!1}return e}function c(a,b,c,g,h){c=d(b,c,g),Buffer.isBuffer(c)&&(g="buffer");var i=b.objectMode?1:c.length;b.length+=i;var j=b.length<b.highWaterMark;return j||(b.needDrain=!0),b.writing?b.buffer.push(new e(c,g,h)):f(a,b,i,c,g,h),j}function d(a,b,c){return a.objectMode||a.decodeStrings===!1||"string"!=typeof b||(b=new Buffer(b,c)),b}function e(a,b,c){this.chunk=a,this.encoding=b,this.callback=c}function f(a,b,c,d,e,f){b.writelen=c,b.writecb=f,b.writing=!0,b.sync=!0,a._write(d,e,b.onwrite),b.sync=!1}if(NODE_CLIENT){var g=process.version;if("v0.10.22"===g||"v0.10.23"===g||"v0.10.24"===g){var h=require("_stream_writable");h.prototype.write=function(d,e,f){var g=this._writableState,h=!1;return"function"==typeof e&&(f=e,e=null),Buffer.isBuffer(d)?e="buffer":e||(e=g.defaultEncoding),"function"!=typeof f&&(f=function(){}),g.ended?a(this,g,f):b(this,g,d,f)&&(h=c(this,g,d,e,f)),h};var i=require("_stream_duplex");i.prototype.write=h.prototype.write}}}(),goog.provide("goog.object"),goog.object.forEach=function(a,b,c){for(var d in a)b.call(c,a[d],d,a)},goog.object.filter=function(a,b,c){var d={};for(var e in a)b.call(c,a[e],e,a)&&(d[e]=a[e]);return d},goog.object.map=function(a,b,c){var d={};for(var e in a)d[e]=b.call(c,a[e],e,a);return d},goog.object.some=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return!0;return!1},goog.object.every=function(a,b,c){for(var d in a)if(!b.call(c,a[d],d,a))return!1;return!0},goog.object.getCount=function(a){var b=0;for(var c in a)b++;return b},goog.object.getAnyKey=function(a){for(var b in a)return b},goog.object.getAnyValue=function(a){for(var b in a)return a[b]},goog.object.contains=function(a,b){return goog.object.containsValue(a,b)},goog.object.getValues=function(a){var b=[],c=0;for(var d in a)b[c++]=a[d];return b},goog.object.getKeys=function(a){var b=[],c=0;for(var d in a)b[c++]=d;return b},goog.object.getValueByKeys=function(a,b){for(var c=goog.isArrayLike(b),d=c?b:arguments,e=c?0:1;e<d.length&&(a=a[d[e]],goog.isDef(a));e++);return a},goog.object.containsKey=function(a,b){return b in a},goog.object.containsValue=function(a,b){for(var c in a)if(a[c]==b)return!0;return!1},goog.object.findKey=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return d;return void 0},goog.object.findValue=function(a,b,c){var d=goog.object.findKey(a,b,c);return d&&a[d]},goog.object.isEmpty=function(a){for(var b in a)return!1;return!0},goog.object.clear=function(a){for(var b in a)delete a[b]},goog.object.remove=function(a,b){var c;return(c=b in a)&&delete a[b],c},goog.object.add=function(a,b,c){if(b in a)throw Error('The object already contains the key "'+b+'"');goog.object.set(a,b,c)},goog.object.get=function(a,b,c){return b in a?a[b]:c},goog.object.set=function(a,b,c){a[b]=c},goog.object.setIfUndefined=function(a,b,c){return b in a?a[b]:a[b]=c},goog.object.clone=function(a){var b={};for(var c in a)b[c]=a[c];return b},goog.object.unsafeClone=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var c="array"==b?[]:{};for(var d in a)c[d]=goog.object.unsafeClone(a[d]);return c}return a},goog.object.transpose=function(a){var b={};for(var c in a)b[a[c]]=c;return b},goog.object.PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.object.extend=function(a){for(var b,c,d=1;d<arguments.length;d++){c=arguments[d];for(b in c)a[b]=c[b];for(var e=0;e<goog.object.PROTOTYPE_FIELDS_.length;e++)b=goog.object.PROTOTYPE_FIELDS_[e],Object.prototype.hasOwnProperty.call(c,b)&&(a[b]=c[b])}},goog.object.create=function(){var a=arguments.length;if(1==a&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(a%2)throw Error("Uneven number of arguments");for(var b={},c=0;a>c;c+=2)b[arguments[c]]=arguments[c+1];return b},goog.object.createSet=function(){var a=arguments.length;if(1==a&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var b={},c=0;a>c;c++)b[arguments[c]]=!0;return b},goog.object.createImmutableView=function(a){var b=a;return Object.isFrozen&&!Object.isFrozen(a)&&(b=Object.create(a),Object.freeze(b)),b},goog.object.isImmutableView=function(a){return!!Object.isFrozen&&Object.isFrozen(a)},goog.provide("fb.core.stats.StatsCollection"),goog.require("fb.util.obj"),goog.require("goog.array"),goog.require("goog.object"),fb.core.stats.StatsCollection=function(){this.counters_={}},fb.core.stats.StatsCollection.prototype.incrementCounter=function(a,b){goog.isDef(b)||(b=1),fb.util.obj.contains(this.counters_,a)||(this.counters_[a]=0),this.counters_[a]+=b},fb.core.stats.StatsCollection.prototype.get=function(){return goog.object.clone(this.counters_)},goog.provide("fb.core.stats.StatsListener"),fb.core.stats.StatsListener=function(a){this.collection_=a,this.last_=null},fb.core.stats.StatsListener.prototype.get=function(){var a=this.collection_.get(),b=goog.object.clone(a);if(this.last_)for(var c in this.last_)b[c]=b[c]-this.last_[c];return this.last_=a,b},goog.provide("fb.core.stats.StatsReporter");var FIRST_STATS_MIN_TIME=1e4,FIRST_STATS_MAX_TIME=3e4,REPORT_STATS_INTERVAL=3e5;fb.core.stats.StatsReporter=function(a,b){this.statsToReport_={},this.statsListener_=new fb.core.stats.StatsListener(a),this.connection_=b;var c=FIRST_STATS_MIN_TIME+(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();setTimeout(goog.bind(this.reportStats_,this),Math.floor(c))},fb.core.stats.StatsReporter.prototype.includeStat=function(a){this.statsToReport_[a]=!0},fb.core.stats.StatsReporter.prototype.reportStats_=function(){var a=this.statsListener_.get(),b={},c=!1;for(var d in a)a[d]>0&&fb.util.obj.contains(this.statsToReport_,d)&&(b[d]=a[d],c=!0);c&&this.connection_.reportStats(b),setTimeout(goog.bind(this.reportStats_,this),Math.floor(2*Math.random()*REPORT_STATS_INTERVAL))},goog.provide("fb.core.stats.StatsManager"),goog.require("fb.core.stats.StatsCollection"),goog.require("fb.core.stats.StatsListener"),goog.require("fb.core.stats.StatsReporter"),fb.core.stats.StatsManager={},fb.core.stats.StatsManager.collections_={},fb.core.stats.StatsManager.reporters_={},fb.core.stats.StatsManager.getCollection=function(a){var b=a.toString();return fb.core.stats.StatsManager.collections_[b]||(fb.core.stats.StatsManager.collections_[b]=new fb.core.stats.StatsCollection),fb.core.stats.StatsManager.collections_[b]},fb.core.stats.StatsManager.getOrCreateReporter=function(a,b){var c=a.toString();return fb.core.stats.StatsManager.reporters_[c]||(fb.core.stats.StatsManager.reporters_[c]=b()),fb.core.stats.StatsManager.reporters_[c]},goog.provide("fb.realtime.WebSocketConnection"),goog.require("fb.constants"),goog.require("fb.core.stats.StatsManager"),goog.require("fb.core.storage"),goog.require("fb.core.util"),goog.require("fb.realtime.Constants"),goog.require("fb.realtime.Transport"),goog.require("fb.util.json");var WEBSOCKET_MAX_FRAME_SIZE=16384,WEBSOCKET_KEEPALIVE_INTERVAL=45e3;fb.WebSocket=null,NODE_CLIENT?(goog.require("fb.core.util.NodePatches"),fb.WebSocket=require("faye-websocket").Client):"undefined"!=typeof MozWebSocket?fb.WebSocket=MozWebSocket:"undefined"!=typeof WebSocket&&(fb.WebSocket=WebSocket),fb.realtime.WebSocketConnection=function(a,b,c){this.connId=a,this.log_=fb.core.util.logWrapper(this.connId),this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.stats_=fb.core.stats.StatsManager.getCollection(b),this.connURL=(b.secure?"wss://":"ws://")+b.internalHost+"/.ws?"+fb.realtime.Constants.VERSION_PARAM+"="+fb.realtime.Constants.PROTOCOL_VERSION,!NODE_CLIENT&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(fb.realtime.Constants.FORGE_DOMAIN)&&(this.connURL=this.connURL+"&"+fb.realtime.Constants.REFERER_PARAM+"="+fb.realtime.Constants.FORGE_REF),b.needsQueryParam()&&(this.connURL=this.connURL+"&ns="+b.namespace),c&&(this.connURL=this.connURL+"&"+fb.realtime.Constants.SESSION_PARAM+"="+c)},fb.realtime.WebSocketConnection.prototype.open=function(a,b){this.onDisconnect=b,this.onMessage=a,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,fb.core.storage.PersistentStorage.set("previous_websocket_failure",!0);try{if(NODE_CLIENT){var c={headers:{"User-Agent":"Firebase/"+fb.realtime.Constants.PROTOCOL_VERSION+"/"+CLIENT_VERSION+"/"+process.platform+"/Node"}};this.mySock=new fb.WebSocket(this.connURL,[],c)}else this.mySock=new fb.WebSocket(this.connURL)}catch(d){this.log_("Error instantiating WebSocket.");var e=d.message||d.data;return e&&this.log_(e),void this.onClosed_()}var f=this;this.mySock.onopen=function(){f.log_("Websocket connected."),f.everConnected_=!0},this.mySock.onclose=function(){f.log_("Websocket connection was disconnected."),f.mySock=null,f.onClosed_()},this.mySock.onmessage=function(a){f.handleIncomingFrame(a)},this.mySock.onerror=function(a){f.log_("WebSocket error.  Closing connection.");var b=a.message||a.data;b&&f.log_(b),f.onClosed_()}},fb.realtime.WebSocketConnection.prototype.start=function(){},fb.realtime.WebSocketConnection.forceDisallow=function(){fb.realtime.WebSocketConnection.forceDisallow_=!0},fb.realtime.WebSocketConnection.isAvailable=function(){var a=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var b=/Android ([0-9]{0,}\.[0-9]{0,})/,c=navigator.userAgent.match(b);c&&c.length>1&&parseFloat(c[1])<4.4&&(a=!0)}return!a&&null!==fb.WebSocket&&!fb.realtime.WebSocketConnection.forceDisallow_},fb.realtime.WebSocketConnection.responsesRequiredToBeHealthy=2,fb.realtime.WebSocketConnection.healthyTimeout=3e4,fb.realtime.WebSocketConnection.previouslyFailed=function(){return fb.core.storage.PersistentStorage.isInMemoryStorage||fb.core.storage.PersistentStorage.get("previous_websocket_failure")===!0},fb.realtime.WebSocketConnection.prototype.markConnectionHealthy=function(){fb.core.storage.PersistentStorage.remove("previous_websocket_failure")},fb.realtime.WebSocketConnection.prototype.appendFrame_=function(a){if(this.frames.push(a),this.frames.length==this.totalFrames){var b=this.frames.join("");this.frames=null;var c=fb.util.json.eval(b);this.onMessage(c)}},fb.realtime.WebSocketConnection.prototype.handleNewFrameCount_=function(a){this.totalFrames=a,this.frames=[]},fb.realtime.WebSocketConnection.prototype.extractFrameCount_=function(a){if(fb.core.util.assert(null===this.frames,"We already have a frame buffer"),a.length<=6){var b=Number(a);if(!isNaN(b))return this.handleNewFrameCount_(b),null}return this.handleNewFrameCount_(1),a},fb.realtime.WebSocketConnection.prototype.handleIncomingFrame=function(a){if(null!==this.mySock){var b=a.data;if(this.bytesReceived+=b.length,this.stats_.incrementCounter("bytes_received",b.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(b);else{var c=this.extractFrameCount_(b);null!==c&&this.appendFrame_(c)}}},fb.realtime.WebSocketConnection.prototype.send=function(a){this.resetKeepAlive();var b=fb.util.json.stringify(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);var c=fb.core.util.splitStringBySize(b,WEBSOCKET_MAX_FRAME_SIZE);c.length>1&&this.mySock.send(String(c.length));for(var d=0;d<c.length;d++)this.mySock.send(c[d])},fb.realtime.WebSocketConnection.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},fb.realtime.WebSocketConnection.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},fb.realtime.WebSocketConnection.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},fb.realtime.WebSocketConnection.prototype.resetKeepAlive=function(){var a=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){a.mySock&&a.mySock.send("0"),a.resetKeepAlive()},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL))},goog.provide("fb.realtime.polling.PacketReceiver"),fb.realtime.polling.PacketReceiver=function(a){this.onMessage_=a,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null},fb.realtime.polling.PacketReceiver.prototype.closeAfter=function(a,b){this.closeAfterResponse=a,this.onClose=b,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},fb.realtime.polling.PacketReceiver.prototype.handleResponse=function(a,b){for(this.pendingResponses[a]=b;this.pendingResponses[this.currentResponseNum];){var c=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(var d=0;d<c.length;++d)if(c[d]){var e=this;fb.core.util.exceptionGuard(function(){e.onMessage_(c[d])})}if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(clearTimeout(this.onClose),this.onClose(),this.onClose=null);break}this.currentResponseNum++}},goog.provide("fb.core.util.CountedSet"),goog.require("fb.core.util"),goog.require("goog.object"),fb.core.util.CountedSet=function(){this.set={}},fb.core.util.CountedSet.prototype.add=function(a,b){this.set[a]=null!==b?b:!0},fb.core.util.CountedSet.prototype.contains=function(a){return fb.util.obj.contains(this.set,a)
},fb.core.util.CountedSet.prototype.get=function(a){return this.contains(a)?this.set[a]:void 0},fb.core.util.CountedSet.prototype.remove=function(a){delete this.set[a]},fb.core.util.CountedSet.prototype.clear=function(){this.set={}},fb.core.util.CountedSet.prototype.isEmpty=function(){return goog.object.isEmpty(this.set)},fb.core.util.CountedSet.prototype.count=function(){return goog.object.getCount(this.set)},fb.core.util.CountedSet.prototype.each=function(a){goog.object.forEach(this.set,function(b,c){a(c,b)})},fb.core.util.CountedSet.prototype.keys=function(){var a=[];return goog.object.forEach(this.set,function(b,c){a.push(c)}),a},goog.provide("fb.realtime.BrowserPollConnection"),goog.require("fb.constants"),goog.require("fb.core.stats.StatsManager"),goog.require("fb.core.util"),goog.require("fb.core.util.CountedSet"),goog.require("fb.realtime.Constants"),goog.require("fb.realtime.Transport"),goog.require("fb.realtime.polling.PacketReceiver"),goog.require("fb.util.json");var FIREBASE_LONGPOLL_START_PARAM="start",FIREBASE_LONGPOLL_CLOSE_COMMAND="close",FIREBASE_LONGPOLL_COMMAND_CB_NAME="pLPCommand",FIREBASE_LONGPOLL_DATA_CB_NAME="pRTLPCB",FIREBASE_LONGPOLL_ID_PARAM="id",FIREBASE_LONGPOLL_PW_PARAM="pw",FIREBASE_LONGPOLL_SERIAL_PARAM="ser",FIREBASE_LONGPOLL_CALLBACK_ID_PARAM="cb",FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM="seg",FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET="ts",FIREBASE_LONGPOLL_DATA_PARAM="d",FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM="disconn",FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM="dframe",MAX_URL_DATA_SIZE=1870,SEG_HEADER_SIZE=30,MAX_PAYLOAD_SIZE=MAX_URL_DATA_SIZE-SEG_HEADER_SIZE,KEEPALIVE_REQUEST_INTERVAL=25e3,LP_CONNECT_TIMEOUT=3e4;fb.realtime.BrowserPollConnection=function(a,b,c){this.connId=a,this.log_=fb.core.util.logWrapper(a),this.repoInfo=b,this.bytesSent=0,this.bytesReceived=0,this.stats_=fb.core.stats.StatsManager.getCollection(b),this.sessionId=c,this.everConnected_=!1,this.urlFn=function(a){b.needsQueryParam()&&(a.ns=b.namespace);var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push(d+"="+a[d]);return(b.secure?"https://":"http://")+b.internalHost+"/.lp?"+c.join("&")}},fb.realtime.BrowserPollConnection.prototype.open=function(a,b){this.curSegmentNum=0,this.onDisconnect_=b,this.myPacketOrderer=new fb.realtime.polling.PacketReceiver(a),this.isClosed_=!1;var c=this;this.connectTimeoutTimer_=setTimeout(function(){c.log_("Timed out trying to connect."),c.onClosed_(),c.connectTimeoutTimer_=null},Math.floor(LP_CONNECT_TIMEOUT)),fb.core.util.executeWhenDOMReady(function(){if(!c.isClosed_){c.scriptTagHolder=new FirebaseIFrameScriptHolder(function(a,b,d){if(c.incrementIncomingBytes_(arguments),c.scriptTagHolder)if(c.connectTimeoutTimer_&&(clearTimeout(c.connectTimeoutTimer_),c.connectTimeoutTimer_=null),c.everConnected_=!0,a==FIREBASE_LONGPOLL_START_PARAM)c.id=b,c.password=d;else{if(a!==FIREBASE_LONGPOLL_CLOSE_COMMAND)throw new Error("Unrecognized command received: "+a);b?(c.scriptTagHolder.sendNewPolls=!1,c.myPacketOrderer.closeAfter(b,function(){c.onClosed_()})):c.onClosed_()}},function(a,b){c.incrementIncomingBytes_(arguments),c.myPacketOrderer.handleResponse(a,b)},function(){c.onClosed_()},c.urlFn);var a={};a[FIREBASE_LONGPOLL_START_PARAM]="t",a[FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(1e8*Math.random()),c.scriptTagHolder.uniqueCallbackIdentifier&&(a[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=c.scriptTagHolder.uniqueCallbackIdentifier),a[fb.realtime.Constants.VERSION_PARAM]=fb.realtime.Constants.PROTOCOL_VERSION,c.sessionId&&(a[fb.realtime.Constants.SESSION_PARAM]=c.sessionId),!NODE_CLIENT&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(fb.realtime.Constants.FORGE_DOMAIN)&&(a[fb.realtime.Constants.REFERER_PARAM]=fb.realtime.Constants.FORGE_REF);var b=c.urlFn(a);c.log_("Connecting via long-poll to "+b),c.scriptTagHolder.addTag(b,function(){})}})},fb.realtime.BrowserPollConnection.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},fb.realtime.BrowserPollConnection.forceAllow=function(){fb.realtime.BrowserPollConnection.forceAllow_=!0},fb.realtime.BrowserPollConnection.forceDisallow=function(){fb.realtime.BrowserPollConnection.forceDisallow_=!0},fb.realtime.BrowserPollConnection.isAvailable=function(){return!(fb.realtime.BrowserPollConnection.forceDisallow_||fb.core.util.isChromeExtensionContentScript()||fb.core.util.isWindowsStoreApp()||!fb.realtime.BrowserPollConnection.forceAllow_&&NODE_CLIENT)},fb.realtime.BrowserPollConnection.prototype.markConnectionHealthy=function(){},fb.realtime.BrowserPollConnection.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},fb.realtime.BrowserPollConnection.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},fb.realtime.BrowserPollConnection.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},fb.realtime.BrowserPollConnection.prototype.send=function(a){var b=fb.util.json.stringify(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);for(var c=fb.core.util.base64Encode(b),d=fb.core.util.splitStringBySize(c,MAX_PAYLOAD_SIZE),e=0;e<d.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,d.length,d[e]),this.curSegmentNum++},fb.realtime.BrowserPollConnection.prototype.addDisconnectPingFrame=function(a,b){if(!NODE_CLIENT){this.myDisconnFrame=document.createElement("iframe");var c={};c[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]="t",c[FIREBASE_LONGPOLL_ID_PARAM]=a,c[FIREBASE_LONGPOLL_PW_PARAM]=b,this.myDisconnFrame.src=this.urlFn(c),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},fb.realtime.BrowserPollConnection.prototype.incrementIncomingBytes_=function(a){var b=fb.util.json.stringify(a).length;this.bytesReceived+=b,this.stats_.incrementCounter("bytes_received",b)},FirebaseIFrameScriptHolder.prototype.createIFrame_=function(){var a=document.createElement("iframe");if(a.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(a);try{var b=a.contentWindow.document;b||fb.core.util.log("No IE domain setting required")}catch(c){var d=document.domain;a.src="javascript:void((function(){document.open();document.domain='"+d+"';document.close();})())"}return a.contentDocument?a.doc=a.contentDocument:a.contentWindow?a.doc=a.contentWindow.document:a.document&&(a.doc=a.document),a},FirebaseIFrameScriptHolder.prototype.close=function(){if(this.alive=!1,this.myIFrame){this.myIFrame.doc.body.innerHTML="";var a=this;setTimeout(function(){null!==a.myIFrame&&(document.body.removeChild(a.myIFrame),a.myIFrame=null)},Math.floor(0))}if(NODE_CLIENT&&this.myID){var b={};b[FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM]="t",b[FIREBASE_LONGPOLL_ID_PARAM]=this.myID,b[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW;var c=this.urlFn(b);FirebaseIFrameScriptHolder.nodeRestRequest(c)}var d=this.onDisconnect;d&&(this.onDisconnect=null,d())},FirebaseIFrameScriptHolder.prototype.startLongPoll=function(a,b){for(this.myID=a,this.myPW=b,this.alive=!0;this.newRequest_(););},FirebaseIFrameScriptHolder.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var a={};a[FIREBASE_LONGPOLL_ID_PARAM]=this.myID,a[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW,a[FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial;for(var b=this.urlFn(a),c="",d=0;this.pendingSegs.length>0;){var e=this.pendingSegs[0];if(!(e.d.length+SEG_HEADER_SIZE+c.length<=MAX_URL_DATA_SIZE))break;var f=this.pendingSegs.shift();c=c+"&"+FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+d+"="+f.seg+"&"+FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+d+"="+f.ts+"&"+FIREBASE_LONGPOLL_DATA_PARAM+d+"="+f.d,d++}return b+=c,this.addLongPollTag_(b,this.currentSerial),!0}return!1},FirebaseIFrameScriptHolder.prototype.enqueueSegment=function(a,b,c){this.pendingSegs.push({seg:a,ts:b,d:c}),this.alive&&this.newRequest_()},FirebaseIFrameScriptHolder.prototype.addLongPollTag_=function(a,b){var c=this;c.outstandingRequests.add(b);var d=function(){c.outstandingRequests.remove(b),c.newRequest_()},e=setTimeout(d,Math.floor(KEEPALIVE_REQUEST_INTERVAL)),f=function(){clearTimeout(e),d()};this.addTag(a,f)},FirebaseIFrameScriptHolder.prototype.addTag=function(a,b){if(NODE_CLIENT)this.doNodeLongPoll(a,b);else{var c=this;setTimeout(function(){try{if(!c.sendNewPolls)return;var d=c.myIFrame.doc.createElement("script");d.type="text/javascript",d.async=!0,d.src=a,d.onload=d.onreadystatechange=function(){var a=d.readyState;a&&"loaded"!==a&&"complete"!==a||(d.onload=d.onreadystatechange=null,d.parentNode&&d.parentNode.removeChild(d),b())},d.onerror=function(){fb.core.util.log("Long-poll script failed to load: "+a),c.sendNewPolls=!1,c.close()},c.myIFrame.doc.body.appendChild(d)}catch(e){}},Math.floor(1))}},"undefined"!=typeof NODE_CLIENT&&NODE_CLIENT&&(FirebaseIFrameScriptHolder.request=null,FirebaseIFrameScriptHolder.nodeRestRequest=function(a,b){FirebaseIFrameScriptHolder.request||(FirebaseIFrameScriptHolder.request=require("request")),FirebaseIFrameScriptHolder.request(a,function(c,d,e){if(c)throw"Rest request for "+a.url+" failed.";b&&b(e)})},FirebaseIFrameScriptHolder.prototype.doNodeLongPoll=function(a,b){var c=this;FirebaseIFrameScriptHolder.nodeRestRequest({url:a,forever:!0},function(a){c.evalBody(a),b()})},FirebaseIFrameScriptHolder.prototype.evalBody=function(body){eval("var jsonpCB = function("+FIREBASE_LONGPOLL_COMMAND_CB_NAME+", "+FIREBASE_LONGPOLL_DATA_CB_NAME+") {"+body+"}"),jsonpCB(this.commandCB,this.onMessageCB)}),goog.require("fb.constants"),goog.require("fb.realtime.BrowserPollConnection"),goog.require("fb.realtime.Transport"),goog.provide("fb.realtime.TransportManager"),goog.require("fb.realtime.WebSocketConnection"),fb.realtime.TransportManager=function(a){this.initTransports_(a)},fb.realtime.TransportManager.ALL_TRANSPORTS=[fb.realtime.BrowserPollConnection,fb.realtime.WebSocketConnection],fb.realtime.TransportManager.prototype.initTransports_=function(a){var b=fb.realtime.WebSocketConnection&&fb.realtime.WebSocketConnection.isAvailable(),c=b&&!fb.realtime.WebSocketConnection.previouslyFailed();if(a.webSocketOnly&&(b||fb.core.util.warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),c=!0),c)this.transports_=[fb.realtime.WebSocketConnection];else{var d=this.transports_=[];fb.core.util.each(fb.realtime.TransportManager.ALL_TRANSPORTS,function(a,b){b&&b.isAvailable()&&d.push(b)})}},fb.realtime.TransportManager.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},fb.realtime.TransportManager.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},goog.provide("fb.realtime.Connection"),goog.require("fb.core.storage"),goog.require("fb.core.util"),goog.require("fb.realtime.Constants"),goog.require("fb.realtime.TransportManager");var UPGRADE_TIMEOUT=6e4,DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5e3,BYTES_SENT_HEALTHY_OVERRIDE=10240,BYTES_RECEIVED_HEALTHY_OVERRIDE=102400,REALTIME_STATE_CONNECTING=0,REALTIME_STATE_CONNECTED=1,REALTIME_STATE_DISCONNECTED=2,MESSAGE_TYPE="t",MESSAGE_DATA="d",CONTROL_SHUTDOWN="s",CONTROL_RESET="r",CONTROL_ERROR="e",CONTROL_PONG="o",SWITCH_ACK="a",END_TRANSMISSION="n",PING="p",SERVER_HELLO="h";fb.realtime.Connection=function(a,b,c,d,e,f){this.id=a,this.log_=fb.core.util.logWrapper("c:"+this.id+":"),this.onMessage_=c,this.onReady_=d,this.onDisconnect_=e,this.onKill_=f,this.repoInfo_=b,this.pendingDataMessages=[],this.connectionCount=0,this.transportManager_=new fb.realtime.TransportManager(b),this.state_=REALTIME_STATE_CONNECTING,this.log_("Connection created"),this.start_()},fb.realtime.Connection.prototype.start_=function(){var a=this.transportManager_.initialTransport();this.conn_=new a(this.nextTransportId_(),this.repoInfo_),this.primaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;var b=this.connReceiver_(this.conn_),c=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1;var d=this;setTimeout(function(){d.conn_&&d.conn_.open(b,c)},Math.floor(0));var e=a.healthyTimeout||0;e>0&&(this.healthyTimeout_=setTimeout(function(){d.healthyTimeout_=null,d.isHealthy_||(d.conn_&&d.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE?(d.log_("Connection exceeded healthy timeout but has received "+d.conn_.bytesReceived+" bytes.  Marking connection healthy."),d.isHealthy_=!0,d.conn_.markConnectionHealthy()):d.conn_&&d.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE?d.log_("Connection exceeded healthy timeout but has sent "+d.conn_.bytesSent+" bytes.  Leaving connection alive."):(d.log_("Closing unhealthy connection after timeout."),d.close()))},Math.floor(e)))},fb.realtime.Connection.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},fb.realtime.Connection.prototype.disconnReceiver_=function(a){var b=this;return function(c){a===b.conn_?b.onConnectionLost_(c):a===b.secondaryConn_?(b.log_("Secondary connection lost."),b.onSecondaryConnectionLost_()):b.log_("closing an old connection")}},fb.realtime.Connection.prototype.connReceiver_=function(a){var b=this;return function(c){b.state_!=REALTIME_STATE_DISCONNECTED&&(a===b.rx_?b.onPrimaryMessageReceived_(c):a===b.secondaryConn_?b.onSecondaryMessageReceived_(c):b.log_("message on old connection"))}},fb.realtime.Connection.prototype.sendRequest=function(a){var b={t:"d",d:a};this.sendData_(b)},fb.realtime.Connection.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},fb.realtime.Connection.prototype.onSecondaryControl_=function(a){if(MESSAGE_TYPE in a){var b=a[MESSAGE_TYPE];b===SWITCH_ACK?this.upgradeIfSecondaryHealthy_():b===CONTROL_RESET?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):b===CONTROL_PONG&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},fb.realtime.Connection.prototype.onSecondaryMessageReceived_=function(a){var b=fb.core.util.requireKey("t",a),c=fb.core.util.requireKey("d",a);if("c"==b)this.onSecondaryControl_(c);else{if("d"!=b)throw new Error("Unknown protocol layer: "+b);this.pendingDataMessages.push(c)}},fb.realtime.Connection.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:PING,d:{}}}))},fb.realtime.Connection.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SWITCH_ACK,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:END_TRANSMISSION,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},fb.realtime.Connection.prototype.onPrimaryMessageReceived_=function(a){var b=fb.core.util.requireKey("t",a),c=fb.core.util.requireKey("d",a);"c"==b?this.onControl_(c):"d"==b&&this.onDataMessage_(c)},fb.realtime.Connection.prototype.onDataMessage_=function(a){this.onPrimaryResponse_(),this.onMessage_(a)},fb.realtime.Connection.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},fb.realtime.Connection.prototype.onControl_=function(a){var b=fb.core.util.requireKey(MESSAGE_TYPE,a);if(MESSAGE_DATA in a){var c=a[MESSAGE_DATA];if(b===SERVER_HELLO)this.onHandshake_(c);else if(b===END_TRANSMISSION){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var d=0;d<this.pendingDataMessages.length;++d)this.onDataMessage_(this.pendingDataMessages[d]);this.pendingDataMessages=[],this.tryCleanupConnection()}else b===CONTROL_SHUTDOWN?this.onConnectionShutdown_(c):b===CONTROL_RESET?this.onReset_(c):b===CONTROL_ERROR?fb.core.util.error("Server Error: "+c):b===CONTROL_PONG?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):fb.core.util.error("Unknown control packet command: "+b)}},fb.realtime.Connection.prototype.onHandshake_=function(a){var b=a.ts,c=a.v,d=a.h;this.sessionId=a.s,this.repoInfo_.updateHost(d),this.state_==REALTIME_STATE_CONNECTING&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,b),fb.realtime.Constants.PROTOCOL_VERSION!==c&&fb.core.util.warn("Protocol version mismatch detected"),this.tryStartUpgrade_())},fb.realtime.Connection.prototype.tryStartUpgrade_=function(){var a=this.transportManager_.upgradeTransport();a&&this.startUpgrade_(a)},fb.realtime.Connection.prototype.startUpgrade_=function(a){this.secondaryConn_=new a(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;var b=this.connReceiver_(this.secondaryConn_),c=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(b,c);var d=this;setTimeout(function(){d.secondaryConn_&&(d.log_("Timed out trying to upgrade."),d.secondaryConn_.close())},Math.floor(UPGRADE_TIMEOUT))},fb.realtime.Connection.prototype.onReset_=function(a){this.log_("Reset packet received.  New host: "+a),this.repoInfo_.updateHost(a),this.state_===REALTIME_STATE_CONNECTED?this.close():(this.closeConnections_(),this.start_())},fb.realtime.Connection.prototype.onConnectionEstablished_=function(a,b){this.log_("Realtime connection established."),this.conn_=a,this.state_=REALTIME_STATE_CONNECTED,this.onReady_&&(this.onReady_(b),this.onReady_=null);var c=this;0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):setTimeout(function(){c.sendPingOnPrimaryIfNecessary_()},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS))},fb.realtime.Connection.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||this.state_!==REALTIME_STATE_CONNECTED||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:PING,d:{}}}))},fb.realtime.Connection.prototype.onSecondaryConnectionLost_=function(){var a=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===a||this.rx_===a)&&this.close()},fb.realtime.Connection.prototype.onConnectionLost_=function(a){this.conn_=null,a||this.state_!==REALTIME_STATE_CONNECTING?this.state_===REALTIME_STATE_CONNECTED&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(fb.core.storage.PersistentStorage.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},fb.realtime.Connection.prototype.onConnectionShutdown_=function(a){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(a),this.onKill_=null),this.onDisconnect_=null,this.close()},fb.realtime.Connection.prototype.sendData_=function(a){if(this.state_!==REALTIME_STATE_CONNECTED)throw"Connection is not connected";this.tx_.send(a)},fb.realtime.Connection.prototype.close=function(){this.state_!==REALTIME_STATE_DISCONNECTED&&(this.log_("Closing realtime connection."),this.state_=REALTIME_STATE_DISCONNECTED,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},fb.realtime.Connection.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},goog.provide("fb.util.jwt"),goog.require("fb.core.util"),goog.require("fb.util.json"),goog.require("fb.util.obj"),goog.require("goog.crypt.base64"),goog.require("goog.json"),fb.util.jwt.decode=function(a){var b={},c={},d={},e="";try{var f=a.split(".");b=fb.util.json.eval(fb.core.util.base64Decode(f[0])||""),c=fb.util.json.eval(fb.core.util.base64Decode(f[1])||""),e=f[2],d=c.d||{},delete c.d}catch(g){}return{header:b,claims:c,data:d,signature:e}},fb.util.jwt.isValidTimestamp=function(a){var b,c,d=fb.util.jwt.decode(a).claims,e=Math.floor((new Date).getTime()/1e3);return"object"==typeof d&&(d.hasOwnProperty("nbf")?b=fb.util.obj.get(d,"nbf"):d.hasOwnProperty("iat")&&(b=fb.util.obj.get(d,"iat")),c=d.hasOwnProperty("exp")?fb.util.obj.get(d,"exp"):b+86400),e&&b&&c&&e>=b&&c>=e},fb.util.jwt.issuedAtTime=function(a){var b=fb.util.jwt.decode(a).claims;return"object"==typeof b&&b.hasOwnProperty("iat")?fb.util.obj.get(b,"iat"):null},fb.util.jwt.isValidFormat=function(a){var b=fb.util.jwt.decode(a),c=b.claims;return!!b.signature&&!!c&&"object"==typeof c&&c.hasOwnProperty("iat")},fb.util.jwt.isAdmin=function(a){var b=fb.util.jwt.decode(a).claims;return"object"==typeof b&&fb.util.obj.get(b,"admin")===!0},goog.provide("fb.core.PersistentConnection"),goog.require("fb.core.util.OnlineMonitor"),goog.require("fb.core.util.VisibilityMonitor"),goog.require("fb.realtime.Connection"),goog.require("fb.util.json"),goog.require("fb.util.jwt");var RECONNECT_MIN_DELAY=1e3,RECONNECT_MAX_DELAY_DEFAULT=3e5,RECONNECT_MAX_DELAY_FOR_ADMINS=3e4,RECONNECT_DELAY_MULTIPLIER=1.3,RECONNECT_DELAY_RESET_TIMEOUT=3e4;fb.core.PersistentConnection=function(a,b,c,d){this.id=fb.core.PersistentConnection.nextPersistentConnectionId_++,this.log_=fb.core.util.logWrapper("p:"+this.id+":"),this.shouldReconnect_=!0,this.listens_={},this.outstandingPuts_=[],this.outstandingPutCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT,this.onDataUpdate_=b,this.onConnectStatus_=c,this.onServerInfoUpdate_=d,this.repoInfo_=a,this.securityDebugCallback_=null,this.requestCBHash_={},this.requestNumber_=0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,this.scheduleConnect_(0),fb.core.util.VisibilityMonitor.getInstance().on("visible",this.onVisible_,this),-1===a.host.indexOf("fblocal")&&fb.core.util.OnlineMonitor.getInstance().on("online",this.onOnline_,this)},fb.core.PersistentConnection.nextPersistentConnectionId_=0,fb.core.PersistentConnection.nextConnectionId_=0,fb.core.PersistentConnection.prototype.sendRequest=function(a,b,c){var d=++this.requestNumber_,e={r:d,a:a,b:b};this.log_(fb.util.json.stringify(e)),fb.core.util.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(e),c&&(this.requestCBHash_[d]=c)},fb.core.PersistentConnection.prototype.listen=function(a,b,c,d){var e=a.queryIdentifier(),f=a.path.toString();this.log_("Listen called for "+f+" "+e),this.listens_[f]=this.listens_[f]||{},fb.core.util.assert(!this.listens_[f][e],"listen() called twice for same path/queryId.");var g={onComplete:d,hashFn:b,queryObj:a.queryObject(),tag:c};this.listens_[f][e]=g,this.connected_&&this.sendListen_(f,e,g)},fb.core.PersistentConnection.prototype.sendListen_=function(a,b,c){var d=this;this.log_("Listen on "+a+" for "+b);var e={p:a},f="q";c.tag&&(e.q=c.queryObj,e.t=c.tag),e.h=c.hashFn(),this.sendRequest(f,e,function(e){var f=d.listens_[a]&&d.listens_[a][b];if(f===c){d.log_("listen response",e);var g=e.s;"ok"!==g&&d.removeListen_(a,b);var h=e.d;c.onComplete&&c.onComplete(g,h)}})},fb.core.PersistentConnection.prototype.auth=function(a,b,c){this.credential_={cred:a,firstRequestSent:!1,callback:b,cancelCallback:c},this.log_("Authenticating using credential: "+a),this.tryAuth(),this.reduceReconnectDelayIfAdminCredential_(a)},fb.core.PersistentConnection.prototype.reduceReconnectDelayIfAdminCredential_=function(a){var b=40==a.length;(b||fb.util.jwt.isAdmin(a))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS)},fb.core.PersistentConnection.prototype.unauth=function(a){delete this.credential_,this.connected_&&this.sendRequest("unauth",{},function(b){var c=b.s,d=b.d;a(c,d)})},fb.core.PersistentConnection.prototype.tryAuth=function(){var a=this.credential_,b=this;if(this.connected_&&a){var c={cred:a.cred};this.sendRequest("auth",c,function(c){var d=c.s,e=c.d||"error";"ok"!==d&&b.credential_===a&&delete b.credential_,a.firstRequestSent?"ok"!==d&&a.cancelCallback&&a.cancelCallback(d,e):(a.firstRequestSent=!0,a.callback&&a.callback(d,e))})}},fb.core.PersistentConnection.prototype.unlisten=function(a,b){var c=a.path.toString(),d=a.queryIdentifier();this.log_("Unlisten called for "+c+" "+d);var e=this.removeListen_(c,d);e&&this.connected_&&this.sendUnlisten_(c,d,a.queryObject(),b)},fb.core.PersistentConnection.prototype.sendUnlisten_=function(a,b,c,d){this.log_("Unlisten on "+a+" for "+b);var e={p:a},f="n";d&&(e.q=c,e.t=d),this.sendRequest(f,e)},fb.core.PersistentConnection.prototype.onDisconnectPut=function(a,b,c){this.connected_?this.sendOnDisconnect_("o",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"o",data:b,onComplete:c})},fb.core.PersistentConnection.prototype.onDisconnectMerge=function(a,b,c){this.connected_?this.sendOnDisconnect_("om",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"om",data:b,onComplete:c})},fb.core.PersistentConnection.prototype.onDisconnectCancel=function(a,b){this.connected_?this.sendOnDisconnect_("oc",a,null,b):this.onDisconnectRequestQueue_.push({pathString:a,action:"oc",data:null,onComplete:b})},fb.core.PersistentConnection.prototype.sendOnDisconnect_=function(a,b,c,d){var e=this,f={p:b,d:c};e.log_("onDisconnect "+a,f),this.sendRequest(a,f,function(a){d&&setTimeout(function(){d(a.s,a.d)},Math.floor(0))})},fb.core.PersistentConnection.prototype.put=function(a,b,c,d){this.putInternal("p",a,b,c,d)},fb.core.PersistentConnection.prototype.merge=function(a,b,c,d){this.putInternal("m",a,b,c,d)},fb.core.PersistentConnection.prototype.putInternal=function(a,b,c,d,e){var f={p:b,d:c};goog.isDef(e)&&(f.h=e),this.outstandingPuts_.push({action:a,request:f,onComplete:d}),this.outstandingPutCount_++;var g=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(g):this.log_("Buffering put: "+b)},fb.core.PersistentConnection.prototype.sendPut_=function(a){var b=this,c=this.outstandingPuts_[a].action,d=this.outstandingPuts_[a].request,e=this.outstandingPuts_[a].onComplete;this.outstandingPuts_[a].queued=this.connected_,this.sendRequest(c,d,function(d){b.log_(c+" response",d),delete b.outstandingPuts_[a],b.outstandingPutCount_--,0===b.outstandingPutCount_&&(b.outstandingPuts_=[]),e&&e(d.s,d.d)})},fb.core.PersistentConnection.prototype.reportStats=function(a){if(this.connected_){var b={c:a};this.log_("reportStats",b),this.sendRequest("s",b)}},fb.core.PersistentConnection.prototype.onDataMessage_=function(a){if("r"in a){this.log_("from server: "+fb.util.json.stringify(a));var b=a.r,c=this.requestCBHash_[b];c&&(delete this.requestCBHash_[b],c(a.b))}else{if("error"in a)throw"A server-side error has occurred: "+a.error;"a"in a&&this.onDataPush_(a.a,a.b)}},fb.core.PersistentConnection.prototype.onDataPush_=function(a,b){this.log_("handleServerMessage",a,b),"d"===a?this.onDataUpdate_(b.p,b.d,!1,b.t):"m"===a?this.onDataUpdate_(b.p,b.d,!0,b.t):"c"===a?this.onListenRevoked_(b.p,b.q):"ac"===a?this.onAuthRevoked_(b.s,b.d):"sd"===a?this.onSecurityDebugPacket_(b):fb.core.util.error("Unrecognized action received from server: "+fb.util.json.stringify(a)+"\nAre you using the latest client?")},fb.core.PersistentConnection.prototype.onReady_=function(a){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(a),this.restoreState_(),this.onConnectStatus_(!0)},fb.core.PersistentConnection.prototype.scheduleConnect_=function(a){fb.core.util.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_);var b=this;this.establishConnectionTimer_=setTimeout(function(){b.establishConnectionTimer_=null,b.establishConnection_()},Math.floor(a))},fb.core.PersistentConnection.prototype.onVisible_=function(a){a&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)),this.visible_=a},fb.core.PersistentConnection.prototype.onOnline_=function(a){a?(this.log_("Browser went online.  Reconnecting."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.shouldReconnect_=!0,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection; don't reconnect."),this.shouldReconnect_=!1,this.realtime_&&this.realtime_.close())},fb.core.PersistentConnection.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.shouldReconnect_){if(this.visible_){if(this.lastConnectionEstablishedTime_){var a=(new Date).getTime()-this.lastConnectionEstablishedTime_;a>RECONNECT_DELAY_RESET_TIMEOUT&&(this.reconnectDelay_=RECONNECT_MIN_DELAY),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var b=(new Date).getTime()-this.lastConnectionAttemptTime_,c=Math.max(0,this.reconnectDelay_-b);c=Math.random()*c,this.log_("Trying to reconnect in "+c+"ms"),this.scheduleConnect_(c),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER)}else for(var d in this.requestCBHash_)delete this.requestCBHash_[d];this.onConnectStatus_(!1)},fb.core.PersistentConnection.prototype.establishConnection_=function(){if(this.shouldReconnect_){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var a=goog.bind(this.onDataMessage_,this),b=goog.bind(this.onReady_,this),c=goog.bind(this.onRealtimeDisconnect_,this),d=this.id+":"+fb.core.PersistentConnection.nextConnectionId_++,e=this;this.realtime_=new fb.realtime.Connection(d,this.repoInfo_,a,b,c,function(a){fb.core.util.warn(a+" ("+e.repoInfo_.toString()+")"),e.shouldReconnect_=!1})}},fb.core.PersistentConnection.prototype.interrupt=function(){this.shouldReconnect_=!1,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},fb.core.PersistentConnection.prototype.resume=function(){this.shouldReconnect_=!0,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)},fb.core.PersistentConnection.prototype.handleTimestamp_=function(a){var b=a-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:b})},fb.core.PersistentConnection.prototype.cancelSentTransactions_=function(){for(var a=0;a<this.outstandingPuts_.length;a++){var b=this.outstandingPuts_[a];b&&"h"in b.request&&b.queued&&(b.onComplete&&b.onComplete("disconnect"),delete this.outstandingPuts_[a],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},fb.core.PersistentConnection.prototype.onListenRevoked_=function(a,b){var c;c=b?goog.array.map(b,function(a){return fb.core.util.ObjectToUniqueKey(a)
}).join("$"):"default";var d=this.removeListen_(a,c);d&&d.onComplete&&d.onComplete("permission_denied")},fb.core.PersistentConnection.prototype.removeListen_=function(a,b){var c=new fb.core.util.Path(a).toString(),d=this.listens_[c][b];return delete this.listens_[c][b],0===goog.object.getCount(this.listens_[c])&&delete this.listens_[c],d},fb.core.PersistentConnection.prototype.onAuthRevoked_=function(a,b){var c=this.credential_;delete this.credential_,c&&c.cancelCallback&&c.cancelCallback(a,b)},fb.core.PersistentConnection.prototype.onSecurityDebugPacket_=function(a){this.securityDebugCallback_?this.securityDebugCallback_(a):"msg"in a&&"undefined"!=typeof console&&console.log("FIREBASE: "+a.msg.replace("\n","\nFIREBASE: "))},fb.core.PersistentConnection.prototype.restoreState_=function(){this.tryAuth();var a=this;goog.object.forEach(this.listens_,function(b,c){goog.object.forEach(b,function(b,d){a.sendListen_(c,d,b)})});for(var b=0;b<this.outstandingPuts_.length;b++)this.outstandingPuts_[b]&&this.sendPut_(b);for(;this.onDisconnectRequestQueue_.length;){var c=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(c.action,c.pathString,c.data,c.onComplete)}},goog.provide("fb.core.SparseSnapshotTree"),goog.require("fb.core.snap.Node"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.util.CountedSet"),goog.require("fb.core.util.Path"),fb.core.SparseSnapshotTree=function(){this.value_=null,this.children_=null},fb.core.SparseSnapshotTree.prototype.find=function(a){if(null!=this.value_)return this.value_.getChild(a);if(a.isEmpty()||null==this.children_)return null;var b=a.getFront();if(a=a.popFront(),this.children_.contains(b)){var c=this.children_.get(b);return c.find(a)}return null},fb.core.SparseSnapshotTree.prototype.remember=function(a,b){if(a.isEmpty())this.value_=b,this.children_=null;else if(null!==this.value_)this.value_=this.value_.updateChild(a,b);else{null==this.children_&&(this.children_=new fb.core.util.CountedSet);var c=a.getFront();this.children_.contains(c)||this.children_.add(c,new fb.core.SparseSnapshotTree);var d=this.children_.get(c);a=a.popFront(),d.remember(a,b)}},fb.core.SparseSnapshotTree.prototype.forget=function(a){if(a.isEmpty())return this.value_=null,this.children_=null,!0;if(null!==this.value_){if(this.value_.isLeafNode())return!1;var b=this.value_;this.value_=null;var c=this;return b.forEachChild(fb.core.snap.PriorityIndex,function(a,b){c.remember(new fb.core.util.Path(a),b)}),this.forget(a)}if(null!==this.children_){var d=a.getFront();if(a=a.popFront(),this.children_.contains(d)){var e=this.children_.get(d).forget(a);e&&this.children_.remove(d)}return this.children_.isEmpty()?(this.children_=null,!0):!1}return!0},fb.core.SparseSnapshotTree.prototype.forEachTree=function(a,b){null!==this.value_?b(a,this.value_):this.forEachChild(function(c,d){var e=new fb.core.util.Path(a.toString()+"/"+c);d.forEachTree(e,b)})},fb.core.SparseSnapshotTree.prototype.forEachChild=function(a){null!==this.children_&&this.children_.each(function(b,c){a(b,c)})},goog.provide("fb.core.SnapshotHolder"),fb.core.SnapshotHolder=function(){this.rootNode_=fb.core.snap.EMPTY_NODE},fb.core.SnapshotHolder.prototype.getNode=function(a){return this.rootNode_.getChild(a)},fb.core.SnapshotHolder.prototype.updateSnapshot=function(a,b){this.rootNode_=this.rootNode_.updateChild(a,b)},goog.DEBUG&&(fb.core.SnapshotHolder.prototype.toString=function(){return this.rootNode_.toString()}),goog.provide("fb.core.view.EventQueue"),fb.core.view.EventQueue=function(){this.eventLists_=[],this.recursionDepth_=0},fb.core.view.EventQueue.prototype.queueEvents=function(a){for(var b=null,c=0;c<a.length;c++){var d=a[c],e=d.getPath();null===b||e.equals(b.getPath())||(this.eventLists_.push(b),b=null),null===b&&(b=new fb.core.view.EventList(e)),b.add(d)}b&&this.eventLists_.push(b)},fb.core.view.EventQueue.prototype.raiseEventsAtPath=function(a,b){this.queueEvents(b),this.raiseQueuedEventsMatchingPredicate_(function(b){return b.equals(a)})},fb.core.view.EventQueue.prototype.raiseEventsForChangedPath=function(a,b){this.queueEvents(b),this.raiseQueuedEventsMatchingPredicate_(function(b){return b.contains(a)||a.contains(b)})},fb.core.view.EventQueue.prototype.raiseQueuedEventsMatchingPredicate_=function(a){this.recursionDepth_++;for(var b=!0,c=0;c<this.eventLists_.length;c++){var d=this.eventLists_[c];if(d){var e=d.getPath();a(e)?(this.eventLists_[c].raise(),this.eventLists_[c]=null):b=!1}}b&&(this.eventLists_=[]),this.recursionDepth_--},fb.core.view.EventList=function(a){this.path_=a,this.events_=[]},fb.core.view.EventList.prototype.add=function(a){this.events_.push(a)},fb.core.view.EventList.prototype.raise=function(){for(var a=0;a<this.events_.length;a++){var b=this.events_[a];if(null!==b){this.events_[a]=null;var c=b.getEventRunner();fb.core.util.logger&&fb.core.util.log("event: "+b.toString()),fb.core.util.exceptionGuard(c)}}},fb.core.view.EventList.prototype.getPath=function(){return this.path_},goog.provide("fb.login.Constants"),fb.login.Constants={SESSION_PERSISTENCE_KEY_PREFIX:"session",DEFAULT_SERVER_HOST:"auth.firebase.com",SERVER_HOST:"auth.firebase.com",API_VERSION:"v2",POPUP_PATH_TO_CHANNEL:"/auth/channel",POPUP_RELAY_FRAME_NAME:"__winchan_relay_frame",POPUP_CLOSE_CMD:"die",JSONP_CALLBACK_NAMESPACE:"__firebase_auth_jsonp",REDIR_REQUEST_ID_KEY:"redirect_request_id",REDIR_REQUEST_COMPLETION_KEY:"__firebase_request_key",REDIR_CLIENT_OPTIONS_KEY:"redirect_client_options",INTERNAL_REDIRECT_SENTINAL_PATH:"/blank/page.html",CLIENT_OPTION_SESSION_PERSISTENCE:"remember",CLIENT_OPTION_REDIRECT_TO:"redirectTo"},goog.provide("fb.login.RequestInfo"),goog.require("fb.login.Constants"),fb.login.RequestInfo=function(a,b,c){this.clientOptions=a||{},this.transportOptions=b||{},this.serverParams=c||{},this.clientOptions[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]||(this.clientOptions[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]="default")},fb.login.RequestInfo.CLIENT_OPTIONS=[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE,fb.login.Constants.CLIENT_OPTION_REDIRECT_TO],fb.login.RequestInfo.fromParams=function(a){var b={},c={};return fb.util.obj.foreach(a||{},function(a,d){goog.array.contains(fb.login.RequestInfo.CLIENT_OPTIONS,a)?b[a]=d:c[a]=d}),new fb.login.RequestInfo(b,{},c)},goog.provide("fb.login.Errors");var errors={NETWORK_ERROR:"Unable to contact the Firebase server.",SERVER_ERROR:"An unknown server error occurred.",TRANSPORT_UNAVAILABLE:"There are no login transports available for the requested method.",REQUEST_INTERRUPTED:"The browser redirected the page before the login request could complete.",USER_CANCELLED:"The user cancelled authentication."};fb.login.Errors.get=function(a){var b=fb.util.obj.get(errors,a),c=new Error(b,a);return c.code=a,c},goog.provide("fb.login.Transport"),fb.login.Transport=function(){},fb.login.Transport.isAvailable=function(){},fb.login.Transport.prototype.open=function(){},fb.login.Transport.prototype.classification=function(){},goog.provide("fb.login.transports.util"),goog.require("fb.login.Constants"),fb.login.transports.util.findRelay=function(){var a,b=(window.location,window.opener.frames);for(a=b.length-1;a>=0;a--)try{if(b[a].location.protocol===window.location.protocol&&b[a].location.host===window.location.host&&b[a].name===fb.login.Constants.POPUP_RELAY_FRAME_NAME)return b[a]}catch(c){}return null},fb.login.transports.util.addListener=function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c,!1)},fb.login.transports.util.removeListener=function(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener&&a.removeEventListener(b,c,!1)},fb.login.transports.util.extractOrigin=function(a){/^https?:\/\//.test(a)||(a=window.location.href);var b=/^(https?:\/\/[\-_a-zA-Z\.0-9:]+)/.exec(a);return b?b[1]:a},fb.login.transports.util.extractRedirectCompletionHash=function(a){var b="";try{a=a.replace("#","");var c=fb.login.transports.util.querystringDecode(a);c&&fb.util.obj.contains(c,fb.login.Constants.REDIR_REQUEST_COMPLETION_KEY)&&(b=fb.util.obj.get(c,fb.login.Constants.REDIR_REQUEST_COMPLETION_KEY))}catch(d){}return b},fb.login.transports.util.replaceRedirectCompletionHash=function(){try{var a=new RegExp("&"+fb.login.Constants.REDIR_REQUEST_COMPLETION_KEY+"=([a-zA-z0-9]*)");document.location.hash=document.location.hash.replace(a,"")}catch(b){}},fb.login.transports.util.querystring=function(a){var b=[];for(var c in a)if(fb.util.obj.contains(a,c)){var d=fb.util.obj.get(a,c);if(goog.isArray(d))for(var e=0;e<d.length;e++)b.push(encodeURIComponent(c)+"="+encodeURIComponent(d[e]));else b.push(encodeURIComponent(c)+"="+encodeURIComponent(fb.util.obj.get(a,c)))}return b?"&"+b.join("&"):""},fb.login.transports.util.querystringDecode=function(a){for(var b={},c=a.replace(/^\?/,"").split("&"),d=0;d<c.length;d++)if(c[d]){var e=c[d].split("=");b[e[0]]=e[1]}return b},fb.login.transports.util.getBaseUrl=function(){var a=fb.core.util.parseURL(fb.login.Constants.SERVER_HOST);return a.scheme+"://"+a.host+"/"+fb.login.Constants.API_VERSION},fb.login.transports.util.getPopupChannelUrl=function(a){return fb.login.transports.util.getBaseUrl()+"/"+a+fb.login.Constants.POPUP_PATH_TO_CHANNEL},goog.provide("fb.login.util.environment"),fb.login.util.environment.isMobileWrapper=function(){return fb.login.util.environment.isMobileCordova()||fb.login.util.environment.isMobileWindows()||fb.login.util.environment.isIosWebview()},fb.login.util.environment.isMobileCordova=function(){return!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(navigator.userAgent)},fb.login.util.environment.isMobileWindows=function(){return!!navigator.userAgent.match(/Windows Phone/)||!!window.Windows&&/^ms-appx:/.test(location.href)},fb.login.util.environment.isMobileFirefox=function(){return-1!==navigator.userAgent.indexOf("Fennec/")||-1!==navigator.userAgent.indexOf("Firefox/")&&-1!==navigator.userAgent.indexOf("Android")},fb.login.util.environment.isIosWebview=function(){return!!(navigator.userAgent.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i)||navigator.userAgent.match(/CriOS/)||navigator.userAgent.match(/Twitter for iPhone/)||navigator.userAgent.match(/FBAN\/FBIOS/)||window.navigator.standalone)},fb.login.util.environment.isHeadlessBrowser=function(){return!!navigator.userAgent.match(/PhantomJS/)},fb.login.util.environment.isLocalFile=function(){return/^file:\//.test(location.href)},fb.login.util.environment.isIE=function(){return!(!navigator.userAgent.match(/MSIE/)&&!navigator.userAgent.match(/Trident/))},fb.login.util.environment.isModernIE=function(){var a,b=navigator.userAgent;if("Microsoft Internet Explorer"===navigator.appName){if(a=b.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/),a&&a.length>1)return parseFloat(a[1])>=8}else if(b.indexOf("Trident")>-1&&(a=b.match(/rv:([0-9]{2,2}[\.0-9]{0,})/),a&&a.length>1))return parseFloat(a[1])>=8;return!1},goog.provide("fb.login.transports.XHR"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util.json"),fb.login.transports.XHR=function(a){a.method||(a.method="GET"),a.headers||(a.headers={}),a.headers.content_type||(a.headers.content_type="application/json"),a.headers.content_type=a.headers.content_type.toLowerCase(),this.options=a},fb.login.transports.XHR.prototype.open=function(a,b,c){function d(){c&&(c(fb.login.Errors.get("REQUEST_INTERRUPTED")),c=null)}var e,f=new XMLHttpRequest,g=this.options.method.toUpperCase();if(fb.login.transports.util.addListener(window,"beforeunload",d),f.onreadystatechange=function(){if(c&&4===f.readyState){var a;if(f.status>=200&&f.status<300){try{a=fb.util.json.eval(f.responseText)}catch(b){}c(null,a)}else c(f.status>=500&&f.status<600?fb.login.Errors.get("SERVER_ERROR"):fb.login.Errors.get("NETWORK_ERROR"));c=null,fb.login.transports.util.removeListener(window,"beforeunload",d)}},"GET"===g)a+=(/\?/.test(a)?"":"?")+fb.login.transports.util.querystring(b),e=null;else{var h=this.options.headers.content_type;"application/json"===h&&(e=fb.util.json.stringify(b)),"application/x-www-form-urlencoded"===h&&(e=fb.login.transports.util.querystring(b))}f.open(g,a,!0);var i={"X-Requested-With":"XMLHttpRequest",Accept:"application/json;text/plain"};goog.object.extend(i,this.options.headers);for(var j in i)f.setRequestHeader(j,i[j]);f.send(e)},fb.login.transports.XHR.isAvailable=function(){return!(NODE_CLIENT||!window.XMLHttpRequest||"string"!=typeof(new XMLHttpRequest).responseType||fb.login.util.environment.isIE()&&!fb.login.util.environment.isModernIE())},fb.login.transports.XHR.prototype.classification=function(){return"json"},goog.provide("fb.login.transports.CordovaInAppBrowser"),goog.require("fb.core.util"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.RequestInfo"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.XHR"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util.json"),fb.login.transports.CordovaInAppBrowser=function(a){this.requestId_=goog.string.getRandomString()+goog.string.getRandomString()+goog.string.getRandomString(),this.options_=a},fb.login.transports.CordovaInAppBrowser.prototype.open=function(a,b,c){function d(a){try{var b=document.createElement("a");return b.href=a,b.host===h.host&&b.pathname===fb.login.Constants.INTERNAL_REDIRECT_SENTINAL_PATH}catch(c){}return!1}function e(){c&&(c(fb.login.Errors.get("USER_CANCELLED")),c=null)}var f,g=this,h=fb.core.util.parseURL(fb.login.Constants.SERVER_HOST);return b.requestId=this.requestId_,b[fb.login.Constants.CLIENT_OPTION_REDIRECT_TO]=h.scheme+"://"+h.host+fb.login.Constants.INTERNAL_REDIRECT_SENTINAL_PATH,a+=/\?/.test(a)?"":"?",a+=fb.login.transports.util.querystring(b),f=window.open(a,"_blank","location=no"),f&&goog.isFunction(f.addEventListener)?(f.addEventListener("loadstart",function(a){if(a&&a.url&&d(a.url)){var b=fb.login.transports.util.extractRedirectCompletionHash(a.url);f.removeEventListener("exit",e),f.close();var h="/auth/session",i=new fb.login.RequestInfo(null,null,{requestId:g.requestId_,requestKey:b});g.options_.requestWithCredential(h,i,c),c=null}}),void f.addEventListener("exit",e)):void c(fb.login.Errors.get("TRANSPORT_UNAVAILABLE"))},fb.login.transports.CordovaInAppBrowser.isAvailable=function(){return!NODE_CLIENT&&fb.login.util.environment.isMobileCordova()},fb.login.transports.CordovaInAppBrowser.prototype.classification=function(){return"redirect"},goog.provide("fb.login.transports.NodeHttp"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util.json"),fb.login.transports.NodeHttp=function(a){a.method||(a.method="GET"),a.headers||(a.headers={}),a.headers.content_type||(a.headers.content_type="application/json"),a.headers.content_type=a.headers.content_type.toLowerCase(),this.options=a},fb.login.transports.NodeHttp.prototype.open=function(a,b,c){var d,e=fb.core.util.parseURL(a),f=require("http"===e.scheme?"http":"https"),g=this.options.method,h={Accept:"application/json;text/plain"};goog.object.extend(h,this.options.headers);var i={host:e.host.split(":")[0],port:e.port,path:e.pathString,method:this.options.method.toUpperCase()};if("GET"===g)i.path+=(/\?/.test(i.path)?"":"?")+fb.login.transports.util.querystring(b),d=null;else{var j=this.options.headers.content_type;"application/json"===j&&(d=fb.util.json.stringify(b)),"application/x-www-form-urlencoded"===j&&(d=fb.login.transports.util.querystring(b)),h["Content-Length"]=Buffer.byteLength(d,"utf8")}i.headers=h;var k=f.request(i,function(a){var b="";a.setEncoding("utf8"),a.on("data",function(a){b+=a}),a.on("end",function(){try{b=fb.util.json.eval(b+"")}catch(a){}c&&(c(null,b),c=null)})});"GET"!==g&&k.write(d),k.on("error",function(a){c(a&&a.code&&("ENOTFOUND"===a.code||"ENETDOWN"===a.code)?fb.login.Errors.get("NETWORK_ERROR"):fb.login.Errors.get("SERVER_ERROR")),c=null}),k.end()},fb.login.transports.NodeHttp.isAvailable=function(){return NODE_CLIENT},fb.login.transports.NodeHttp.prototype.classification=function(){return"json"},goog.provide("fb.login.transports.Popup"),goog.require("fb.core.util"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util.json"),fb.login.transports.Popup=function(a){(!a.window_features||fb.login.util.environment.isMobileFirefox())&&(a.window_features=void 0),a.window_name||(a.window_name="_blank"),this.options=a},fb.login.transports.Popup.prototype.open=function(a,b,c){function d(a){if(f&&(document.body.removeChild(f),f=void 0),l&&(l=clearInterval(l)),fb.login.transports.util.removeListener(window,"message",e),fb.login.transports.util.removeListener(window,"unload",d),k&&!a)try{k.close()}catch(b){g.postMessage(fb.login.Constants.POPUP_CLOSE_CMD,j)}k=g=void 0}function e(a){if(a.origin===j)try{var b=fb.util.json.eval(a.data);"ready"===b.a?g.postMessage(m,j):"error"===b.a?(d(!1),c&&(c(b.d),c=null)):"response"===b.a&&(d(b.forceKeepWindowOpen),c&&(c(null,b.d),c=null))}catch(e){}}var f,g,h=this,i=fb.login.util.environment.isModernIE();if(!this.options.relay_url)return c(new Error("invalid arguments: origin of url and relay_url must match"));var j=fb.login.transports.util.extractOrigin(a);if(j!==fb.login.transports.util.extractOrigin(h.options.relay_url))return void(c&&setTimeout(function(){c(new Error("invalid arguments: origin of url and relay_url must match"))},0));i&&(f=document.createElement("iframe"),f.setAttribute("src",h.options.relay_url),f.style.display="none",f.setAttribute("name",fb.login.Constants.POPUP_RELAY_FRAME_NAME),document.body.appendChild(f),g=f.contentWindow),a+=(/\?/.test(a)?"":"?")+fb.login.transports.util.querystring(b);var k=window.open(a,h.options.window_name,h.options.window_features);g||(g=k);var l=setInterval(function(){return k&&k.closed?(d(!1),void(c&&(c(fb.login.Errors.get("USER_CANCELLED")),c=null))):void 0},500),m=fb.util.json.stringify({a:"request",d:b});fb.login.transports.util.addListener(window,"unload",d),fb.login.transports.util.addListener(window,"message",e)},fb.login.transports.Popup.isAvailable=function(){return!NODE_CLIENT&&"postMessage"in window&&!fb.login.util.environment.isLocalFile()&&!fb.login.util.environment.isMobileWrapper()&&!fb.login.util.environment.isHeadlessBrowser()},fb.login.transports.Popup.prototype.classification=function(){return"popup"},goog.provide("fb.login.transports.JSONP"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.util.json"),fb.login.transports.JSONP=function(a){a.callback_parameter||(a.callback_parameter="callback"),this.options=a,window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE]=window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE]||{}},fb.login.transports.JSONP.prototype.open=function(a,b,c){function d(){c&&(c(fb.login.Errors.get("REQUEST_INTERRUPTED")),c=null)}function e(){setTimeout(function(){window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE][g]=void 0,goog.object.isEmpty(window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE])&&(window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE]=void 0);try{var a=document.getElementById(g);a&&a.parentNode.removeChild(a)}catch(b){}},1),fb.login.transports.util.removeListener(window,"beforeunload",d)}function f(a){c&&(c(null,a),c=null),e()}var g="fn"+(new Date).getTime()+Math.floor(99999*Math.random());b[this.options.callback_parameter]=fb.login.Constants.JSONP_CALLBACK_NAMESPACE+"."+g,a+=(/\?/.test(a)?"":"?")+fb.login.transports.util.querystring(b),fb.login.transports.util.addListener(window,"beforeunload",d),window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE][g]=f,this.writeScriptTag_(g,a,c)},fb.login.transports.JSONP.prototype.writeScriptTag_=function(a,b,c){setTimeout(function(){try{var d=document.createElement("script");d.type="text/javascript",d.id=a,d.async=!0,d.src=b,d.onerror=function(){var b=document.getElementById(a);null!==b&&b.parentNode.removeChild(b),c&&c(fb.login.Errors.get("NETWORK_ERROR"))};var e,f=document.getElementsByTagName("head");e=!f||goog.array.isEmpty(f)?document.documentElement:f[0],e.appendChild(d)}catch(g){c&&c(fb.login.Errors.get("NETWORK_ERROR"))}},0)},fb.login.transports.JSONP.isAvailable=function(){return!NODE_CLIENT&&!fb.login.util.environment.isMobileCordova()},fb.login.transports.JSONP.prototype.classification=function(){return"json"},goog.provide("fb.login.SessionManager"),goog.require("fb.core.storage"),goog.require("fb.login.Constants"),goog.require("fb.util.json"),goog.require("fb.util.jwt"),fb.login.SessionManager=function(a,b){this.persistenceKey_=[fb.login.Constants.SESSION_PERSISTENCE_KEY_PREFIX,a.persistenceKey,a.namespace].join(":"),this.stores_=b},fb.login.SessionManager.prototype.set=function(a,b){if(!b){if(!this.stores_.length)throw new Error("fb.login.SessionManager : No storage options available!");b=this.stores_[0]}b.set(this.persistenceKey_,a)},fb.login.SessionManager.prototype.get=function(){var a=goog.array.map(this.stores_,goog.bind(this.getFromStore_,this));return a=goog.array.filter(a,function(a){return null!==a}),goog.array.sort(a,function(a,b){return fb.util.jwt.issuedAtTime(b.token)-fb.util.jwt.issuedAtTime(a.token)}),a.length>0?a.shift():null},fb.login.SessionManager.prototype.getFromStore_=function(a){try{var b=a.get(this.persistenceKey_);if(b&&b.token)return b}catch(c){}return null},fb.login.SessionManager.prototype.clear=function(a){var b=(a?[a]:this.stores_,this);goog.array.forEach(this.stores_,function(a){a.remove(b.persistenceKey_)})},goog.provide("fb.login.transports.Redirect"),goog.require("fb.constants"),goog.require("fb.core.storage"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),fb.login.transports.Redirect=function(a){this.requestId_=goog.string.getRandomString()+goog.string.getRandomString()+goog.string.getRandomString(),this.options_=a},fb.login.transports.Redirect.prototype.open=function(a,b){fb.core.storage.SessionStorage.set(fb.login.Constants.REDIR_REQUEST_ID_KEY,this.requestId_),fb.core.storage.SessionStorage.set(fb.login.Constants.REDIR_REQUEST_ID_KEY,this.requestId_),b.requestId=this.requestId_,b.redirectTo=b.redirectTo||window.location.href,a+=(/\?/.test(a)?"":"?")+fb.login.transports.util.querystring(b),window.location=a},fb.login.transports.Redirect.isAvailable=function(){return!NODE_CLIENT&&!fb.login.util.environment.isLocalFile()&&!fb.login.util.environment.isMobileCordova()},fb.login.transports.Redirect.prototype.classification=function(){return"redirect"},goog.provide("fb.login.AuthenticationManager"),goog.require("fb.constants"),goog.require("fb.core.storage"),goog.require("fb.core.util"),goog.require("fb.core.util.EventEmitter"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.RequestInfo"),goog.require("fb.login.SessionManager"),goog.require("fb.login.transports.CordovaInAppBrowser"),goog.require("fb.login.transports.JSONP"),goog.require("fb.login.transports.NodeHttp"),goog.require("fb.login.transports.Popup"),goog.require("fb.login.transports.Redirect"),goog.require("fb.login.transports.XHR"),fb.login.AuthenticationManager=function(a,b,c,d){fb.core.util.EventEmitter.call(this,["auth_status"]),this.repoInfo_=a,this.authConn_=b,this.unauthConn_=c,this.onAuthStatus_=d,this.sessionManager_=new fb.login.SessionManager(a,[fb.core.storage.PersistentStorage,fb.core.storage.SessionStorage]),this.authData_=null,this.resumeSession()},goog.inherits(fb.login.AuthenticationManager,fb.core.util.EventEmitter),fb.login.AuthenticationManager.prototype.getAuth=function(){return this.authData_||null},fb.login.AuthenticationManager.prototype.resumeSession=function(){var a=fb.core.storage.SessionStorage.get(fb.login.Constants.REDIR_REQUEST_ID_KEY),b=this;a&&this.finishOAuthRedirectLogin_();var c=this.sessionManager_.get();c&&c.token?(this.updateAuthStatus_(c),this.authConn_(c.token,function(a,d){b.authOnComplete_(a,d,!1,c.token,c)},function(a,c){b.authOnCancel_("resumeSession()",a,c)})):this.updateAuthStatus_(null)},fb.login.AuthenticationManager.prototype.authenticate=function(a,b,c,d,e){this.repoInfo_.isDemoHost()&&fb.core.util.warn("Firebase authentication is not supported on demo Firebases (*.firebaseio-demo.com). To secure your Firebase, create a production Firebase at https://www.firebase.com.");var f=this;this.authConn_(a,function(e,g){f.authOnComplete_(e,g,!0,a,b,c||{},d)},function(a,b){f.authOnCancel_("auth()",a,b,e)})},fb.login.AuthenticationManager.prototype.unauthenticate=function(a){var b=this;this.sessionManager_.clear(),b.updateAuthStatus_(null),this.unauthConn_(function(b,c){if("ok"===b)fb.core.util.callUserCallback(a,null);else{var d=(b||"error").toUpperCase(),e=d;c&&(e+=": "+c);var f=new Error(e);f.code=d,fb.core.util.callUserCallback(a,f)}})},fb.login.AuthenticationManager.prototype.authOnComplete_=function(a,b,c,d,e,f,g){if("ok"===a){if(c){var h=b.auth;e.auth=h,e.expires=b.expires,e.token=fb.util.jwt.isValidFormat(d)?d:"";var i=null;h&&fb.util.obj.contains(h,"uid")?i=fb.util.obj.get(h,"uid"):fb.util.obj.contains(e,"uid")&&(i=fb.util.obj.get(e,"uid")),e.uid=i;var j="custom";if(h&&fb.util.obj.contains(h,"provider")?j=fb.util.obj.get(h,"provider"):fb.util.obj.contains(e,"provider")&&(j=fb.util.obj.get(e,"provider")),e.provider=j,this.sessionManager_.clear(),fb.util.jwt.isValidFormat(d)){f=f||{};var k=fb.core.storage.PersistentStorage;"sessionOnly"===f[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]&&(k=fb.core.storage.SessionStorage),"none"!==f[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]&&this.sessionManager_.set(e,k)}this.updateAuthStatus_(e)}return void fb.core.util.callUserCallback(g,null,e)}this.handleBadAuthStatus_();var l=(a||"error").toUpperCase(),m=l;b&&(m+=": "+b);var n=new Error(m);n.code=l,fb.core.util.callUserCallback(g,n)},fb.login.AuthenticationManager.prototype.authOnCancel_=function(a,b,c,d){fb.core.util.warn(a+" was canceled: "+c),this.handleBadAuthStatus_();var e=new Error(c);e.code=b.toUpperCase(),fb.core.util.callUserCallback(d,e)},fb.login.AuthenticationManager.prototype.handleBadAuthStatus_=function(){this.sessionManager_.clear(),this.updateAuthStatus_(null)},fb.login.AuthenticationManager.prototype.authWithCredential=function(a,b,c,d){this.checkServerSettingsOrThrow();var e,f=new fb.login.RequestInfo(c||{},{},b||{});e=NODE_CLIENT?[fb.login.transports.NodeHttp]:[fb.login.transports.XHR,fb.login.transports.JSONP],this.authWithTransports_(e,"/auth/"+a,f,d)},fb.login.AuthenticationManager.prototype.authWithPopup=function(a,b,c){this.checkServerSettingsOrThrow();var d=[fb.login.transports.Popup,fb.login.transports.CordovaInAppBrowser],e=fb.login.RequestInfo.fromParams(b),f=625,g=625;return"anonymous"===a||"password"===a?void setTimeout(function(){fb.core.util.callUserCallback(c,fb.login.Errors.get("TRANSPORT_UNAVAILABLE"))},0):(e.transportOptions.window_features="menubar=yes,modal=yes,alwaysRaised=yeslocation=yes,resizable=yes,scrollbars=yes,status=yes,height="+g+",width="+f+",top="+("object"==typeof screen?.5*(screen.height-g):0)+",left="+("object"==typeof screen?.5*(screen.width-f):0),e.transportOptions.relay_url=fb.login.transports.util.getPopupChannelUrl(this.repoInfo_.namespace),e.transportOptions.requestWithCredential=goog.bind(this.requestWithCredential,this),void this.authWithTransports_(d,"/auth/"+a,e,c))},fb.login.AuthenticationManager.prototype.authWithRedirect=function(a,b,c){this.checkServerSettingsOrThrow();var d=[fb.login.transports.Redirect],e=fb.login.RequestInfo.fromParams(b);return"anonymous"===a||"firebase"===a?void fb.core.util.callUserCallback(c,fb.login.Errors.get("TRANSPORT_UNAVAILABLE")):(fb.core.storage.SessionStorage.set(fb.login.Constants.REDIR_CLIENT_OPTIONS_KEY,e.clientOptions),void this.authWithTransports_(d,"/auth/"+a,e,c))},fb.login.AuthenticationManager.prototype.finishOAuthRedirectLogin_=function(){var a=fb.core.storage.SessionStorage.get(fb.login.Constants.REDIR_REQUEST_ID_KEY);if(a){var b=fb.core.storage.SessionStorage.get(fb.login.Constants.REDIR_CLIENT_OPTIONS_KEY);fb.core.storage.SessionStorage.remove(fb.login.Constants.REDIR_REQUEST_ID_KEY),fb.core.storage.SessionStorage.remove(fb.login.Constants.REDIR_CLIENT_OPTIONS_KEY);var c=[fb.login.transports.XHR,fb.login.transports.JSONP],d={requestId:a,requestKey:fb.login.transports.util.extractRedirectCompletionHash(document.location.hash)},e={},f=new fb.login.RequestInfo(b,e,d);fb.login.transports.util.replaceRedirectCompletionHash(),this.authWithTransports_(c,"/auth/session",f)}},fb.login.AuthenticationManager.prototype.createUser=function(a,b){this.checkServerSettingsOrThrow();var c="/users",d=fb.login.RequestInfo.fromParams(a);d.serverParams._method="POST",this.requestWithCredential(c,d,function(a,c){a?fb.core.util.callUserCallback(b,a):fb.core.util.callUserCallback(b,a,c)})},fb.login.AuthenticationManager.prototype.removeUser=function(a,b){var c=this;this.checkServerSettingsOrThrow();var d="/users/"+encodeURIComponent(a.email),e=fb.login.RequestInfo.fromParams(a);e.serverParams._method="DELETE",this.requestWithCredential(d,e,function(a,d){!a&&d&&d.uid&&c.authData_&&c.authData_.uid&&c.authData_.uid===d.uid&&c.unauthenticate(),fb.core.util.callUserCallback(b,a)})},fb.login.AuthenticationManager.prototype.changePassword=function(a,b){this.checkServerSettingsOrThrow();var c="/users/"+encodeURIComponent(a.email)+"/password",d=fb.login.RequestInfo.fromParams(a);d.serverParams._method="PUT",d.serverParams.password=a.newPassword,this.requestWithCredential(c,d,function(a){fb.core.util.callUserCallback(b,a)})},fb.login.AuthenticationManager.prototype.changeEmail=function(a,b){this.checkServerSettingsOrThrow();var c="/users/"+encodeURIComponent(a.oldEmail)+"/email",d=fb.login.RequestInfo.fromParams(a);d.serverParams._method="PUT",d.serverParams.email=a.newEmail,d.serverParams.password=a.password,this.requestWithCredential(c,d,function(a){fb.core.util.callUserCallback(b,a)})},fb.login.AuthenticationManager.prototype.resetPassword=function(a,b){this.checkServerSettingsOrThrow();var c="/users/"+encodeURIComponent(a.email)+"/password",d=fb.login.RequestInfo.fromParams(a);d.serverParams._method="POST",this.requestWithCredential(c,d,function(a){fb.core.util.callUserCallback(b,a)})},fb.login.AuthenticationManager.prototype.requestWithCredential=function(a,b,c){var d;d=NODE_CLIENT?[fb.login.transports.NodeHttp]:[fb.login.transports.XHR,fb.login.transports.JSONP],this.requestWithTransports_(d,a,b,c)},fb.login.AuthenticationManager.prototype.authWithTransports_=function(a,b,c,d){var e=this;this.requestWithTransports_(a,b,c,function(a,b){a||!(b&&b.token&&b.uid)?fb.core.util.callUserCallback(d,a||fb.login.Errors.get("UNKNOWN_ERROR")):(b=b,e.authenticate(b.token,b,c.clientOptions,function(a,b){a?fb.core.util.callUserCallback(d,a):fb.core.util.callUserCallback(d,null,b)}))})},fb.login.AuthenticationManager.prototype.requestWithTransports_=function(a,b,c,d){var e=goog.array.filter(a,function(a){return"function"==typeof a.isAvailable&&a.isAvailable()});if(0===e.length)return void setTimeout(function(){fb.core.util.callUserCallback(d,fb.login.Errors.get("TRANSPORT_UNAVAILABLE"))},0);var f=e.shift(),g=new f(c.transportOptions),h=fb.util.obj.clone(c.serverParams);h.v=this.versionString(),h.transport=g.classification(),h.suppress_status_codes=!0;var i=fb.login.transports.util.getBaseUrl()+"/"+this.repoInfo_.namespace+b;g.open(i,h,function(a,b){if(a)fb.core.util.callUserCallback(d,a);else if(b&&b.error){var c=new Error(b.error.message);c.code=b.error.code,c.details=b.error.details,fb.core.util.callUserCallback(d,c)}else fb.core.util.callUserCallback(d,null,b)
})},fb.login.AuthenticationManager.prototype.updateAuthStatus_=function(a){var b=null!==this.authData_||null!==a;this.authData_=a,b&&this.trigger("auth_status",a),this.onAuthStatus_(null!==a)},fb.login.AuthenticationManager.prototype.getInitialEvent=function(a){return fb.core.util.assert("auth_status"===a,'initial event must be of type "auth_status"'),[this.authData_]},fb.login.AuthenticationManager.prototype.versionString=function(){return(NODE_CLIENT?"node-":"js-")+CLIENT_VERSION},fb.login.AuthenticationManager.prototype.checkServerSettingsOrThrow=function(){if(this.repoInfo_.isCustomHost()&&fb.login.Constants.SERVER_HOST===fb.login.Constants.DEFAULT_SERVER_HOST)throw new Error("This custom Firebase server ('"+this.repoInfo_.domain+"') does not support delegated login.")},goog.provide("fb.core.util.ServerValues"),fb.core.util.ServerValues.generateWithValues=function(a){return a=a||{},a.timestamp=a.timestamp||(new Date).getTime(),a},fb.core.util.ServerValues.resolveDeferredValue=function(a,b){return a&&"object"==typeof a?(fb.core.util.assert(".sv"in a,"Unexpected leaf node or priority contents"),b[a[".sv"]]):a},fb.core.util.ServerValues.resolveDeferredValueTree=function(a,b){var c=new fb.core.SparseSnapshotTree;return a.forEachTree(new fb.core.util.Path(""),function(a,d){c.remember(a,fb.core.util.ServerValues.resolveDeferredValueSnapshot(d,b))}),c},fb.core.util.ServerValues.resolveDeferredValueSnapshot=function(a,b){var c,d=a.getPriority().val(),e=fb.core.util.ServerValues.resolveDeferredValue(d,b);if(a.isLeafNode()){var f=a,g=fb.core.util.ServerValues.resolveDeferredValue(f.getValue(),b);return g!==f.getValue()||e!==f.getPriority().val()?new fb.core.snap.LeafNode(g,fb.core.snap.NodeFromJSON(e)):a}var h=a;return c=h,e!==h.getPriority().val()&&(c=c.updatePriority(new fb.core.snap.LeafNode(e))),h.forEachChild(fb.core.snap.PriorityIndex,function(a,d){var e=fb.core.util.ServerValues.resolveDeferredValueSnapshot(d,b);e!==d&&(c=c.updateImmediateChild(a,e))}),c},goog.provide("fb.core.view.CacheNode"),fb.core.view.CacheNode=function(a,b,c){this.node_=a,this.fullyInitialized_=b,this.filtered_=c},fb.core.view.CacheNode.prototype.isFullyInitialized=function(){return this.fullyInitialized_},fb.core.view.CacheNode.prototype.isFiltered=function(){return this.filtered_},fb.core.view.CacheNode.prototype.isCompleteForPath=function(a){if(a.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var b=a.getFront();return this.isCompleteForChild(b)},fb.core.view.CacheNode.prototype.isCompleteForChild=function(a){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(a)},fb.core.view.CacheNode.prototype.getNode=function(){return this.node_},goog.provide("fb.core.view.ViewCache"),goog.require("fb.core.view.CacheNode"),fb.core.view.ViewCache=function(a,b){this.eventCache_=a,this.serverCache_=b},fb.core.view.ViewCache.Empty=new fb.core.view.ViewCache(new fb.core.view.CacheNode(fb.core.snap.EMPTY_NODE,!1,!1),new fb.core.view.CacheNode(fb.core.snap.EMPTY_NODE,!1,!1)),fb.core.view.ViewCache.prototype.updateEventSnap=function(a,b,c){return new fb.core.view.ViewCache(new fb.core.view.CacheNode(a,b,c),this.serverCache_)},fb.core.view.ViewCache.prototype.updateServerSnap=function(a,b,c){return new fb.core.view.ViewCache(this.eventCache_,new fb.core.view.CacheNode(a,b,c))},fb.core.view.ViewCache.prototype.getEventCache=function(){return this.eventCache_},fb.core.view.ViewCache.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},fb.core.view.ViewCache.prototype.getServerCache=function(){return this.serverCache_},fb.core.view.ViewCache.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},goog.provide("fb.core.view.ViewProcessor"),goog.require("fb.core.view.CompleteChildSource"),fb.core.view.ProcessorResult=function(a,b){this.viewCache=a,this.changes=b},fb.core.view.ViewProcessor=function(a){this.filter_=a},fb.core.view.ViewProcessor.prototype.assertIndexed=function(a){fb.core.util.assert(a.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),fb.core.util.assert(a.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},fb.core.view.ViewProcessor.prototype.applyOperation=function(a,b,c,d){var e,f,g=new fb.core.view.ChildChangeAccumulator;if(b.type===fb.core.OperationType.OVERWRITE){var h=b;h.source.fromUser?e=this.applyUserOverwrite_(a,h.path,h.snap,c,d,g):(fb.core.util.assert(h.source.fromServer,"Unknown source."),f=h.source.tagged,e=this.applyServerOverwrite_(a,h.path,h.snap,c,d,f,g))}else if(b.type===fb.core.OperationType.MERGE){var i=b;i.source.fromUser?e=this.applyUserMerge_(a,i.path,i.children,c,d,g):(fb.core.util.assert(i.source.fromServer,"Unknown source."),f=i.source.tagged,e=this.applyServerMerge_(a,i.path,i.children,c,d,f,g))}else if(b.type===fb.core.OperationType.ACK_USER_WRITE){var j=b;e=j.revert?this.revertUserWrite_(a,j.path,c,d,g):this.ackUserWrite_(a,j.path,c,d,g)}else{if(b.type!==fb.core.OperationType.LISTEN_COMPLETE)throw fb.core.util.assertionError("Unknown operation type: "+b.type);e=this.listenComplete_(a,b.path,c,d,g)}var k=g.getChanges();return this.maybeAddValueEvent_(a,e,k),new fb.core.view.ProcessorResult(e,k)},fb.core.view.ViewProcessor.prototype.maybeAddValueEvent_=function(a,b,c){var d=b.getEventCache();if(d.isFullyInitialized()){var e=d.getNode().isLeafNode()||d.getNode().isEmpty(),f=a.getCompleteEventSnap();(c.length>0||!a.getEventCache().isFullyInitialized()||e&&!d.getNode().equals(f)||!d.getNode().getPriority().equals(f.getPriority()))&&c.push(fb.core.view.Change.valueChange(b.getCompleteEventSnap()))}},fb.core.view.ViewProcessor.prototype.generateEventCacheAfterServerEvent_=function(a,b,c,d,e){var f=a.getEventCache();if(null!=c.shadowingWrite(b))return a;var g,h;if(b.isEmpty())if(fb.core.util.assert(a.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),this.filter_.filtersNodes()){var i=a.getCompleteServerSnap(),j=i instanceof fb.core.snap.ChildrenNode?i:fb.core.snap.EMPTY_NODE,k=c.calcCompleteEventChildren(j);g=this.filter_.updateFullNode(a.getEventCache().getNode(),k,e)}else{var l=c.calcCompleteEventCache(a.getCompleteServerSnap());g=this.filter_.updateFullNode(a.getEventCache().getNode(),l,e)}else{var m=b.getFront();if(".priority"==m){fb.core.util.assert(1==b.getLength(),"Can't have a priority with additional path components");var n=f.getNode();h=a.getServerCache().getNode();var o=c.calcEventCacheAfterServerOverwrite(b,n,h);g=null!=o?this.filter_.updatePriority(n,o):f.getNode()}else{var p,q=b.popFront();if(f.isCompleteForChild(m)){h=a.getServerCache().getNode();var r=c.calcEventCacheAfterServerOverwrite(b,f.getNode(),h);p=null!=r?f.getNode().getImmediateChild(m).updateChild(q,r):f.getNode().getImmediateChild(m)}else p=c.calcCompleteChild(m,a.getServerCache());g=null!=p?this.filter_.updateChild(f.getNode(),m,p,d,e):f.getNode()}}return a.updateEventSnap(g,f.isFullyInitialized()||b.isEmpty(),this.filter_.filtersNodes())},fb.core.view.ViewProcessor.prototype.applyServerOverwrite_=function(a,b,c,d,e,f,g){var h,i=a.getServerCache(),j=f?this.filter_:this.filter_.getIndexedFilter();if(b.isEmpty())h=j.updateFullNode(i.getNode(),c,null);else if(j.filtersNodes()&&!i.isFiltered()){var k=i.getNode().updateChild(b,c);h=j.updateFullNode(i.getNode(),k,null)}else{var l=b.getFront();if(!i.isCompleteForPath(b)&&b.getLength()>1)return a;var m=i.getNode().getImmediateChild(l),n=m.updateChild(b.popFront(),c);h=".priority"==l?j.updatePriority(i.getNode(),n):j.updateChild(i.getNode(),l,n,fb.core.view.NO_COMPLETE_CHILD_SOURCE,null)}var o=a.updateServerSnap(h,i.isFullyInitialized()||b.isEmpty(),j.filtersNodes()),p=new fb.core.view.WriteTreeCompleteChildSource(d,o,e);return this.generateEventCacheAfterServerEvent_(o,b,d,p,g)},fb.core.view.ViewProcessor.prototype.applyUserOverwrite_=function(a,b,c,d,e,f){var g,h,i=a.getEventCache(),j=new fb.core.view.WriteTreeCompleteChildSource(d,a,e);if(b.isEmpty())h=this.filter_.updateFullNode(a.getEventCache().getNode(),c,f),g=a.updateEventSnap(h,!0,this.filter_.filtersNodes());else{var k=b.getFront();if(".priority"===k)h=this.filter_.updatePriority(a.getEventCache().getNode(),c),g=a.updateEventSnap(h,i.isFullyInitialized(),i.isFiltered());else{var l,m=b.popFront(),n=i.getNode().getImmediateChild(k);if(m.isEmpty())l=c;else{var o=j.getCompleteChild(k);l=null!=o?".priority"===m.getBack()&&o.getChild(m.parent()).isEmpty()?o:o.updateChild(m,c):fb.core.snap.EMPTY_NODE}if(n.equals(l))g=a;else{var p=this.filter_.updateChild(i.getNode(),k,l,j,f);g=a.updateEventSnap(p,i.isFullyInitialized(),this.filter_.filtersNodes())}}}return g},fb.core.view.ViewProcessor.cacheHasChild_=function(a,b){return a.getEventCache().isCompleteForChild(b)},fb.core.view.ViewProcessor.prototype.applyUserMerge_=function(a,b,c,d,e,f){var g=this,h=a;return c.foreach(function(c,i){var j=b.child(c);fb.core.view.ViewProcessor.cacheHasChild_(a,j.getFront())&&(h=g.applyUserOverwrite_(h,j,i,d,e,f))}),c.foreach(function(c,i){var j=b.child(c);fb.core.view.ViewProcessor.cacheHasChild_(a,j.getFront())||(h=g.applyUserOverwrite_(h,j,i,d,e,f))}),h},fb.core.view.ViewProcessor.prototype.applyMerge_=function(a,b){return b.foreach(function(b,c){a=a.updateChild(b,c)}),a},fb.core.view.ViewProcessor.prototype.applyServerMerge_=function(a,b,c,d,e,f,g){if(a.getServerCache().getNode().isEmpty()&&!a.getServerCache().isFullyInitialized())return a;var h,i=a;h=b.isEmpty()?c:fb.core.util.ImmutableTree.Empty.setTree(b,c);var j=a.getServerCache().getNode(),k=this;return h.children.inorderTraversal(function(b,c){if(j.hasChild(b)){var h=a.getServerCache().getNode().getImmediateChild(b),l=k.applyMerge_(h,c);i=k.applyServerOverwrite_(i,new fb.core.util.Path(b),l,d,e,f,g)}}),h.children.inorderTraversal(function(b,c){var h=!a.getServerCache().isFullyInitialized()&&null==c.value;if(!j.hasChild(b)&&!h){var l=a.getServerCache().getNode().getImmediateChild(b),m=k.applyMerge_(l,c);i=k.applyServerOverwrite_(i,new fb.core.util.Path(b),m,d,e,f,g)}}),i},fb.core.view.ViewProcessor.prototype.ackUserWrite_=function(a,b,c,d,e){if(null!=c.shadowingWrite(b))return a;var f,g=new fb.core.view.WriteTreeCompleteChildSource(c,a,d),h=a.getEventCache().getNode(),i=h;if(a.getServerCache().isFullyInitialized()){if(b.isEmpty()){var j=c.calcCompleteEventCache(a.getCompleteServerSnap());i=this.filter_.updateFullNode(a.getEventCache().getNode(),j,e)}else if(".priority"===b.getFront()){var k=c.calcCompleteChild(b.getFront(),a.getServerCache());null==k||h.isEmpty()||h.getPriority().equals(k)||(i=this.filter_.updatePriority(h,k))}else{var l=b.getFront(),m=c.calcCompleteChild(l,a.getServerCache());null!=m&&(i=this.filter_.updateChild(a.getEventCache().getNode(),l,m,g,e))}f=!0}else if(a.getEventCache().isFullyInitialized()){i=h;var n=a.getCompleteEventSnap();if(!n.isLeafNode()){var o=this;n=n,n.forEachChild(fb.core.snap.PriorityIndex,function(b){var d=c.calcCompleteChild(b,a.getServerCache());null!=d&&(i=o.filter_.updateChild(i,b,d,g,e))})}f=!0}else if(b.isEmpty())f=!1;else{var l=b.getFront();if(1==b.getLength()||a.getEventCache().isCompleteForChild(l)){var p=c.calcCompleteChild(l,a.getServerCache());null!=p&&(i=this.filter_.updateChild(h,l,p,g,e))}f=!1}return a.updateEventSnap(i,f,this.filter_.filtersNodes())},fb.core.view.ViewProcessor.prototype.revertUserWrite_=function(a,b,c,d,e){var f;if(null!=c.shadowingWrite(b))return a;var g,h=new fb.core.view.WriteTreeCompleteChildSource(c,a,d),i=a.getEventCache().getNode();if(b.isEmpty()||".priority"===b.getFront()){var j;if(a.getServerCache().isFullyInitialized())j=c.calcCompleteEventCache(a.getCompleteServerSnap());else{var k=a.getServerCache().getNode();fb.core.util.assert(k instanceof fb.core.snap.ChildrenNode,"serverChildren would be complete if leaf node"),j=c.calcCompleteEventChildren(k)}j=j,g=this.filter_.updateFullNode(i,j,e)}else{var l=b.getFront(),m=c.calcCompleteChild(l,a.getServerCache());null==m&&a.getServerCache().isCompleteForChild(l)&&(m=i.getImmediateChild(l)),g=null!=m?this.filter_.updateChild(i,l,m,h,e):a.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(i,l,fb.core.snap.EMPTY_NODE,h,e):i,g.isEmpty()&&a.getServerCache().isFullyInitialized()&&(f=c.calcCompleteEventCache(a.getCompleteServerSnap()),f.isLeafNode()&&(g=this.filter_.updateFullNode(g,f,e)))}return f=a.getServerCache().isFullyInitialized()||null!=c.shadowingWrite(fb.core.util.Path.Empty),a.updateEventSnap(g,f,this.filter_.filtersNodes())},fb.core.view.ViewProcessor.prototype.listenComplete_=function(a,b,c,d,e){var f=a.getServerCache(),g=a.updateServerSnap(f.getNode(),f.isFullyInitialized()||b.isEmpty(),f.isFiltered());return this.generateEventCacheAfterServerEvent_(g,b,c,fb.core.view.NO_COMPLETE_CHILD_SOURCE,e)},goog.provide("fb.core.view.EventGenerator"),goog.require("fb.core.snap.NamedNode"),fb.core.view.EventGenerator=function(a){this.query_=a,this.index_=a.getQueryParams().getIndex()},fb.core.view.EventGenerator.prototype.generateEventsForChanges=function(a,b,c){var d=[],e=this,f=[];return goog.array.forEach(a,function(a){a.type===fb.core.view.Change.CHILD_CHANGED&&e.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&f.push(fb.core.view.Change.childMovedChange(a.childName,a.snapshotNode))}),this.generateEventsForType_(d,fb.core.view.Change.CHILD_REMOVED,a,c,b),this.generateEventsForType_(d,fb.core.view.Change.CHILD_ADDED,a,c,b),this.generateEventsForType_(d,fb.core.view.Change.CHILD_MOVED,f,c,b),this.generateEventsForType_(d,fb.core.view.Change.CHILD_CHANGED,a,c,b),this.generateEventsForType_(d,fb.core.view.Change.VALUE,a,c,b),d},fb.core.view.EventGenerator.prototype.generateEventsForType_=function(a,b,c,d,e){var f=goog.array.filter(c,function(a){return a.type===b}),g=this;goog.array.sort(f,goog.bind(this.compareChanges_,this)),goog.array.forEach(f,function(b){var c=g.materializeSingleChange_(b,e);goog.array.forEach(d,function(d){d.respondsTo(b.type)&&a.push(d.createEvent(c,g.query_))})})},fb.core.view.EventGenerator.prototype.materializeSingleChange_=function(a,b){return"value"===a.type||"child_removed"===a.type?a:(a.prevName=b.getPredecessorChildName(a.childName,a.snapshotNode,this.index_),a)},fb.core.view.EventGenerator.prototype.compareChanges_=function(a,b){if(null==a.childName||null==b.childName)throw fb.core.util.assertionError("Should only compare child_ events.");var c=new fb.core.snap.NamedNode(a.childName,a.snapshotNode),d=new fb.core.snap.NamedNode(b.childName,b.snapshotNode);return this.index_.compare(c,d)},goog.provide("fb.core.view.View"),goog.require("fb.core.view.EventGenerator"),goog.require("fb.core.view.ViewCache"),goog.require("fb.core.view.ViewProcessor"),fb.core.view.View=function(a,b){this.query_=a;var c=a.getQueryParams(),d=new fb.core.view.filter.IndexedFilter(c.getIndex()),e=c.getNodeFilter();this.processor_=new fb.core.view.ViewProcessor(e);var f=b.getServerCache(),g=b.getEventCache(),h=d.updateFullNode(fb.core.snap.EMPTY_NODE,f.getNode(),null),i=e.updateFullNode(fb.core.snap.EMPTY_NODE,g.getNode(),null),j=new fb.core.view.CacheNode(h,f.isFullyInitialized(),d.filtersNodes()),k=new fb.core.view.CacheNode(i,g.isFullyInitialized(),e.filtersNodes());this.viewCache_=new fb.core.view.ViewCache(k,j),this.eventRegistrations_=[],this.eventGenerator_=new fb.core.view.EventGenerator(a)},fb.core.view.View.prototype.getQuery=function(){return this.query_},fb.core.view.View.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},fb.core.view.View.prototype.getCompleteServerCache=function(a){var b=this.viewCache_.getCompleteServerSnap();return b&&(this.query_.getQueryParams().loadsAllData()||!a.isEmpty()&&!b.getImmediateChild(a.getFront()).isEmpty())?b.getChild(a):null},fb.core.view.View.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},fb.core.view.View.prototype.addEventRegistration=function(a){this.eventRegistrations_.push(a)},fb.core.view.View.prototype.removeEventRegistration=function(a,b){var c=[];if(b){fb.core.util.assert(null==a,"A cancel should cancel all event registrations.");var d=this.query_.path;goog.array.forEach(this.eventRegistrations_,function(a){b=b;var e=a.createCancelEvent(b,d);e&&c.push(e)})}if(a){for(var e=[],f=0;f<this.eventRegistrations_.length;++f){var g=this.eventRegistrations_[f];if(g.matches(a)){if(a.hasAnyCallback()){e=e.concat(this.eventRegistrations_.slice(f+1));break}}else e.push(g)}this.eventRegistrations_=e}else this.eventRegistrations_=[];return c},fb.core.view.View.prototype.applyOperation=function(a,b,c){a.type===fb.core.OperationType.MERGE&&null!==a.source.queryId&&(fb.core.util.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),fb.core.util.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var d=this.viewCache_,e=this.processor_.applyOperation(d,a,b,c);return this.processor_.assertIndexed(e.viewCache),fb.core.util.assert(e.viewCache.getServerCache().isFullyInitialized()||!d.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=e.viewCache,this.generateEventsForChanges_(e.changes,e.viewCache.getEventCache().getNode(),null)},fb.core.view.View.prototype.getInitialEvents=function(a){var b=this.viewCache_.getEventCache(),c=[];if(!b.getNode().isLeafNode()){var d=b.getNode();d.forEachChild(fb.core.snap.PriorityIndex,function(a,b){c.push(fb.core.view.Change.childAddedChange(a,b))})}return b.isFullyInitialized()&&c.push(fb.core.view.Change.valueChange(b.getNode())),this.generateEventsForChanges_(c,b.getNode(),a)},fb.core.view.View.prototype.generateEventsForChanges_=function(a,b,c){var d=c?[c]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(a,b,d)},goog.provide("fb.core.util.ImmutableTree"),goog.require("fb.core.util.Path"),goog.require("fb.util.obj"),goog.require("goog.object"),fb.core.util.ImmutableTree=function(a,b){this.value=a,this.children=b||fb.core.util.ImmutableTree.EmptyChildren_},fb.core.util.ImmutableTree.EmptyChildren_=new fb.core.util.SortedMap(fb.core.util.stringCompare),fb.core.util.ImmutableTree.Empty=new fb.core.util.ImmutableTree(null),fb.core.util.ImmutableTree.fromObject=function(a){var b=fb.core.util.ImmutableTree.Empty;return goog.object.forEach(a,function(a,c){b=b.set(new fb.core.util.Path(c),a)}),b},fb.core.util.ImmutableTree.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},fb.core.util.ImmutableTree.prototype.findRootMostMatchingPathAndValue=function(a,b){if(null!=this.value&&b(this.value))return{path:fb.core.util.Path.Empty,value:this.value};if(a.isEmpty())return null;var c=a.getFront(),d=this.children.get(c);if(null!==d){var e=d.findRootMostMatchingPathAndValue(a.popFront(),b);if(null!=e){var f=new fb.core.util.Path(c).child(e.path);return{path:f,value:e.value}}return null}return null},fb.core.util.ImmutableTree.prototype.findRootMostValueAndPath=function(a){return this.findRootMostMatchingPathAndValue(a,function(){return!0})},fb.core.util.ImmutableTree.prototype.subtree=function(a){if(a.isEmpty())return this;var b=a.getFront(),c=this.children.get(b);return null!==c?c.subtree(a.popFront()):fb.core.util.ImmutableTree.Empty},fb.core.util.ImmutableTree.prototype.set=function(a,b){if(a.isEmpty())return new fb.core.util.ImmutableTree(b,this.children);var c=a.getFront(),d=this.children.get(c)||fb.core.util.ImmutableTree.Empty,e=d.set(a.popFront(),b),f=this.children.insert(c,e);return new fb.core.util.ImmutableTree(this.value,f)},fb.core.util.ImmutableTree.prototype.remove=function(a){if(a.isEmpty())return this.children.isEmpty()?fb.core.util.ImmutableTree.Empty:new fb.core.util.ImmutableTree(null,this.children);var b=a.getFront(),c=this.children.get(b);if(c){var d,e=c.remove(a.popFront());return d=e.isEmpty()?this.children.remove(b):this.children.insert(b,e),null===this.value&&d.isEmpty()?fb.core.util.ImmutableTree.Empty:new fb.core.util.ImmutableTree(this.value,d)}return this},fb.core.util.ImmutableTree.prototype.get=function(a){if(a.isEmpty())return this.value;var b=a.getFront(),c=this.children.get(b);return c?c.get(a.popFront()):null},fb.core.util.ImmutableTree.prototype.setTree=function(a,b){if(a.isEmpty())return b;var c,d=a.getFront(),e=this.children.get(d)||fb.core.util.ImmutableTree.Empty,f=e.setTree(a.popFront(),b);return c=f.isEmpty()?this.children.remove(d):this.children.insert(d,f),new fb.core.util.ImmutableTree(this.value,c)},fb.core.util.ImmutableTree.prototype.fold=function(a){return this.fold_(fb.core.util.Path.Empty,a)},fb.core.util.ImmutableTree.prototype.fold_=function(a,b){var c={};return this.children.inorderTraversal(function(d,e){c[d]=e.fold_(a.child(d),b)}),b(a,this.value,c)},fb.core.util.ImmutableTree.prototype.findOnPath=function(a,b){return this.findOnPath_(a,fb.core.util.Path.Empty,b)},fb.core.util.ImmutableTree.prototype.findOnPath_=function(a,b,c){var d=this.value?c(b,this.value):!1;if(d)return d;if(a.isEmpty())return null;var e=a.getFront(),f=this.children.get(e);return f?f.findOnPath_(a.popFront(),b.child(e),c):null},fb.core.util.ImmutableTree.prototype.foreachOnPathWhile=function(a,b){return this.foreachOnPathWhile_(a,fb.core.util.Path.Empty,b)},fb.core.util.ImmutableTree.prototype.foreachOnPathWhile_=function(a,b,c){if(a.isEmpty())return b;var d=!0;if(this.value&&(d=c(b,this.value)),d===!0){var e=a.getFront(),f=this.children.get(e);return f?f.foreachOnPath_(a.popFront(),b.child(e),c):b}return b},fb.core.util.ImmutableTree.prototype.foreachOnPath=function(a,b){return this.foreachOnPath_(a,fb.core.util.Path.Empty,b)},fb.core.util.ImmutableTree.prototype.foreachOnPath_=function(a,b,c){if(a.isEmpty())return this;this.value&&c(b,this.value);var d=a.getFront(),e=this.children.get(d);return e?e.foreachOnPath_(a.popFront(),b.child(d),c):fb.core.util.ImmutableTree.Empty},fb.core.util.ImmutableTree.prototype.foreach=function(a){this.foreach_(fb.core.util.Path.Empty,a)},fb.core.util.ImmutableTree.prototype.foreach_=function(a,b){this.children.inorderTraversal(function(c,d){d.foreach_(a.child(c),b)}),this.value&&b(a,this.value)},fb.core.util.ImmutableTree.prototype.foreachChild=function(a){this.children.inorderTraversal(function(b,c){c.value&&a(b,c.value)})},goog.DEBUG&&(fb.core.util.ImmutableTree.prototype.toString=function(){var a={};return this.foreach(function(b,c){var d=b.toString();a[d]=c.toString()}),fb.util.json.stringify(a)}),goog.provide("fb.core.SyncPoint"),goog.require("fb.core.util.ImmutableTree"),goog.require("fb.core.view.ViewCache"),goog.require("fb.core.view.EventRegistration"),goog.require("fb.core.view.View"),goog.require("goog.array"),fb.core.SyncPoint=function(){this.views_={}},fb.core.SyncPoint.prototype.isEmpty=function(){return goog.object.isEmpty(this.views_)},fb.core.SyncPoint.prototype.applyOperation=function(a,b,c){var d=a.source.queryId;if(null!==d){var e=fb.util.obj.get(this.views_,d);return fb.core.util.assert(null!=e,"SyncTree gave us an op for an invalid query."),e.applyOperation(a,b,c)}var f=[];return goog.object.forEach(this.views_,function(d){f=f.concat(d.applyOperation(a,b,c))}),f},fb.core.SyncPoint.prototype.addEventRegistration=function(a,b,c,d,e){var f=a.queryIdentifier(),g=fb.util.obj.get(this.views_,f);if(!g){var h=c.calcCompleteEventCache(e?d:null),i=!1;h?i=!0:d instanceof fb.core.snap.ChildrenNode?(h=c.calcCompleteEventChildren(d),i=!1):(h=fb.core.snap.EMPTY_NODE,i=!1);var j=new fb.core.view.ViewCache(new fb.core.view.CacheNode(h,i,!1),new fb.core.view.CacheNode(d,e,!1));g=new fb.core.view.View(a,j),this.views_[f]=g}return g.addEventRegistration(b),g.getInitialEvents(b)},fb.core.SyncPoint.prototype.removeEventRegistration=function(a,b,c){var d=a.queryIdentifier(),e=[],f=[],g=this.hasCompleteView();if("default"===d){var h=this;goog.object.forEach(this.views_,function(a,d){f=f.concat(a.removeEventRegistration(b,c)),a.isEmpty()&&(delete h.views_[d],a.getQuery().getQueryParams().loadsAllData()||e.push(a.getQuery()))})}else{var i=fb.util.obj.get(this.views_,d);i&&(f=f.concat(i.removeEventRegistration(b,c)),i.isEmpty()&&(delete this.views_[d],i.getQuery().getQueryParams().loadsAllData()||e.push(i.getQuery())))}return g&&!this.hasCompleteView()&&e.push(new Firebase(a.repo,a.path)),{removed:e,events:f}},fb.core.SyncPoint.prototype.getQueryViews=function(){return goog.array.filter(goog.object.getValues(this.views_),function(a){return!a.getQuery().getQueryParams().loadsAllData()})},fb.core.SyncPoint.prototype.getCompleteServerCache=function(a){var b=null;return goog.object.forEach(this.views_,function(c){b=b||c.getCompleteServerCache(a)}),b},fb.core.SyncPoint.prototype.viewForQuery=function(a){var b=a.getQueryParams();if(b.loadsAllData())return this.getCompleteView();var c=a.queryIdentifier();return fb.util.obj.get(this.views_,c)},fb.core.SyncPoint.prototype.viewExistsForQuery=function(a){return null!=this.viewForQuery(a)},fb.core.SyncPoint.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},fb.core.SyncPoint.prototype.getCompleteView=function(){var a=goog.object.findValue(this.views_,function(a){return a.getQuery().getQueryParams().loadsAllData()});return a||null},goog.provide("fb.core.CompoundWrite"),goog.require("fb.core.snap.Node"),goog.require("fb.core.util.ImmutableTree"),fb.core.CompoundWrite=function(a){this.writeTree_=a},fb.core.CompoundWrite.Empty=new fb.core.CompoundWrite(new fb.core.util.ImmutableTree(null)),fb.core.CompoundWrite.prototype.addWrite=function(a,b){if(a.isEmpty())return new fb.core.CompoundWrite(new fb.core.util.ImmutableTree(b));var c=this.writeTree_.findRootMostValueAndPath(a);if(null!=c){var d=c.path,e=c.value,f=fb.core.util.Path.RelativePath(d,a);return e=e.updateChild(f,b),new fb.core.CompoundWrite(this.writeTree_.set(d,e))}var g=new fb.core.util.ImmutableTree(b),h=this.writeTree_.setTree(a,g);return new fb.core.CompoundWrite(h)},fb.core.CompoundWrite.prototype.addWrites=function(a,b){var c=this;return fb.util.obj.foreach(b,function(b,d){c=c.addWrite(a.child(b),d)}),c},fb.core.CompoundWrite.prototype.removeWrite=function(a){if(a.isEmpty())return fb.core.CompoundWrite.Empty;var b=this.writeTree_.setTree(a,fb.core.util.ImmutableTree.Empty);return new fb.core.CompoundWrite(b)},fb.core.CompoundWrite.prototype.hasCompleteWrite=function(a){return null!=this.getCompleteNode(a)},fb.core.CompoundWrite.prototype.getCompleteNode=function(a){var b=this.writeTree_.findRootMostValueAndPath(a);return null!=b?this.writeTree_.get(b.path).getChild(fb.core.util.Path.RelativePath(b.path,a)):null},fb.core.CompoundWrite.prototype.getCompleteChildren=function(){var a=[],b=this.writeTree_.value;return null!=b?b.isLeafNode()||(b=b,b.forEachChild(fb.core.snap.PriorityIndex,function(b,c){a.push(new fb.core.snap.NamedNode(b,c))})):this.writeTree_.children.inorderTraversal(function(b,c){null!=c.value&&a.push(new fb.core.snap.NamedNode(b,c.value))}),a},fb.core.CompoundWrite.prototype.childCompoundWrite=function(a){if(a.isEmpty())return this;var b=this.getCompleteNode(a);return new fb.core.CompoundWrite(null!=b?new fb.core.util.ImmutableTree(b):this.writeTree_.subtree(a))},fb.core.CompoundWrite.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},fb.core.CompoundWrite.prototype.apply=function(a){return fb.core.CompoundWrite.applySubtreeWrite_(fb.core.util.Path.Empty,this.writeTree_,a)},fb.core.CompoundWrite.applySubtreeWrite_=function(a,b,c){if(null!=b.value)return c.updateChild(a,b.value);var d=null;return b.children.inorderTraversal(function(b,e){".priority"===b?(fb.core.util.assert(null!==e.value,"Priority writes must always be leaf nodes"),d=e.value):c=fb.core.CompoundWrite.applySubtreeWrite_(a.child(b),e,c)}),c.getChild(a).isEmpty()||null===d||(c=c.updateChild(a.child(".priority"),d)),c},goog.provide("fb.core.WriteTree"),goog.require("fb.core.CompoundWrite"),goog.require("fb.core.view.CacheNode"),fb.core.WriteRecord,fb.core.WriteTree=function(){this.visibleWrites_=fb.core.CompoundWrite.Empty,this.allWrites_=[],this.lastWriteId_=-1},fb.core.WriteTree.prototype.childWrites=function(a){return new fb.core.WriteTreeRef(a,this)},fb.core.WriteTree.prototype.addOverwrite=function(a,b,c,d){fb.core.util.assert(c>this.lastWriteId_,"Stacking an older write on top of newer ones"),goog.isDef(d)||(d=!0),this.allWrites_.push({path:a,snap:b,writeId:c,visible:d}),d&&(this.visibleWrites_=this.visibleWrites_.addWrite(a,b)),this.lastWriteId_=c},fb.core.WriteTree.prototype.addMerge=function(a,b,c){fb.core.util.assert(c>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:a,children:b,writeId:c,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(a,b),this.lastWriteId_=c},fb.core.WriteTree.prototype.removeWrite=function(a){var b=goog.array.findIndex(this.allWrites_,function(b){return b.writeId===a});fb.core.util.assert(b>=0,"removeWrite called with nonexistent writeId.");var c=this.allWrites_[b];this.allWrites_.splice(b,1);for(var d=c.visible,e=!1,f=this.allWrites_.length-1;d&&f>=0;){var g=this.allWrites_[f];g.visible&&(f>=b&&this.recordContainsPath_(g,c.path)?d=!1:c.path.contains(g.path)&&(e=!0)),f--}if(d){if(e)return this.resetTree_(),c.path;if(c.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(c.path);else{var h=c.children,i=this;goog.object.forEach(h,function(a,b){i.visibleWrites_=i.visibleWrites_.removeWrite(c.path.child(b))})}return c.path}return null},fb.core.WriteTree.prototype.getCompleteWriteData=function(a){return this.visibleWrites_.getCompleteNode(a)},fb.core.WriteTree.prototype.calcCompleteEventCache=function(a,b,c,d){if(c||d){var e=this.visibleWrites_.childCompoundWrite(a);if(!d&&e.isEmpty())return b;if(d||null!=b||e.hasCompleteWrite(fb.core.util.Path.Empty)){var f=function(b){return!(!b.visible&&!d||c&&goog.array.contains(c,b.writeId)||!b.path.contains(a)&&!a.contains(b.path))},g=fb.core.WriteTree.layerTree_(this.allWrites_,f,a);return j=b||fb.core.snap.EMPTY_NODE,g.apply(j)}return null}var h=this.visibleWrites_.getCompleteNode(a);if(null!=h)return h;var i=this.visibleWrites_.childCompoundWrite(a);if(i.isEmpty())return b;if(null!=b||i.hasCompleteWrite(fb.core.util.Path.Empty)){var j=b||fb.core.snap.EMPTY_NODE;return i.apply(j)}return null},fb.core.WriteTree.prototype.calcCompleteEventChildren=function(a,b){var c=fb.core.snap.EMPTY_NODE,d=this.visibleWrites_.getCompleteNode(a);if(d)return d.isLeafNode()||d.forEachChild(fb.core.snap.PriorityIndex,function(a,b){c=c.updateImmediateChild(a,b)}),c;if(b){var e=this.visibleWrites_.childCompoundWrite(a);return b.forEachChild(fb.core.snap.PriorityIndex,function(a,b){var d=e.childCompoundWrite(new fb.core.util.Path(a)).apply(b);c=c.updateImmediateChild(a,d)}),goog.array.forEach(e.getCompleteChildren(),function(a){c=c.updateImmediateChild(a.name,a.node)}),c}return e=this.visibleWrites_.childCompoundWrite(a),goog.array.forEach(e.getCompleteChildren(),function(a){c=c.updateImmediateChild(a.name,a.node)}),c},fb.core.WriteTree.prototype.calcEventCacheAfterServerOverwrite=function(a,b,c,d){fb.core.util.assert(c||d,"Either existingEventSnap or existingServerSnap must exist");var e=a.child(b);if(this.visibleWrites_.hasCompleteWrite(e))return null;var f=this.visibleWrites_.childCompoundWrite(e);return f.isEmpty()?d.getChild(b):f.apply(d.getChild(b))},fb.core.WriteTree.prototype.calcCompleteChild=function(a,b,c){var d=a.child(b),e=this.visibleWrites_.getCompleteNode(d);if(null!=e)return e;if(c.isCompleteForChild(b)){var f=this.visibleWrites_.childCompoundWrite(d);return f.apply(c.getNode().getImmediateChild(b))}return null},fb.core.WriteTree.prototype.shadowingWrite=function(a){return this.visibleWrites_.getCompleteNode(a)},fb.core.WriteTree.prototype.calcIndexedSlice=function(a,b,c,d,e,f){var g,h=this.visibleWrites_.childCompoundWrite(a),i=h.getCompleteNode(fb.core.util.Path.Empty);if(null!=i)g=i;else{if(null==b)return[];g=h.apply(b)}if(g=g.withIndex(f),g.isEmpty()||g.isLeafNode())return[];
for(var j=[],k=f.getCompare(),l=e?g.getReverseIteratorFrom(c,f):g.getIteratorFrom(c,f),m=l.getNext();m&&j.length<d;)0!==k(m,c)&&j.push(m),m=l.getNext();return j},fb.core.WriteTree.prototype.recordContainsPath_=function(a,b){return a.snap?a.path.contains(b):!!goog.object.findKey(a.children,function(c,d){return a.path.child(d).contains(b)})},fb.core.WriteTree.prototype.resetTree_=function(){this.visibleWrites_=fb.core.WriteTree.layerTree_(this.allWrites_,fb.core.WriteTree.DefaultFilter_,fb.core.util.Path.Empty),this.lastWriteId_=this.allWrites_.length>0?this.allWrites_[this.allWrites_.length-1].writeId:-1},fb.core.WriteTree.DefaultFilter_=function(a){return a.visible},fb.core.WriteTree.layerTree_=function(a,b,c){for(var d=fb.core.CompoundWrite.Empty,e=0;e<a.length;++e){var f=a[e];if(b(f)){var g,h=f.path;if(f.snap)c.contains(h)?(g=fb.core.util.Path.RelativePath(c,h),d=d.addWrite(g,f.snap)):h.contains(c)&&(g=fb.core.util.Path.RelativePath(h,c),d=d.addWrite(fb.core.util.Path.Empty,f.snap.getChild(g)));else{if(!f.children)throw fb.core.util.assertionError("WriteRecord should have .snap or .children");if(c.contains(h))g=fb.core.util.Path.RelativePath(c,h),d=d.addWrites(g,f.children);else if(h.contains(c))if(g=fb.core.util.Path.RelativePath(h,c),g.isEmpty())d=d.addWrites(fb.core.util.Path.Empty,f.children);else{var i=fb.util.obj.get(f.children,g.getFront());if(i){var j=i.getChild(g.popFront());d=d.addWrite(fb.core.util.Path.Empty,j)}}}}}return d},fb.core.WriteTreeRef=function(a,b){this.treePath_=a,this.writeTree_=b},fb.core.WriteTreeRef.prototype.calcCompleteEventCache=function(a,b,c){return this.writeTree_.calcCompleteEventCache(this.treePath_,a,b,c)},fb.core.WriteTreeRef.prototype.calcCompleteEventChildren=function(a){return this.writeTree_.calcCompleteEventChildren(this.treePath_,a)},fb.core.WriteTreeRef.prototype.calcEventCacheAfterServerOverwrite=function(a,b,c){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,a,b,c)},fb.core.WriteTreeRef.prototype.shadowingWrite=function(a){return this.writeTree_.shadowingWrite(this.treePath_.child(a))},fb.core.WriteTreeRef.prototype.calcIndexedSlice=function(a,b,c,d,e){return this.writeTree_.calcIndexedSlice(this.treePath_,a,b,c,d,e)},fb.core.WriteTreeRef.prototype.calcCompleteChild=function(a,b){return this.writeTree_.calcCompleteChild(this.treePath_,a,b)},fb.core.WriteTreeRef.prototype.child=function(a){return new fb.core.WriteTreeRef(this.treePath_.child(a),this.writeTree_)},goog.provide("fb.core.operation.Overwrite"),fb.core.operation.Overwrite=function(a,b,c){this.type=fb.core.OperationType.OVERWRITE,this.source=a,this.path=b,this.snap=c},fb.core.operation.Overwrite.prototype.operationForChild=function(a){return this.path.isEmpty()?new fb.core.operation.Overwrite(this.source,fb.core.util.Path.Empty,this.snap.getImmediateChild(a)):new fb.core.operation.Overwrite(this.source,this.path.popFront(),this.snap)},goog.DEBUG&&(fb.core.operation.Overwrite.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" overwrite: "+this.snap.toString()+")"}),goog.provide("fb.core.operation.AckUserWrite"),fb.core.operation.AckUserWrite=function(a,b){this.type=fb.core.OperationType.ACK_USER_WRITE,this.source=fb.core.OperationSource.User,this.path=a,this.revert=b},fb.core.operation.AckUserWrite.prototype.operationForChild=function(){return this.path.isEmpty()?this:new fb.core.operation.AckUserWrite(this.path.popFront(),this.revert)},goog.DEBUG&&(fb.core.operation.AckUserWrite.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" ack write revert="+this.revert+")"}),goog.provide("fb.core.operation.ListenComplete"),fb.core.operation.ListenComplete=function(a,b){this.type=fb.core.OperationType.LISTEN_COMPLETE,this.source=a,this.path=b},fb.core.operation.ListenComplete.prototype.operationForChild=function(){return this.path.isEmpty()?new fb.core.operation.ListenComplete(this.source,fb.core.util.Path.Empty):new fb.core.operation.ListenComplete(this.source,this.path.popFront())},goog.DEBUG&&(fb.core.operation.ListenComplete.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" listen_complete)"}),goog.provide("fb.core.operation.Merge"),fb.core.operation.Merge=function(a,b,c){this.type=fb.core.OperationType.MERGE,this.source=a,this.path=b,this.children=c},fb.core.operation.Merge.prototype.operationForChild=function(a){if(this.path.isEmpty()){var b=this.children.subtree(new fb.core.util.Path(a));return b.isEmpty()?null:b.value?new fb.core.operation.Overwrite(this.source,fb.core.util.Path.Empty,b.value):new fb.core.operation.Merge(this.source,fb.core.util.Path.Empty,b)}return fb.core.util.assert(this.path.getFront()===a,"Can't get a merge for a child not on the path of the operation"),new fb.core.operation.Merge(this.source,this.path.popFront(),this.children)},goog.DEBUG&&(fb.core.operation.Merge.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}),goog.provide("fb.core.Operation"),goog.require("fb.core.operation.AckUserWrite"),goog.require("fb.core.operation.Merge"),goog.require("fb.core.operation.Overwrite"),goog.require("fb.core.operation.ListenComplete"),fb.core.OperationType={OVERWRITE:0,MERGE:1,ACK_USER_WRITE:2,LISTEN_COMPLETE:3},fb.core.Operation=function(){},fb.core.Operation.prototype.source,fb.core.Operation.prototype.type,fb.core.Operation.prototype.path,fb.core.Operation.prototype.operationForChild=goog.abstractMethod,fb.core.OperationSource=function(a,b,c,d){this.fromUser=a,this.fromServer=b,this.queryId=c,this.tagged=d,fb.core.util.assert(!d||b,"Tagged queries must be from server.")},fb.core.OperationSource.User=new fb.core.OperationSource(!0,!1,null,!1),fb.core.OperationSource.Server=new fb.core.OperationSource(!1,!0,null,!1),fb.core.OperationSource.forServerTaggedQuery=function(a){return new fb.core.OperationSource(!1,!0,a,!0)},goog.DEBUG&&(fb.core.OperationSource.prototype.toString=function(){return this.fromUser?"user":this.tagged?"server(queryID="+this.queryId+")":"server"}),goog.provide("fb.core.SyncTree"),goog.require("fb.core.Operation"),goog.require("fb.core.SyncPoint"),goog.require("fb.core.WriteTree"),fb.core.ListenProvider,fb.core.SyncTree=function(a){this.syncPointTree_=fb.core.util.ImmutableTree.Empty,this.pendingWriteTree_=new fb.core.WriteTree,this.tagToQueryMap_={},this.queryToTagMap_={},this.listenProvider_=a},fb.core.SyncTree.prototype.applyUserOverwrite=function(a,b,c,d){return this.pendingWriteTree_.addOverwrite(a,b,c,d),d?this.applyOperationToSyncPoints_(new fb.core.operation.Overwrite(fb.core.OperationSource.User,a,b)):[]},fb.core.SyncTree.prototype.applyUserMerge=function(a,b,c){this.pendingWriteTree_.addMerge(a,b,c);var d=fb.core.util.ImmutableTree.fromObject(b);return this.applyOperationToSyncPoints_(new fb.core.operation.Merge(fb.core.OperationSource.User,a,d))},fb.core.SyncTree.prototype.ackUserWrite=function(a,b){b=b||!1;var c=this.pendingWriteTree_.removeWrite(a);return null==c?[]:this.applyOperationToSyncPoints_(new fb.core.operation.AckUserWrite(c,b))},fb.core.SyncTree.prototype.applyServerOverwrite=function(a,b){return this.applyOperationToSyncPoints_(new fb.core.operation.Overwrite(fb.core.OperationSource.Server,a,b))},fb.core.SyncTree.prototype.applyServerMerge=function(a,b){var c=fb.core.util.ImmutableTree.fromObject(b);return this.applyOperationToSyncPoints_(new fb.core.operation.Merge(fb.core.OperationSource.Server,a,c))},fb.core.SyncTree.prototype.applyListenComplete=function(a){return this.applyOperationToSyncPoints_(new fb.core.operation.ListenComplete(fb.core.OperationSource.Server,a))},fb.core.SyncTree.prototype.applyTaggedQueryOverwrite=function(a,b,c){var d=this.queryKeyForTag_(c);if(null!=d){var e=this.parseQueryKey_(d),f=e.path,g=e.queryId,h=fb.core.util.Path.RelativePath(f,a),i=new fb.core.operation.Overwrite(fb.core.OperationSource.forServerTaggedQuery(g),h,b);return this.applyTaggedOperation_(f,g,i)}return[]},fb.core.SyncTree.prototype.applyTaggedQueryMerge=function(a,b,c){var d=this.queryKeyForTag_(c);if(d){var e=this.parseQueryKey_(d),f=e.path,g=e.queryId,h=fb.core.util.Path.RelativePath(f,a),i=fb.core.util.ImmutableTree.fromObject(b),j=new fb.core.operation.Merge(fb.core.OperationSource.forServerTaggedQuery(g),h,i);return this.applyTaggedOperation_(f,g,j)}return[]},fb.core.SyncTree.prototype.applyTaggedListenComplete=function(a,b){var c=this.queryKeyForTag_(b);if(c){var d=this.parseQueryKey_(c),e=d.path,f=d.queryId,g=fb.core.util.Path.RelativePath(e,a),h=new fb.core.operation.ListenComplete(fb.core.OperationSource.forServerTaggedQuery(f),g);return this.applyTaggedOperation_(e,f,h)}return[]},fb.core.SyncTree.prototype.addEventRegistration=function(a,b){var c=a.path,d=null,e=!1;this.syncPointTree_.foreachOnPathWhile(c,function(a,b){var f=fb.core.util.Path.RelativePath(a,c);return d=b.getCompleteServerCache(f),e=e||b.hasCompleteView(),!d});var f=this.syncPointTree_.get(c);f?(e=e||f.hasCompleteView(),d=d||f.getCompleteServerCache(fb.core.util.Path.Empty)):(f=new fb.core.SyncPoint,this.syncPointTree_=this.syncPointTree_.set(c,f));var g;if(null!=d)g=!0;else{g=!1,d=fb.core.snap.EMPTY_NODE;var h=this.syncPointTree_.subtree(c);h.foreachChild(function(a,b){var c=b.getCompleteServerCache(fb.core.util.Path.Empty);c&&(d=d.updateImmediateChild(a,c))})}var i=f.viewExistsForQuery(a);if(!i&&!a.getQueryParams().loadsAllData()){var j=this.makeQueryKey_(a);fb.core.util.assert(!goog.object.containsKey(this.queryToTagMap_,j),"View does not exist, but we have a tag");var k=fb.core.SyncTree.getNextQueryTag_();this.queryToTagMap_[j]=k,this.tagToQueryMap_["_"+k]=j}var l=this.pendingWriteTree_.childWrites(c),m=f.addEventRegistration(a,b,l,d,g);if(!i&&!e){var n=f.viewForQuery(a);m=m.concat(this.setupListener_(a,n))}return m},fb.core.SyncTree.prototype.removeEventRegistration=function(a,b,c){var d=a.path,e=this.syncPointTree_.get(d),f=[];if(e&&("default"===a.queryIdentifier()||e.viewExistsForQuery(a))){var g=e.removeEventRegistration(a,b,c);e.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(d));var h=g.removed;f=g.events;var i=-1!==goog.array.findIndex(h,function(a){return a.getQueryParams().loadsAllData()}),j=this.syncPointTree_.findOnPath(d,function(a,b){return b.hasCompleteView()});if(i&&!j){var k=this.syncPointTree_.subtree(d);if(!k.isEmpty())for(var l=this.collectDistinctViewsForSubTree_(k),m=0;m<l.length;++m){var n=l[m],o=n.getQuery(),p=this.createListenerForView_(n);this.listenProvider_.startListening(o,this.tagForQuery_(o),p.hashFn,p.onComplete)}}if(!j&&h.length>0&&!c)if(i){var q=null;this.listenProvider_.stopListening(a,q)}else{var r=this;goog.array.forEach(h,function(a){var b=(a.queryIdentifier(),r.queryToTagMap_[r.makeQueryKey_(a)]);r.listenProvider_.stopListening(a,b)})}this.removeTags_(h)}return f},fb.core.SyncTree.prototype.calcCompleteEventCache=function(a,b){var c=!0,d=this.pendingWriteTree_,e=this.syncPointTree_.findOnPath(a,function(b,c){var d=fb.core.util.Path.RelativePath(b,a),e=c.getCompleteServerCache(d);return e?e:void 0});return d.calcCompleteEventCache(a,e,b,c)},fb.core.SyncTree.prototype.collectDistinctViewsForSubTree_=function(a){return a.fold(function(a,b,c){if(b&&b.hasCompleteView()){var d=b.getCompleteView();return[d]}var e=[];return b&&(e=b.getQueryViews()),goog.object.forEach(c,function(a){e=e.concat(a)}),e})},fb.core.SyncTree.prototype.removeTags_=function(a){for(var b=0;b<a.length;++b){var c=a[b];if(!c.getQueryParams().loadsAllData()){var d=this.makeQueryKey_(c),e=this.queryToTagMap_[d];delete this.queryToTagMap_[d],delete this.tagToQueryMap_["_"+e]}}},fb.core.SyncTree.prototype.warnOnNoIndex_=function(a,b){if(a&&"object"==typeof a&&fb.util.obj.contains(a,"w")){var c=fb.util.obj.get(a,"w");if(goog.isArray(c)&&goog.array.contains(c,"no_index")){var d='".indexOn": "'+b.getQueryParams().getIndex().toString()+'"',e=b.path.toString();fb.core.util.warn("Using an unspecified index. Consider adding "+d+" at "+e+" to your security rules for better performance")}}},fb.core.SyncTree.prototype.setupListener_=function(a,b){var c=a.path,d=this.tagForQuery_(a),e=this.createListenerForView_(b),f=this.listenProvider_.startListening(a,d,e.hashFn,e.onComplete),g=this.syncPointTree_.subtree(c);if(d)fb.core.util.assert(!g.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var h=g.fold(function(a,b,c){if(!a.isEmpty()&&b&&b.hasCompleteView())return[b.getCompleteView().getQuery()];var d=[];return b&&(d=d.concat(goog.array.map(b.getQueryViews(),function(a){return a.getQuery()}))),goog.object.forEach(c,function(a){d=d.concat(a)}),d}),i=0;i<h.length;++i){var j=h[i];this.listenProvider_.stopListening(j,this.tagForQuery_(j))}return f},fb.core.SyncTree.prototype.createListenerForView_=function(a){var b=this,c=a.getQuery(),d=this.tagForQuery_(c);return{hashFn:function(){var b=a.getServerCache()||fb.core.snap.EMPTY_NODE;return b.hash()},onComplete:function(a,e){if("ok"===a)return b.warnOnNoIndex_(e,c),d?b.applyTaggedListenComplete(c.path,d):b.applyListenComplete(c.path);var f=fb.core.util.errorForServerCode(a);return b.removeEventRegistration(c,null,f)}}},fb.core.SyncTree.prototype.makeQueryKey_=function(a){return a.path.toString()+"$"+a.queryIdentifier()},fb.core.SyncTree.prototype.parseQueryKey_=function(a){var b=a.indexOf("$");return fb.core.util.assert(-1!==b&&b<a.length-1,"Bad queryKey."),{queryId:a.substr(b+1),path:new fb.core.util.Path(a.substr(0,b))}},fb.core.SyncTree.prototype.queryKeyForTag_=function(a){return goog.object.get(this.tagToQueryMap_,"_"+a)},fb.core.SyncTree.prototype.tagForQuery_=function(a){var b=this.makeQueryKey_(a);return fb.util.obj.get(this.queryToTagMap_,b)},fb.core.SyncTree.nextQueryTag_=1,fb.core.SyncTree.getNextQueryTag_=function(){return fb.core.SyncTree.nextQueryTag_++},fb.core.SyncTree.prototype.applyTaggedOperation_=function(a,b,c){var d=this.syncPointTree_.get(a);fb.core.util.assert(d,"Missing sync point for query tag that we're tracking");var e=this.pendingWriteTree_.childWrites(a);return d.applyOperation(c,e,null)},fb.core.SyncTree.prototype.applyOperationToSyncPoints_=function(a){return this.applyOperationHelper_(a,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(fb.core.util.Path.Empty))},fb.core.SyncTree.prototype.applyOperationHelper_=function(a,b,c,d){if(a.path.isEmpty())return this.applyOperationDescendantsHelper_(a,b,c,d);var e=b.get(fb.core.util.Path.Empty);null==c&&null!=e&&(c=e.getCompleteServerCache(fb.core.util.Path.Empty));var f=[],g=a.path.getFront(),h=a.operationForChild(g),i=b.children.get(g);if(i&&h){var j=c?c.getImmediateChild(g):null,k=d.child(g);f=f.concat(this.applyOperationHelper_(h,i,j,k))}return e&&(f=f.concat(e.applyOperation(a,d,c))),f},fb.core.SyncTree.prototype.applyOperationDescendantsHelper_=function(a,b,c,d){var e=b.get(fb.core.util.Path.Empty);null==c&&null!=e&&(c=e.getCompleteServerCache(fb.core.util.Path.Empty));var f=[],g=this;return b.children.inorderTraversal(function(b,e){var h=c?c.getImmediateChild(b):null,i=d.child(b),j=a.operationForChild(b);j&&(f=f.concat(g.applyOperationDescendantsHelper_(j,e,h,i)))}),e&&(f=f.concat(e.applyOperation(a,d,c))),f},goog.provide("fb.core.Repo"),goog.require("fb.api.DataSnapshot"),goog.require("fb.core.PersistentConnection"),goog.require("fb.core.SnapshotHolder"),goog.require("fb.core.SparseSnapshotTree"),goog.require("fb.core.SyncTree"),goog.require("fb.core.stats.StatsCollection"),goog.require("fb.core.stats.StatsListener"),goog.require("fb.core.stats.StatsManager"),goog.require("fb.core.stats.StatsReporter"),goog.require("fb.core.util.ServerValues"),goog.require("fb.core.util.Tree"),goog.require("fb.core.view.EventQueue"),goog.require("fb.util.json"),goog.require("fb.util.jwt"),goog.require("goog.string"),goog.require("fb.login.AuthenticationManager"),fb.core.Repo=function(a){this.repoInfo_=a,this.stats_=fb.core.stats.StatsManager.getCollection(a),this.eventQueue_=new fb.core.view.EventQueue,this.nextWriteId_=1,this.connection_=new fb.core.PersistentConnection(this.repoInfo_,goog.bind(this.onDataUpdate_,this),goog.bind(this.onConnectStatus_,this),goog.bind(this.onServerInfoUpdate_,this)),this.statsReporter_=fb.core.stats.StatsManager.getOrCreateReporter(a,goog.bind(function(){return new fb.core.stats.StatsReporter(this.stats_,this.connection_)},this)),this.transactions_init_(),this.infoData_=new fb.core.SnapshotHolder;var b=this;this.infoSyncTree_=new fb.core.SyncTree({startListening:function(a,c,d,e){var f=[],g=b.infoData_.getNode(a.path);return g.isEmpty()||(f=b.infoSyncTree_.applyServerOverwrite(a.path,g),setTimeout(function(){e("ok")},0)),f},stopListening:goog.nullFunction}),this.updateInfo_("connected",!1),this.onDisconnect_=new fb.core.SparseSnapshotTree,this.auth=new fb.login.AuthenticationManager(a,goog.bind(this.connection_.auth,this.connection_),goog.bind(this.connection_.unauth,this.connection_),goog.bind(this.onAuthStatus_,this)),this.dataUpdateCount=0,this.interceptServerDataCallback_=null,this.serverSyncTree_=new fb.core.SyncTree({startListening:function(a,c,d,e){return b.connection_.listen(a,d,c,function(c,d){var f=e(c,d);b.eventQueue_.raiseEventsForChangedPath(a.path,f)}),[]},stopListening:function(a,c){b.connection_.unlisten(a,c)}})},fb.core.Repo.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},fb.core.Repo.prototype.name=function(){return this.repoInfo_.namespace},fb.core.Repo.prototype.serverTime=function(){var a=this.infoData_.getNode(new fb.core.util.Path(".info/serverTimeOffset")),b=a.val()||0;return(new Date).getTime()+b},fb.core.Repo.prototype.generateServerValues=function(){return fb.core.util.ServerValues.generateWithValues({timestamp:this.serverTime()})},fb.core.Repo.prototype.onDataUpdate_=function(a,b,c,d){this.dataUpdateCount++;var e=new fb.core.util.Path(a);b=this.interceptServerDataCallback_?this.interceptServerDataCallback_(a,b):b;var f=[];if(d)if(c){var g=goog.object.map(b,function(a){return fb.core.snap.NodeFromJSON(a)});f=this.serverSyncTree_.applyTaggedQueryMerge(e,g,d)}else{var h=fb.core.snap.NodeFromJSON(b);f=this.serverSyncTree_.applyTaggedQueryOverwrite(e,h,d)}else if(c){var i=goog.object.map(b,function(a){return fb.core.snap.NodeFromJSON(a)});f=this.serverSyncTree_.applyServerMerge(e,i)}else{var j=fb.core.snap.NodeFromJSON(b);f=this.serverSyncTree_.applyServerOverwrite(e,j)}var k=e;f.length>0&&(k=this.rerunTransactions_(e)),this.eventQueue_.raiseEventsForChangedPath(k,f)},fb.core.Repo.prototype.interceptServerData_=function(a){this.interceptServerDataCallback_=a},fb.core.Repo.prototype.onConnectStatus_=function(a){this.updateInfo_("connected",a),a===!1&&this.runOnDisconnectEvents_()},fb.core.Repo.prototype.onServerInfoUpdate_=function(a){var b=this;fb.core.util.each(a,function(a,c){b.updateInfo_(c,a)})},fb.core.Repo.prototype.onAuthStatus_=function(a){this.updateInfo_("authenticated",a)},fb.core.Repo.prototype.updateInfo_=function(a,b){var c=new fb.core.util.Path("/.info/"+a),d=fb.core.snap.NodeFromJSON(b);this.infoData_.updateSnapshot(c,d);var e=this.infoSyncTree_.applyServerOverwrite(c,d);this.eventQueue_.raiseEventsForChangedPath(c,e)},fb.core.Repo.prototype.getNextWriteId_=function(){return this.nextWriteId_++},fb.core.Repo.prototype.setWithPriority=function(a,b,c,d){this.log_("set",{path:a.toString(),value:b,priority:c});var e=this.generateServerValues(),f=fb.core.snap.NodeFromJSON(b,c),g=fb.core.util.ServerValues.resolveDeferredValueSnapshot(f,e),h=this.getNextWriteId_(),i=this.serverSyncTree_.applyUserOverwrite(a,g,h,!0);this.eventQueue_.queueEvents(i);var j=this;this.connection_.put(a.toString(),f.val(!0),function(b,c){var e="ok"===b;e||fb.core.util.warn("set at "+a+" failed: "+b);var f=j.serverSyncTree_.ackUserWrite(h,!e);j.eventQueue_.raiseEventsForChangedPath(a,f),j.callOnCompleteCallback(d,b,c)});var k=this.abortTransactions_(a);this.rerunTransactions_(k),this.eventQueue_.raiseEventsForChangedPath(k,[])},fb.core.Repo.prototype.update=function(a,b,c){this.log_("update",{path:a.toString(),value:b});var d=!0,e=this.generateServerValues(),f={};if(goog.object.forEach(b,function(a,b){d=!1;var c=fb.core.snap.NodeFromJSON(a);f[b]=fb.core.util.ServerValues.resolveDeferredValueSnapshot(c,e)}),d)fb.core.util.log("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(c,"ok");else{var g=this.getNextWriteId_(),h=this.serverSyncTree_.applyUserMerge(a,f,g);this.eventQueue_.queueEvents(h);var i=this;this.connection_.merge(a.toString(),b,function(b,d){fb.core.util.assert("ok"===b||"permission_denied"===b,"merge at "+a+" failed.");var e="ok"===b;e||fb.core.util.warn("update at "+a+" failed: "+b);var f=i.serverSyncTree_.ackUserWrite(g,!e),h=a;f.length>0&&(h=i.rerunTransactions_(a)),i.eventQueue_.raiseEventsForChangedPath(h,f),i.callOnCompleteCallback(c,b,d)});var j=this.abortTransactions_(a);this.rerunTransactions_(j),this.eventQueue_.raiseEventsForChangedPath(a,[])}},fb.core.Repo.prototype.runOnDisconnectEvents_=function(){this.log_("onDisconnectEvents");var a=this,b=this.generateServerValues(),c=fb.core.util.ServerValues.resolveDeferredValueTree(this.onDisconnect_,b),d=[];c.forEachTree(fb.core.util.Path.Empty,function(b,c){d=d.concat(a.serverSyncTree_.applyServerOverwrite(b,c));var e=a.abortTransactions_(b);a.rerunTransactions_(e)}),this.onDisconnect_=new fb.core.SparseSnapshotTree,this.eventQueue_.raiseEventsForChangedPath(fb.core.util.Path.Empty,d)},fb.core.Repo.prototype.onDisconnectCancel=function(a,b){var c=this;this.connection_.onDisconnectCancel(a.toString(),function(d,e){"ok"===d&&c.onDisconnect_.forget(a),c.callOnCompleteCallback(b,d,e)})},fb.core.Repo.prototype.onDisconnectSet=function(a,b,c){var d=this,e=fb.core.snap.NodeFromJSON(b);this.connection_.onDisconnectPut(a.toString(),e.val(!0),function(b,f){"ok"===b&&d.onDisconnect_.remember(a,e),d.callOnCompleteCallback(c,b,f)})},fb.core.Repo.prototype.onDisconnectSetWithPriority=function(a,b,c,d){var e=this,f=fb.core.snap.NodeFromJSON(b,c);this.connection_.onDisconnectPut(a.toString(),f.val(!0),function(b,c){"ok"===b&&e.onDisconnect_.remember(a,f),e.callOnCompleteCallback(d,b,c)})},fb.core.Repo.prototype.onDisconnectUpdate=function(a,b,c){var d=!0;for(var e in b)d=!1;if(d)return fb.core.util.log("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(c,"ok");var f=this;this.connection_.onDisconnectMerge(a.toString(),b,function(d,e){if("ok"===d)for(var g in b){var h=fb.core.snap.NodeFromJSON(b[g]);f.onDisconnect_.remember(a.child(g),h)}f.callOnCompleteCallback(c,d,e)})},fb.core.Repo.prototype.logOnDisconnectDeprecatedSignature=function(){this.stats_.incrementCounter("deprecated_on_disconnect"),this.statsReporter_.includeStat("deprecated_on_disconnect")},fb.core.Repo.prototype.addEventCallbackForQuery=function(a,b){var c;c=".info"===a.path.getFront()?this.infoSyncTree_.addEventRegistration(a,b):this.serverSyncTree_.addEventRegistration(a,b),this.eventQueue_.raiseEventsAtPath(a.path,c)},fb.core.Repo.prototype.removeEventCallbackForQuery=function(a,b){var c;c=".info"===a.path.getFront()?this.infoSyncTree_.removeEventRegistration(a,b):this.serverSyncTree_.removeEventRegistration(a,b),this.eventQueue_.raiseEventsAtPath(a.path,c)},fb.core.Repo.prototype.interrupt=function(){this.connection_.interrupt()},fb.core.Repo.prototype.resume=function(){this.connection_.resume()},fb.core.Repo.prototype.stats=function(a){if("undefined"!=typeof console){var b;a?(this.statsListener_||(this.statsListener_=new fb.core.stats.StatsListener(this.stats_)),b=this.statsListener_.get()):b=this.stats_.get();var c=goog.array.reduce(goog.object.getKeys(b),function(a,b){return Math.max(b.length,a)},0);for(var d in b){for(var e=b[d],f=d.length;c+2>f;f++)d+=" ";console.log(d+e)}}},fb.core.Repo.prototype.statsIncrementCounter=function(a){this.stats_.incrementCounter(a),this.statsReporter_.includeStat(a)},fb.core.Repo.prototype.log_=function(){fb.core.util.log("r:"+this.connection_.id+":",arguments)},fb.core.Repo.prototype.callOnCompleteCallback=function(a,b,c){a&&fb.core.util.exceptionGuard(function(){if("ok"==b)a(null);else{var d=(b||"error").toUpperCase(),e=d;c&&(e+=": "+c);var f=new Error(e);f.code=d,a(f)}})},goog.provide("fb.core.Repo_transaction"),goog.require("fb.core.Repo"),goog.require("fb.core.snap.PriorityIndex"),fb.core.TransactionStatus={RUN:1,SENT:2,COMPLETED:3,SENT_NEEDS_ABORT:4,NEEDS_ABORT:5},fb.core.Repo.MAX_TRANSACTION_RETRIES_=25,fb.core.Transaction,fb.core.Repo.prototype.transactions_init_=function(){this.transactionQueueTree_=new fb.core.util.Tree},fb.core.Repo.prototype.startTransaction=function(a,b,c,d){this.log_("transaction on "+a);var e=function(){},f=new Firebase(this,a);f.on("value",e);var g=function(){f.off("value",e)},h={path:a,update:b,onComplete:c,status:null,order:fb.core.util.LUIDGenerator(),applyLocally:d,retryCount:0,unwatcher:g,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},i=this.getLatestState_(a);h.currentInputSnapshot=i;var j=h.update(i.val());if(goog.isDef(j)){fb.core.util.validation.validateFirebaseData("transaction failed: Data returned ",j),h.status=fb.core.TransactionStatus.RUN;var k=this.transactionQueueTree_.subTree(a),l=k.getValue()||[];l.push(h),k.setValue(l);var m;if("object"==typeof j&&null!==j&&fb.util.obj.contains(j,".priority"))m=fb.util.obj.get(j,".priority"),fb.core.util.assert(fb.core.util.validation.isValidPriority(m),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{var n=this.serverSyncTree_.calcCompleteEventCache(a)||fb.core.snap.EMPTY_NODE;m=n.getPriority().val()}m=m;var o=this.generateServerValues(),p=fb.core.snap.NodeFromJSON(j,m),q=fb.core.util.ServerValues.resolveDeferredValueSnapshot(p,o);h.currentOutputSnapshotRaw=p,h.currentOutputSnapshotResolved=q,h.currentWriteId=this.getNextWriteId_();var r=this.serverSyncTree_.applyUserOverwrite(a,q,h.currentWriteId,h.applyLocally);this.eventQueue_.raiseEventsForChangedPath(a,r),this.sendReadyTransactions_()}else if(h.unwatcher(),h.currentOutputSnapshotRaw=null,h.currentOutputSnapshotResolved=null,h.onComplete){var s=new fb.api.DataSnapshot(h.currentInputSnapshot,new Firebase(this,h.path),fb.core.snap.PriorityIndex);h.onComplete(null,!1,s)}},fb.core.Repo.prototype.getLatestState_=function(a,b){return this.serverSyncTree_.calcCompleteEventCache(a,b)||fb.core.snap.EMPTY_NODE},fb.core.Repo.prototype.sendReadyTransactions_=function(a){var b=a||this.transactionQueueTree_;if(a||this.pruneCompletedTransactionsBelowNode_(b),null!==b.getValue()){var c=this.buildTransactionQueue_(b);fb.core.util.assert(c.length>0,"Sending zero length transaction queue");var d=goog.array.every(c,function(a){return a.status===fb.core.TransactionStatus.RUN});d&&this.sendTransactionQueue_(b.path(),c)}else if(b.hasChildren()){var e=this;b.forEachChild(function(a){e.sendReadyTransactions_(a)})}},fb.core.Repo.prototype.sendTransactionQueue_=function(a,b){for(var c=goog.array.map(b,function(a){return a.currentWriteId}),d=this.getLatestState_(a,c),e=d,f=d.hash(),g=0;g<b.length;g++){var h=b[g];fb.core.util.assert(h.status===fb.core.TransactionStatus.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=fb.core.TransactionStatus.SENT,h.retryCount++;var i=fb.core.util.Path.RelativePath(a,h.path);e=e.updateChild(i,h.currentOutputSnapshotRaw)}var j=e.val(!0),k=a,l=this;this.connection_.put(k.toString(),j,function(c){l.log_("transaction put response",{path:k.toString(),status:c});var d=[];if("ok"===c){var e=[];for(g=0;g<b.length;g++){if(b[g].status=fb.core.TransactionStatus.COMPLETED,d=d.concat(l.serverSyncTree_.ackUserWrite(b[g].currentWriteId)),b[g].onComplete){var f=b[g].currentOutputSnapshotResolved,h=new Firebase(l,b[g].path),i=new fb.api.DataSnapshot(f,h,fb.core.snap.PriorityIndex);e.push(goog.bind(b[g].onComplete,null,null,!0,i))}b[g].unwatcher()}for(l.pruneCompletedTransactionsBelowNode_(l.transactionQueueTree_.subTree(a)),l.sendReadyTransactions_(),l.eventQueue_.raiseEventsForChangedPath(a,d),g=0;g<e.length;g++)fb.core.util.exceptionGuard(e[g])}else{if("datastale"===c)for(g=0;g<b.length;g++)b[g].status=b[g].status===fb.core.TransactionStatus.SENT_NEEDS_ABORT?fb.core.TransactionStatus.NEEDS_ABORT:fb.core.TransactionStatus.RUN;else for(fb.core.util.warn("transaction at "+k.toString()+" failed: "+c),g=0;g<b.length;g++)b[g].status=fb.core.TransactionStatus.NEEDS_ABORT,b[g].abortReason=c;l.rerunTransactions_(a)}},f)},fb.core.Repo.prototype.rerunTransactions_=function(a){var b=this.getAncestorTransactionNode_(a),c=b.path(),d=this.buildTransactionQueue_(b);return this.rerunTransactionQueue_(d,c),c},fb.core.Repo.prototype.rerunTransactionQueue_=function(a,b){if(0!==a.length){for(var c=[],d=[],e=goog.array.map(a,function(a){return a.currentWriteId}),f=0;f<a.length;f++){var g,h=a[f],i=fb.core.util.Path.RelativePath(b,h.path),j=!1;if(fb.core.util.assert(null!==i,"rerunTransactionsUnderNode_: relativePath should not be null."),h.status===fb.core.TransactionStatus.NEEDS_ABORT)j=!0,g=h.abortReason,d=d.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0));else if(h.status===fb.core.TransactionStatus.RUN)if(h.retryCount>=fb.core.Repo.MAX_TRANSACTION_RETRIES_)j=!0,g="maxretry",d=d.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0));else{var k=this.getLatestState_(h.path,e);h.currentInputSnapshot=k;var l=a[f].update(k.val());if(goog.isDef(l)){fb.core.util.validation.validateFirebaseData("transaction failed: Data returned ",l);var m=fb.core.snap.NodeFromJSON(l),n="object"==typeof l&&null!=l&&fb.util.obj.contains(l,".priority");n||(m=m.updatePriority(k.getPriority()));var o=h.currentWriteId,p=this.generateServerValues(),q=fb.core.util.ServerValues.resolveDeferredValueSnapshot(m,p);h.currentOutputSnapshotRaw=m,h.currentOutputSnapshotResolved=q,h.currentWriteId=this.getNextWriteId_(),goog.array.remove(e,o),d=d.concat(this.serverSyncTree_.applyUserOverwrite(h.path,q,h.currentWriteId,h.applyLocally)),d=d.concat(this.serverSyncTree_.ackUserWrite(o,!0))}else j=!0,g="nodata",d=d.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(b,d),d=[],j&&(a[f].status=fb.core.TransactionStatus.COMPLETED,function(a){setTimeout(a,Math.floor(0))}(a[f].unwatcher),a[f].onComplete))if("nodata"===g){var r=new Firebase(this,a[f].path),s=a[f].currentInputSnapshot,t=new fb.api.DataSnapshot(s,r,fb.core.snap.PriorityIndex);c.push(goog.bind(a[f].onComplete,null,null,!1,t))}else c.push(goog.bind(a[f].onComplete,null,new Error(g),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),f=0;f<c.length;f++)fb.core.util.exceptionGuard(c[f]);this.sendReadyTransactions_()}},fb.core.Repo.prototype.getAncestorTransactionNode_=function(a){for(var b,c=this.transactionQueueTree_;null!==(b=a.getFront())&&null===c.getValue();)c=c.subTree(b),a=a.popFront();return c},fb.core.Repo.prototype.buildTransactionQueue_=function(a){var b=[];return this.aggregateTransactionQueuesForNode_(a,b),b.sort(function(a,b){return a.order-b.order}),b},fb.core.Repo.prototype.aggregateTransactionQueuesForNode_=function(a,b){var c=a.getValue();if(null!==c)for(var d=0;d<c.length;d++)b.push(c[d]);var e=this;a.forEachChild(function(a){e.aggregateTransactionQueuesForNode_(a,b)})},fb.core.Repo.prototype.pruneCompletedTransactionsBelowNode_=function(a){var b=a.getValue();if(b){for(var c=0,d=0;d<b.length;d++)b[d].status!==fb.core.TransactionStatus.COMPLETED&&(b[c]=b[d],c++);b.length=c,a.setValue(b.length>0?b:null)}var e=this;a.forEachChild(function(a){e.pruneCompletedTransactionsBelowNode_(a)})},fb.core.Repo.prototype.abortTransactions_=function(a){var b=this.getAncestorTransactionNode_(a).path(),c=this.transactionQueueTree_.subTree(a),d=this;return c.forEachAncestor(function(a){d.abortTransactionsOnNode_(a)}),this.abortTransactionsOnNode_(c),c.forEachDescendant(function(a){d.abortTransactionsOnNode_(a)
}),b},fb.core.Repo.prototype.abortTransactionsOnNode_=function(a){var b=a.getValue();if(null!==b){for(var c=[],d=[],e=-1,f=0;f<b.length;f++)if(b[f].status===fb.core.TransactionStatus.SENT_NEEDS_ABORT);else if(b[f].status===fb.core.TransactionStatus.SENT)fb.core.util.assert(e===f-1,"All SENT items should be at beginning of queue."),e=f,b[f].status=fb.core.TransactionStatus.SENT_NEEDS_ABORT,b[f].abortReason="set";else if(fb.core.util.assert(b[f].status===fb.core.TransactionStatus.RUN,"Unexpected transaction status in abort"),b[f].unwatcher(),d=d.concat(this.serverSyncTree_.ackUserWrite(b[f].currentWriteId,!0)),b[f].onComplete){var g=null;c.push(goog.bind(b[f].onComplete,null,new Error("set"),!1,g))}for(-1===e?a.setValue(null):b.length=e+1,this.eventQueue_.raiseEventsForChangedPath(a.path(),d),f=0;f<c.length;f++)fb.core.util.exceptionGuard(c[f])}},goog.provide("fb.core.RepoManager"),goog.require("fb.core.Repo"),goog.require("fb.core.Repo_transaction"),goog.require("fb.util.obj"),fb.core.RepoManager=function(){this.repos_={}},goog.addSingletonGetter(fb.core.RepoManager),fb.core.RepoManager.prototype.interrupt=function(){for(var a in this.repos_)this.repos_[a].interrupt()},goog.exportProperty(fb.core.RepoManager.prototype,"interrupt",fb.core.RepoManager.prototype.interrupt),fb.core.RepoManager.prototype.resume=function(){for(var a in this.repos_)this.repos_[a].resume()},goog.exportProperty(fb.core.RepoManager.prototype,"resume",fb.core.RepoManager.prototype.resume),fb.core.RepoManager.prototype.getRepo=function(a){var b=a.toString(),c=fb.util.obj.get(this.repos_,b);return c||(c=new fb.core.Repo(a),this.repos_[b]=c),c},goog.provide("fb.login.transports.PopupReceiver"),goog.require("fb.login.Constants"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util.json"),fb.login.transports.PopupReceiver=function(a){var b=this;if(this.cb=a,this.targetOrigin="*",fb.login.util.environment.isModernIE()?this.messageTarget=this.inboundTarget=fb.login.transports.util.findRelay():(this.messageTarget=window.opener,this.inboundTarget=window),!b.messageTarget)throw"Unable to find relay frame";fb.login.transports.util.addListener(this.inboundTarget,"message",goog.bind(this.onMessage_,this)),fb.login.transports.util.addListener(this.inboundTarget,"message",goog.bind(this.onDie_,this));try{this.doPost_({a:"ready"})}catch(c){fb.login.transports.util.addListener(this.messageTarget,"load",function(){b.doPost_({a:"ready"})})}fb.login.transports.util.addListener(window,"unload",goog.bind(this.onUnload_,this))},fb.login.transports.PopupReceiver.prototype.doPost_=function(a){a=fb.util.json.stringify(a),fb.login.util.environment.isModernIE()?this.messageTarget.doPost(a,this.targetOrigin):this.messageTarget.postMessage(a,this.targetOrigin)},fb.login.transports.PopupReceiver.prototype.onMessage_=function(a){var b,c=this;try{b=fb.util.json.eval(a.data)}catch(d){}b&&"request"===b.a&&(fb.login.transports.util.removeListener(window,"message",this.onMessage_),this.targetOrigin=a.origin,this.cb&&setTimeout(function(){c.cb(c.targetOrigin,b.d,function(a,b){c.autoClose=!b,c.cb=void 0,c.doPost_({a:"response",d:a,forceKeepWindowOpen:b})})},0))},fb.login.transports.PopupReceiver.prototype.onUnload_=function(){try{fb.login.transports.util.removeListener(this.inboundTarget,"message",this.onDie_)}catch(a){}this.cb&&(this.doPost_({a:"error",d:"unknown closed window"}),this.cb=void 0);try{window.close()}catch(a){}},fb.login.transports.PopupReceiver.prototype.onDie_=function(a){if(this.autoClose&&a.data===fb.login.Constants.POPUP_CLOSE_CMD)try{window.close()}catch(b){}},goog.provide("fb.api.INTERNAL"),goog.require("fb.core.PersistentConnection"),goog.require("fb.realtime.Connection"),goog.require("fb.login.transports.PopupReceiver"),goog.require("fb.login.Constants"),fb.api.INTERNAL={},fb.api.INTERNAL.forceLongPolling=function(){fb.realtime.WebSocketConnection.forceDisallow(),fb.realtime.BrowserPollConnection.forceAllow()},goog.exportProperty(fb.api.INTERNAL,"forceLongPolling",fb.api.INTERNAL.forceLongPolling),fb.api.INTERNAL.forceWebSockets=function(){fb.realtime.BrowserPollConnection.forceDisallow()},goog.exportProperty(fb.api.INTERNAL,"forceWebSockets",fb.api.INTERNAL.forceWebSockets),fb.api.INTERNAL.setSecurityDebugCallback=function(a,b){a.repo.connection_.securityDebugCallback_=b},goog.exportProperty(fb.api.INTERNAL,"setSecurityDebugCallback",fb.api.INTERNAL.setSecurityDebugCallback),fb.api.INTERNAL.stats=function(a,b){a.repo.stats(b)},goog.exportProperty(fb.api.INTERNAL,"stats",fb.api.INTERNAL.stats),fb.api.INTERNAL.statsIncrementCounter=function(a,b){a.repo.statsIncrementCounter(b)},goog.exportProperty(fb.api.INTERNAL,"statsIncrementCounter",fb.api.INTERNAL.statsIncrementCounter),fb.api.INTERNAL.dataUpdateCount=function(a){return a.repo.dataUpdateCount},goog.exportProperty(fb.api.INTERNAL,"dataUpdateCount",fb.api.INTERNAL.dataUpdateCount),fb.api.INTERNAL.interceptServerData=function(a,b){return a.repo.interceptServerData_(b)},goog.exportProperty(fb.api.INTERNAL,"interceptServerData",fb.api.INTERNAL.interceptServerData),fb.api.INTERNAL.onLoginPopupOpen=function(a){new fb.login.transports.PopupReceiver(a)},goog.exportProperty(fb.api.INTERNAL,"onPopupOpen",fb.api.INTERNAL.onLoginPopupOpen),fb.api.INTERNAL.setAuthenticationServer=function(a){fb.login.Constants.SERVER_HOST=a},goog.exportProperty(fb.api.INTERNAL,"setAuthenticationServer",fb.api.INTERNAL.setAuthenticationServer),goog.provide("fb.api.OnDisconnect"),goog.require("fb.constants"),goog.require("fb.core.Repo"),goog.require("fb.core.util.validation"),goog.require("fb.util.validation"),fb.api.OnDisconnect=function(a,b){this.repo_=a,this.path_=b},fb.api.OnDisconnect.prototype.cancel=function(a){fb.util.validation.validateArgCount("Firebase.onDisconnect().cancel",0,1,arguments.length),fb.util.validation.validateCallback("Firebase.onDisconnect().cancel",1,a,!0),this.repo_.onDisconnectCancel(this.path_,a||null)},goog.exportProperty(fb.api.OnDisconnect.prototype,"cancel",fb.api.OnDisconnect.prototype.cancel),fb.api.OnDisconnect.prototype.remove=function(a){fb.util.validation.validateArgCount("Firebase.onDisconnect().remove",0,1,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().remove",this.path_),fb.util.validation.validateCallback("Firebase.onDisconnect().remove",1,a,!0),this.repo_.onDisconnectSet(this.path_,null,a)},goog.exportProperty(fb.api.OnDisconnect.prototype,"remove",fb.api.OnDisconnect.prototype.remove),fb.api.OnDisconnect.prototype.set=function(a,b){fb.util.validation.validateArgCount("Firebase.onDisconnect().set",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().set",this.path_),fb.core.util.validation.validateFirebaseDataArg("Firebase.onDisconnect().set",1,a,!1),fb.util.validation.validateCallback("Firebase.onDisconnect().set",2,b,!0),this.repo_.onDisconnectSet(this.path_,a,b)},goog.exportProperty(fb.api.OnDisconnect.prototype,"set",fb.api.OnDisconnect.prototype.set),fb.api.OnDisconnect.prototype.setWithPriority=function(a,b,c){fb.util.validation.validateArgCount("Firebase.onDisconnect().setWithPriority",2,3,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().setWithPriority",this.path_),fb.core.util.validation.validateFirebaseDataArg("Firebase.onDisconnect().setWithPriority",1,a,!1),fb.core.util.validation.validatePriority("Firebase.onDisconnect().setWithPriority",2,b,!1),fb.util.validation.validateCallback("Firebase.onDisconnect().setWithPriority",3,c,!0),this.repo_.onDisconnectSetWithPriority(this.path_,a,b,c)},goog.exportProperty(fb.api.OnDisconnect.prototype,"setWithPriority",fb.api.OnDisconnect.prototype.setWithPriority),fb.api.OnDisconnect.prototype.update=function(a,b){if(fb.util.validation.validateArgCount("Firebase.onDisconnect().update",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().update",this.path_),goog.isArray(a)){for(var c={},d=0;d<a.length;++d)c[""+d]=a[d];a=c,fb.core.util.warn("Passing an Array to Firebase.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}fb.core.util.validation.validateFirebaseMergeDataArg("Firebase.onDisconnect().update",1,a,!1),fb.util.validation.validateCallback("Firebase.onDisconnect().update",2,b,!0),this.repo_.onDisconnectUpdate(this.path_,a,b)},goog.exportProperty(fb.api.OnDisconnect.prototype,"update",fb.api.OnDisconnect.prototype.update),goog.provide("fb.api.TEST_ACCESS"),fb.api.TEST_ACCESS.DataConnection=fb.core.PersistentConnection,goog.exportProperty(fb.api.TEST_ACCESS,"DataConnection",fb.api.TEST_ACCESS.DataConnection),fb.core.PersistentConnection.prototype.simpleListen=function(a,b){this.sendRequest("q",{p:a},b)},goog.exportProperty(fb.api.TEST_ACCESS.DataConnection.prototype,"simpleListen",fb.api.TEST_ACCESS.DataConnection.prototype.simpleListen),fb.core.PersistentConnection.prototype.echo=function(a,b){this.sendRequest("echo",{d:a},b)},goog.exportProperty(fb.api.TEST_ACCESS.DataConnection.prototype,"echo",fb.api.TEST_ACCESS.DataConnection.prototype.echo),goog.exportProperty(fb.core.PersistentConnection.prototype,"interrupt",fb.core.PersistentConnection.prototype.interrupt),fb.api.TEST_ACCESS.RealTimeConnection=fb.realtime.Connection,goog.exportProperty(fb.api.TEST_ACCESS,"RealTimeConnection",fb.api.TEST_ACCESS.RealTimeConnection),goog.exportProperty(fb.realtime.Connection.prototype,"sendRequest",fb.realtime.Connection.prototype.sendRequest),goog.exportProperty(fb.realtime.Connection.prototype,"close",fb.realtime.Connection.prototype.close),fb.api.TEST_ACCESS.hijackHash=function(a){var b=fb.core.PersistentConnection.prototype.put;return fb.core.PersistentConnection.prototype.put=function(c,d,e,f){goog.isDef(f)&&(f=a()),b.call(this,c,d,e,f)},function(){fb.core.PersistentConnection.prototype.put=b}},goog.exportProperty(fb.api.TEST_ACCESS,"hijackHash",fb.api.TEST_ACCESS.hijackHash),fb.api.TEST_ACCESS.ConnectionTarget=fb.core.RepoInfo,goog.exportProperty(fb.api.TEST_ACCESS,"ConnectionTarget",fb.api.TEST_ACCESS.ConnectionTarget),fb.api.TEST_ACCESS.queryIdentifier=function(a){return a.queryIdentifier()},goog.exportProperty(fb.api.TEST_ACCESS,"queryIdentifier",fb.api.TEST_ACCESS.queryIdentifier),fb.api.TEST_ACCESS.listens=function(a){return a.repo.connection_.listens_},goog.exportProperty(fb.api.TEST_ACCESS,"listens",fb.api.TEST_ACCESS.listens),goog.provide("fb.core.util.NextPushId"),goog.require("fb.core.util"),fb.core.util.NextPushId=function(){var a="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",b=0,c=[];return function(d){var e=d===b;b=d;for(var f=new Array(8),g=7;g>=0;g--)f[g]=a.charAt(d%64),d=Math.floor(d/64);fb.core.util.assert(0===d,"Cannot push at time == 0");var h=f.join("");if(e){for(g=11;g>=0&&63===c[g];g--)c[g]=0;c[g]++}else for(g=0;12>g;g++)c[g]=Math.floor(64*Math.random());for(g=0;12>g;g++)h+=a.charAt(c[g]);return fb.core.util.assert(20===h.length,"NextPushId: Length should be 20."),h}}(),goog.provide("Firebase"),goog.require("fb.api.INTERNAL"),goog.require("fb.api.OnDisconnect"),goog.require("fb.api.Query"),goog.require("fb.api.TEST_ACCESS"),goog.require("fb.constants"),goog.require("fb.core.Repo"),goog.require("fb.core.RepoManager"),goog.require("fb.core.storage"),goog.require("fb.core.util"),goog.require("fb.core.util.NextPushId"),goog.require("fb.core.util.validation"),goog.require("goog.string"),Firebase=function(a,b){var c,d,e;if(a instanceof fb.core.Repo)c=a,d=b;else{fb.util.validation.validateArgCount("new Firebase",1,2,arguments.length);var f=fb.core.util.parseRepoInfo(arguments[0]),g=f.repoInfo;if(fb.core.util.validation.validateUrl("new Firebase",1,f),b)if(b instanceof fb.core.RepoManager)e=b;else{if(!goog.isString(b))throw new Error("Expected a valid Firebase.Context for second argument to new Firebase()");e=fb.core.RepoManager.getInstance(),g.persistenceKey=b}else e=fb.core.RepoManager.getInstance();c=e.getRepo(g),d=f.path}fb.api.Query.call(this,c,d,fb.core.view.QueryParams.DEFAULT,!1)},goog.inherits(Firebase,fb.api.Query),NODE_CLIENT&&(module.exports=Firebase),Firebase.prototype.name=function(){return fb.core.util.warn("Firebase.name() being deprecated. Please use Firebase.key() instead."),fb.util.validation.validateArgCount("Firebase.name",0,0,arguments.length),this.key()},Firebase.prototype.key=function(){return fb.util.validation.validateArgCount("Firebase.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},Firebase.prototype.child=function(a){return fb.util.validation.validateArgCount("Firebase.child",1,1,arguments.length),goog.isNumber(a)?a=String(a):a instanceof fb.core.util.Path||(null===this.path.getFront()?fb.core.util.validation.validateRootPathString("Firebase.child",1,a,!1):fb.core.util.validation.validatePathString("Firebase.child",1,a,!1)),new Firebase(this.repo,this.path.child(a))},Firebase.prototype.parent=function(){fb.util.validation.validateArgCount("Firebase.parent",0,0,arguments.length);var a=this.path.parent();return null===a?null:new Firebase(this.repo,a)},Firebase.prototype.root=function(){fb.util.validation.validateArgCount("Firebase.ref",0,0,arguments.length);for(var a=this;null!==a.parent();)a=a.parent();return a},Firebase.prototype.toString=function(){return fb.util.validation.validateArgCount("Firebase.toString",0,0,arguments.length),null===this.parent()?this.repo.toString():this.parent().toString()+"/"+goog.string.urlEncode(this.key())},Firebase.prototype.set=function(a,b){fb.util.validation.validateArgCount("Firebase.set",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.set",this.path),fb.core.util.validation.validateFirebaseDataArg("Firebase.set",1,a,!1),fb.util.validation.validateCallback("Firebase.set",2,b,!0),this.repo.setWithPriority(this.path,a,null,b||null)},Firebase.prototype.update=function(a,b){if(fb.util.validation.validateArgCount("Firebase.update",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.update",this.path),goog.isArray(a)){for(var c={},d=0;d<a.length;++d)c[""+d]=a[d];a=c,fb.core.util.warn("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}if(fb.core.util.validation.validateFirebaseMergeDataArg("Firebase.update",1,a,!1),fb.util.validation.validateCallback("Firebase.update",2,b,!0),fb.util.obj.contains(a,".priority"))throw new Error("update() does not currently support updating .priority.");this.repo.update(this.path,a,b||null)},Firebase.prototype.setWithPriority=function(a,b,c){if(fb.util.validation.validateArgCount("Firebase.setWithPriority",2,3,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.setWithPriority",this.path),fb.core.util.validation.validateFirebaseDataArg("Firebase.setWithPriority",1,a,!1),fb.core.util.validation.validatePriority("Firebase.setWithPriority",2,b,!1),fb.util.validation.validateCallback("Firebase.setWithPriority",3,c,!0),".length"===this.key()||".keys"===this.key())throw"Firebase.setWithPriority failed: "+this.key()+" is a read-only object.";this.repo.setWithPriority(this.path,a,b,c||null)},Firebase.prototype.remove=function(a){fb.util.validation.validateArgCount("Firebase.remove",0,1,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.remove",this.path),fb.util.validation.validateCallback("Firebase.remove",1,a,!0),this.set(null,a)},Firebase.prototype.transaction=function(a,b,c){if(fb.util.validation.validateArgCount("Firebase.transaction",1,3,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.transaction",this.path),fb.util.validation.validateCallback("Firebase.transaction",1,a,!1),fb.util.validation.validateCallback("Firebase.transaction",2,b,!0),fb.core.util.validation.validateBoolean("Firebase.transaction",3,c,!0),".length"===this.key()||".keys"===this.key())throw"Firebase.transaction failed: "+this.key()+" is a read-only object.";"undefined"==typeof c&&(c=!0),this.repo.startTransaction(this.path,a,b||null,c)},Firebase.prototype.setPriority=function(a,b){fb.util.validation.validateArgCount("Firebase.setPriority",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.setPriority",this.path),fb.core.util.validation.validatePriority("Firebase.setPriority",1,a,!1),fb.util.validation.validateCallback("Firebase.setPriority",2,b,!0),this.repo.setWithPriority(this.path.child(".priority"),a,null,b)},Firebase.prototype.push=function(a,b){fb.util.validation.validateArgCount("Firebase.push",0,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.push",this.path),fb.core.util.validation.validateFirebaseDataArg("Firebase.push",1,a,!0),fb.util.validation.validateCallback("Firebase.push",2,b,!0);var c=this.repo.serverTime(),d=fb.core.util.NextPushId(c),e=this.child(d);return"undefined"!=typeof a&&null!==a&&e.set(a,b),e},Firebase.prototype.onDisconnect=function(){return fb.core.util.validation.validateWritablePath("Firebase.onDisconnect",this.path),new fb.api.OnDisconnect(this.repo,this.path)},Firebase.prototype.auth=function(a,b,c){fb.core.util.warn("FirebaseRef.auth() being deprecated. Please use FirebaseRef.authWithCustomToken() instead."),fb.util.validation.validateArgCount("Firebase.auth",1,3,arguments.length),fb.core.util.validation.validateCredential("Firebase.auth",1,a,!1),fb.util.validation.validateCallback("Firebase.auth",2,b,!0),fb.util.validation.validateCallback("Firebase.auth",3,b,!0);var d={};d[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]="none",this.repo.auth.authenticate(a,{},d,b,c)},Firebase.prototype.unauth=function(a){fb.util.validation.validateArgCount("Firebase.unauth",0,1,arguments.length),fb.util.validation.validateCallback("Firebase.unauth",1,a,!0),this.repo.auth.unauthenticate(a)},Firebase.prototype.getAuth=function(){return fb.util.validation.validateArgCount("Firebase.getAuth",0,0,arguments.length),this.repo.auth.getAuth()},Firebase.prototype.onAuth=function(a,b){fb.util.validation.validateArgCount("Firebase.onAuth",1,2,arguments.length),fb.util.validation.validateCallback("Firebase.onAuth",1,a,!1),fb.util.validation.validateContextObject("Firebase.onAuth",2,b,!0),this.repo.auth.on("auth_status",a,b)},Firebase.prototype.offAuth=function(a,b){fb.util.validation.validateArgCount("Firebase.offAuth",1,2,arguments.length),fb.util.validation.validateCallback("Firebase.offAuth",1,a,!1),fb.util.validation.validateContextObject("Firebase.offAuth",2,b,!0),this.repo.auth.off("auth_status",a,b)},Firebase.prototype.authWithCustomToken=function(a,b,c){fb.util.validation.validateArgCount("Firebase.authWithCustomToken",2,3,arguments.length),fb.core.util.validation.validateCredential("Firebase.authWithCustomToken",1,a,!1),fb.util.validation.validateCallback("Firebase.authWithCustomToken",2,b,!1),fb.core.util.validation.validateObject("Firebase.authWithCustomToken",3,c,!0),this.repo.auth.authenticate(a,{},c||{},b)},Firebase.prototype.authWithOAuthPopup=function(a,b,c){fb.util.validation.validateArgCount("Firebase.authWithOAuthPopup",2,3,arguments.length),fb.core.util.validation.validateString("Firebase.authWithOAuthPopup",1,a,!1),fb.util.validation.validateCallback("Firebase.authWithOAuthPopup",2,b,!1),fb.core.util.validation.validateObject("Firebase.authWithOAuthPopup",3,c,!0),this.repo.auth.authWithPopup(a,c,b)},Firebase.prototype.authWithOAuthRedirect=function(a,b,c){fb.util.validation.validateArgCount("Firebase.authWithOAuthRedirect",2,3,arguments.length),fb.core.util.validation.validateString("Firebase.authWithOAuthRedirect",1,a,!1),fb.util.validation.validateCallback("Firebase.authWithOAuthRedirect",2,b,!1),fb.core.util.validation.validateObject("Firebase.authWithOAuthRedirect",3,c,!0),this.repo.auth.authWithRedirect(a,c,b)},Firebase.prototype.authWithOAuthToken=function(a,b,c,d){fb.util.validation.validateArgCount("Firebase.authWithOAuthToken",3,4,arguments.length),fb.core.util.validation.validateString("Firebase.authWithOAuthToken",1,a,!1),fb.util.validation.validateCallback("Firebase.authWithOAuthToken",3,c,!1),fb.core.util.validation.validateObject("Firebase.authWithOAuthToken",4,d,!0),goog.isString(b)?(fb.core.util.validation.validateString("Firebase.authWithOAuthToken",2,b,!1),this.repo.auth.authWithCredential(a+"/token",{access_token:b},d,c)):(fb.core.util.validation.validateObject("Firebase.authWithOAuthToken",2,b,!1),this.repo.auth.authWithCredential(a+"/token",b,d,c))},Firebase.prototype.authAnonymously=function(a,b){fb.util.validation.validateArgCount("Firebase.authAnonymously",1,2,arguments.length),fb.util.validation.validateCallback("Firebase.authAnonymously",1,a,!1),fb.core.util.validation.validateObject("Firebase.authAnonymously",2,b,!0),this.repo.auth.authWithCredential("anonymous",{},b,a)},Firebase.prototype.authWithPassword=function(a,b,c){fb.util.validation.validateArgCount("Firebase.authWithPassword",2,3,arguments.length),fb.core.util.validation.validateObject("Firebase.authWithPassword",1,a,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.authWithPassword",1,a,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.authWithPassword",1,a,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.authAnonymously",2,b,!1),fb.core.util.validation.validateObject("Firebase.authAnonymously",3,c,!0),this.repo.auth.authWithCredential("password",a,c,b)},Firebase.prototype.createUser=function(a,b){fb.util.validation.validateArgCount("Firebase.createUser",2,2,arguments.length),fb.core.util.validation.validateObject("Firebase.createUser",1,a,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.createUser",1,a,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.createUser",1,a,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.createUser",2,b,!1),this.repo.auth.createUser(a,b)},Firebase.prototype.removeUser=function(a,b){fb.util.validation.validateArgCount("Firebase.removeUser",2,2,arguments.length),fb.core.util.validation.validateObject("Firebase.removeUser",1,a,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.removeUser",1,a,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.removeUser",1,a,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.removeUser",2,b,!1),this.repo.auth.removeUser(a,b)},Firebase.prototype.changePassword=function(a,b){fb.util.validation.validateArgCount("Firebase.changePassword",2,2,arguments.length),fb.core.util.validation.validateObject("Firebase.changePassword",1,a,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.changePassword",1,a,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changePassword",1,a,"oldPassword",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changePassword",1,a,"newPassword",!1,"string"),fb.util.validation.validateCallback("Firebase.changePassword",2,b,!1),this.repo.auth.changePassword(a,b)},Firebase.prototype.changeEmail=function(a,b){fb.util.validation.validateArgCount("Firebase.changeEmail",2,2,arguments.length),fb.core.util.validation.validateObject("Firebase.changeEmail",1,a,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.changeEmail",1,a,"oldEmail",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changeEmail",1,a,"newEmail",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changeEmail",1,a,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.changeEmail",2,b,!1),this.repo.auth.changeEmail(a,b)},Firebase.prototype.resetPassword=function(a,b){fb.util.validation.validateArgCount("Firebase.resetPassword",2,2,arguments.length),fb.core.util.validation.validateObject("Firebase.resetPassword",1,a,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.resetPassword",1,a,"email",!1,"string"),fb.util.validation.validateCallback("Firebase.resetPassword",2,b,!1),this.repo.auth.resetPassword(a,b)},Firebase.goOffline=function(){fb.util.validation.validateArgCount("Firebase.goOffline",0,0,arguments.length),fb.core.RepoManager.getInstance().interrupt()},Firebase.goOnline=function(){fb.util.validation.validateArgCount("Firebase.goOnline",0,0,arguments.length),fb.core.RepoManager.getInstance().resume()},Firebase.enableLogging=function(a,b){fb.core.util.assert(!b||a===!0||a===!1,"Can't turn on custom loggers persistently."),a===!0?("undefined"!=typeof console&&("function"==typeof console.log?fb.core.util.logger=goog.bind(console.log,console):"object"==typeof console.log&&(fb.core.util.logger=function(a){console.log(a)})),b&&fb.core.storage.SessionStorage.set("logging_enabled",!0)):a?fb.core.util.logger=a:(fb.core.util.logger=null,fb.core.storage.SessionStorage.remove("logging_enabled"))},Firebase.ServerValue={TIMESTAMP:{".sv":"timestamp"}},Firebase.SDK_VERSION=CLIENT_VERSION,Firebase.INTERNAL=fb.api.INTERNAL,Firebase.Context=fb.core.RepoManager,Firebase.TEST_ACCESS=fb.api.TEST_ACCESS,Firebase.SDK_VERSION="2.1.2";