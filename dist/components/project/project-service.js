angular.module("portfolioApp").factory("projectService",["$q","$rootScope","Project","ProjectFactory","$location","ProjectsArray","FBURL",function(a,b,c,d,e,f,g){var h=null,i=null;return{projects:f,getProjects:function(){var b=a.defer();return console.log("projectsARray",f),f.$loaded().then(function(){i=f,b.resolve(f)},function(a){b.reject(a)}),b.promise},findMatchingTags:function(a,b){function c(a,b){if(!a||!b||""==b||" "==b)return[];var c=new RegExp(b,"i");if(_.isArray(a)){var d=_.filter(a,function(a){return c.test(a.substring(0,b.length))});return d}return console.warn("item tags is not an array",a),[]}if(b&&_.isString(b)){var d=b.split(",");return d.length>1?_.map(d,function(b){return c(a,b)}).join(", "):c(a,b).join(", ")}return null},getProject:function(b){var c=a.defer();return i||this.getProjects().then(function(a){c.resolve(a.$getRecord(b))}),h&&c.resolve(h),c.promise},setCurrentProject:function(a){return h=a},getCurrentProject:function(b){var d=a.defer();h&&d.resolve(h);var e=new Firebase(g+"/portfolio/projects/"+b);return e.on("value",function(a){h=new c(a),d.resolve(h)},function(a){d.reject(a)}),d.promise}}}]).factory("Project",function(){function a(a){_.contains(_.methods(a),"val")&&(this.$id=a.key(),_.extend(this,a.val()))}return a.prototype.matchesSearch=function(a){function b(b){var e=b.split(",");return e.length>1?_.every(e,function(a){return c(d,a)}):c(d,a)}function c(a,b){if(""==b||" "==b)return!0;var c=new RegExp(b,"i");if(_.has(a,"tags")&&_.isArray(a.tags)){var d=_.some(a.tags,function(a){return c.test(a.substring(0,b.length))});return d}return!1}var d=this;if(a&&_.isString(a)){var e=new RegExp(a,"i");return e.test(d.name.substring(0,a.length))?!0:b(a)?!0:!1}return!1},a.prototype.matchingTagsString=function(a){return a?this.matchingTags(a).join(", "):void 0},a.prototype.matchingTags=function(a){function b(a){var b=new RegExp(a,"i");return _.filter(c.tags,function(c){return b.test(c.substring(0,a.length))})}var c=this;if(_.has(c,"tags")&&_.isArray(c.tags)&&a&&_.isString(a)){var d=a.split(",");return d.length>1?(d=_.without(d," "),_.map(d,function(a){return b(a)})):b(a)}return null},a}).factory("ProjectFactory",["$firebaseObject","Project","FBURL",function(a,b,c){var d=new Firebase(c+"/portfolio/projects"),e=a.$extend(b);return function(a){return a&&(d=d.child(a)),console.log("trying to load project with pname",a),new e(d)}}]).factory("ProjectsArray",["$firebaseArray","Project","FBURL",function(a,b,c){var d=a.$extend({$$added:function(a){return new b(a)},matchingProjects:function(a){if(a&&_.isString(a)){var b=[];angular.forEach(this.$list,function(c){c.matchesSearch(a)?b.push(c):null})}}}),e=new Firebase(c+"/portfolio/projects");return new d(e)}]);