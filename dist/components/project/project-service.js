angular.module("portfolioApp").factory("projectService",["$q","$rootScope","Project","$firebase","$location","af","ProjectsArray",function(a,b,c,d,e,f,g){var h=null,i=f(["portfolio","projects"]),j=null;return{projects:i,getProjects:function(){var b=a.defer();return g.$loaded().then(function(){j=g,b.resolve(g)},function(a){b.reject(a)}),b.promise},findMatchingTags:function(a,b){function c(a,b){if(!a||!b||""==b||" "==b)return[];var c=new RegExp(b,"i");if(_.isArray(a)){var d=_.filter(a,function(a){return c.test(a.substring(0,b.length))});return d}return console.warn("item tags is not an array",a),[]}if(b&&_.isString(b)){var d=b.split(",");return d.length>1?_.map(d,function(b){return c(a,b)}).join(", "):c(a,b).join(", ")}return null},getProject:function(a){return j||this.getProjects().then(function(b){_.findWhere(b,a)}),h},setCurrentProject:function(a){return h=a},getCurrentProject:function(){return h?h:h=_.findWhere(this.projects,{url:e.path()})}}}]).factory("Project",function(){function a(a){var b=_.extend(this,a.val());return b}return a.prototype.matchesSearch=function(a){function b(b){var e=b.split(",");return e.length>1?_.every(e,function(a){return c(d,a)}):c(d,a)}function c(a,b){if(""==b||" "==b)return!0;var c=new RegExp(b,"i");if(_.has(a,"tags")&&_.isArray(a.tags)){var d=_.some(a.tags,function(a){return c.test(a.substring(0,b.length))});return d}return!1}var d=this;if(a&&_.isString(a)){var e=new RegExp(a,"i");return e.test(d.name.substring(0,a.length))?!0:b(a)?!0:!1}return!1},a.prototype.matchingTagsString=function(a){return a?this.matchingTags(a).join(", "):void 0},a.prototype.matchingTags=function(a){function b(a){var b=new RegExp(a,"i");return _.filter(c.tags,function(c){return b.test(c.substring(0,a.length))})}var c=this;if(_.has(c,"tags")&&_.isArray(c.tags)&&a&&_.isString(a)){var d=a.split(",");return d.length>1?(d=_.without(d," "),_.map(d,function(a){return b(a)})):b(a)}return null},a}).factory("ProjectsArray",["$FirebaseArray","af","Project",function(a,b,c){function d(){return a.$extendFactory({$$added:function(a){return new c(a)},matchingProjects:function(a){a&&_.isString(a)}})}return b(["portfolio","projects"],{arrayFactory:d()}).$asArray()}]);